/*! For license information please see src_workers_nvphysx_worker_js.thing.nvphysx.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("THING",[],t):"object"==typeof exports?exports.THING=t():(e.THING=e.THING||{},e.THING.PHYSX=t())}(self,(()=>(()=>{"use strict";var e={"./src/core/Functions.js":(e,t,i)=>{i.d(t,{PhysXActorFunction:()=>a,PhysXControllerFunction:()=>l,PhysXGeometryFunction:()=>c,PhysXGlobalFunction:()=>s,PhysXJointFunction:()=>h,PhysXMaterialFunction:()=>n,PhysXSceneFunction:()=>r,PhysXShapeFunction:()=>o});var s={InitPhysX:"InitPhysX",ReleasePhysX:"ReleasePhysX",OnColliderEnter:1,OnColliderLeave:2,OnContactBegin:3,OnContactEnd:4,CanSendAllActorTransformFromWorker:"CanSendAllActorTransformFromWorker",CanSendAllActorTransformFromMain:"CanSendAllActorTransformFromMain",SetAllActorTransform:"SetAllActorTransform",SetAllCollisionEvent:"SetAllCollisionEvent",ReleaseWorker:"ReleaseWorker"},r={CreateScene:"CreateScene",ReleaseScene:"ReleaseScene",SetGravity:"SetGravity",AddActor:"AddActor",RemoveActor:"RemoveActor",BatchSetTransform:"BatchSetTransform",RaycastSingle:"RaycastSingle"},a={CreateStaticActor:"CreateStaticActor",CreateDynamicActor:"CreateDynamicActor",SetEnable:"SetEnable",ReleaseActor:"ReleaseActor",SetTransform:"SetTransform",AddForce:"AddForce",AddTorque:"AddTorque",SetMass:"SetMass",SetCenterOfMass:"SetCenterOfMass",SetLinearVelocity:"SetLinearVelocity",SetMaxAngularVelocity:"SetMaxAngularVelocity",SetMaxLinearVelocity:"SetMaxLinearVelocity",SetAngularVelocity:"SetAngularVelocity",SetLinearDamping:"SetLinearDamping",SetAngularDaming:"SetAngularDaming",SetInertiaTensor:"SetInertiaTensor",SetIsKinematic:"SetIsKinematic",SetConstraints:"SetConstraints",SetCollisionDetectionMode:"SetCollisionDetectionMode",SetSleepThreshold:"SetSleepThreshold",SetSleep:"SetSleep",SetWakeup:"SetWakeup",AddShape:"AddShape",RemoveShape:"RemoveShape",DisableGravity:"DisableGravity"},o={CreateShape:"CreateShape",ReleaseShape:"ReleaseShape",SetLocalPosition:"SetLocalPosition",SetLocalRotation:"SetLocalRotation",SetIsTrigger:"SetIsTrigger",SetMaterial:"SetMaterial",SetGeometry:"SetGeometry"},n={CreateMaterial:"CreateMaterial",ReleaseMaterial:"ReleaseMaterial",SetStaticFriction:"SetStaticFriction",SetDynamicFriction:"SetDynamicFriction",SetRestitution:"SetRestitution"},c={CreateGeometry:"CreateGeometry",ReleaseGeometry:"ReleaseGeometry",SetBoxSize:"SetBoxSize",SetSphereRadius:"SetSphereRadius",SetCapsuleRadius:"SetCapsuleRadius",SetCapsuleHeight:"SetCapsuleHeight",SetPlaneRotation:"SetPlaneRotation",SetConvexMeshScale:"SetConvexMeshScale",SetTriangleMeshScale:"SetTriangleMeshScale"},l={CreateController:"CreateController",ReleaseController:"ReleaseController",SetCapsuleRaidus:"SetCapsuleRaidus",SetCapsuleHeight:"SetCapsuleHeight",MoveController:"MoveController",ControllerJump:"ControllerJump",DisableControllerGravity:"DisableControllerGravity",SetCameraForward:"SetCameraForward",SetCameraDistanceScale:"SetCameraDistanceScale",OnControllerEvent:"OnControllerEvent",ControllerEventType:{OnJumping:"OnJumping",OnFalling:"OnFalling",OnFalled:"OnFalled",OnFinishJump:"OnFinishJump"}},h={CreateDistanceJoint:"CreateDistanceJoint",CreateFixedJoint:"CreateFixedJoint",CreateRevoluteJoint:"CreateRevoluteJoint",CreateSphericalJoint:"CreateSphericalJoint",CreatePrismaticJoint:"CreatePrismaticJoint",CreateD6Joint:"CreateD6Joint",SetActors:"SetActors",SetLocalPose:"SetLocalPose",SetBreakForce:"SetBreakForce",ReleaseJoint:"ReleaseJoint",InvMassScale0:"InvMassScale0",InvInertiaScale0:"InvInertiaScale0",InvMassScale1:"InvMassScale1",InvInertiaScale1:"InvInertiaScale1",SetMinDistance:"SetMinDistance",SetMaxDistance:"SetMaxDistance",SetTolerance:"SetTolerance",SetStiffness:"SetStiffness",SetDamping:"SetDamping",SetProjectionLinearTolerance:"SetProjectionLinearTolerance",SetProjectionAngularTolerance:"SetProjectionAngularTolerance",SetHardLimit:"SetHardLimit",SetSoftLimit:"SetSoftLimit",SetDriveVelocity:"SetDriveVelocity",SetDriveForceLimit:"SetDriveForceLimit",SetDriveGearRatio:"SetDriveGearRatio",SetRevoluteDrive:"SetRevoluteDrive",SetHardLimitCone:"SetHardLimitCone",SetSoftLimitCone:"SetSoftLimitCone",SetHardLimitPri:"SetHardLimitPri",SetSoftLimitPri:"SetSoftLimitPri",SetMotion:"SetMotion",SetHardDistanceLimit:"SetHardDistanceLimit",SetSoftDistanceLimit:"SetSoftDistanceLimit",SetHardLinearLimit:"SetHardLinearLimit",SetSoftLinearLimit:"SetSoftLinearLimit",SetHardTwistLimit:"SetHardTwistLimit",SetSoftTwistLimit:"SetSoftTwistLimit",SetHardSwingLimit:"SetHardSwingLimit",SetSoftSwingLimit:"SetSoftSwingLimit",SetHardPyramidSwingLimit:"SetHardPyramidSwingLimit",SetSoftPyramidSwingLimit:"SetSoftPyramidSwingLimit",SetDrive:"SetDrive",SetDriveVelocityD6:"SetDriveVelocityD6",SetDrivePosition:"SetDrivePosition"}},"./src/core/PhysXCore.js":(e,t,i)=>{i.d(t,{PhysXCore:()=>a});var s=i("../../node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),r=i("./src/core/Functions.js");class a{constructor(e){this._physX=null,this._pxPhysics=null,this._pxDesc=null,this._eventCallback=null}loadLibrary(e,t,i){return(0,s.default)((function*(){var e="release",t="nvphysx.js",r="./"+t+"/"+e+"/physx."+e+".js",a="./"+t+"/"+e+"/physx."+e+".wasm";if(i){yield importScripts(r);var o=yield new self.PHYSX({locateFile:function(){return a}});return Promise.resolve(o)}return new Promise((function(e,t){var i=document.scripts,o="";for(var n in i)if(i[n].src.indexOf("thing.nvphysx.js")>0){o=i[n].src;break}if(o){var c=document.createElement("script"),l=o.replace("thing.nvphysx.js","")+r,h=o.replace("thing.nvphysx.js","")+a;c.src=l,c.onload=(0,s.default)((function*(){var t=yield new self.PHYSX({locateFile:function(){return h}});e(t)})),document.head.append(c)}}))}))()}createFoundation(e){var t=e.PX_PHYSICS_VERSION,i=new e.PxDefaultErrorCallback,s=new e.PxDefaultAllocator;return e.PxCreateFoundation(t,s,i)}createDebuggerProxy(e){var t=null,i=[];return{connect:function(){return(t=new WebSocket("ws://127.0.0.1:5426",["binary"])).onopen=()=>{console.log("Connected to PhysX Debugger"),i.forEach((e=>t.send(e))),i=[]},t.onclose=()=>{console.log("Socket disconnect"),i=null,t=null},!0},disconnect:function(){console.log("Disconnect Debugger"),t&&t.close()},write:function(s,r){if(t){var a=e.HEAPU8.slice(s,s+r);t.readyState===WebSocket.OPEN?(i.length&&(i.forEach((e=>t.send(e))),i.length=0),t.send(a)):i.push(a)}return!0}}}connectToDebugger(e,t){var i=this.createDebuggerProxy(e),s=e.PxPvdTransport.implement(i),r=e.PxCreatePvd(t);return r.connect(s,new e.PxPvdInstrumentationFlags(e.PxPvdInstrumentationFlag.eALL.value)),r}createPhysics(e,t,i){var s=e.PxCreatePhysics(e.PX_PHYSICS_VERSION,t,new e.PxTolerancesScale,!1,i);return e.PxInitExtensions(s,i),s}createTriggerCallback(){var e=this,t={onContactBegin:function(t,i,s,a){e.onEventCallback(r.PhysXGlobalFunction.OnContactBegin,{actor0:t,shape0:i,actor1:s,shape1:a})},onContactEnd:function(t,i,s,a){e.onEventCallback(r.PhysXGlobalFunction.OnContactEnd,{actor0:t,shape0:i,actor1:s,shape1:a})}};return this._physX.PxSimulationEventCallback.implement(t)}getDefaultSceneDesc(e,t){return e.getDefaultSceneDesc(t.getTolerancesScale(),0,this.createTriggerCallback())}init(e){var t=this;return(0,s.default)((function*(){var i=e.enablePVD,s=e.physXPath||"../physx.js",r=e.enableWorker;t._physX||(t._physX=yield t.loadLibrary(i,s,r));var a=t._physX;t._foundation||(t._foundation=t.createFoundation(a));var o=t._foundation,n=t._pvd=i?t.connectToDebugger(a,o):null;t._pxPhysics=t.createPhysics(a,o,n),t._pxDesc=t.getDefaultSceneDesc(a,t._pxPhysics)}))()}onEventCallback(e,t){this._eventCallback&&this._eventCallback(e,t)}setEventCallback(e){this._eventCallback=e}static getInstance(){return a.instance}release(){this._pxPhysics&&(this._pxDesc=null,this._physX.PxCloseExtensions(),this._pxPhysics.release(),this._pxPhysics=null,this._pvd&&(this._pvd.disconnect(),this._pvd.release(),this._pvd=null))}}a.instance=new a},"./src/core/Utils.js":(e,t,i)=>{function s(e){return{x:e[0],y:e[1],z:e[2]}}function r(e){return[e.x,e.y,e.z]}function a(e){return{x:e[0],y:e[1],z:e[2],w:e[3]}}function o(e){return[e.x,e.y,e.z,e.w]}function n(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function c(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function l(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function h(e,t){var i=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+s*s+r*r)}function _(e,t){var i,s,r,a,o,n;return i=[0,0,0],(n=(r=(s=l(t,e))[0])*r+(a=s[1])*a+(o=s[2])*o)>0&&(n=1/Math.sqrt(n)),i[0]=s[0]*n,i[1]=s[1]*n,i[2]=s[2]*n,i}i.d(t,{addVector:()=>c,arrayToQuat:()=>a,arrayToVector3:()=>s,getDirection:()=>_,getDistance:()=>h,quatToArray:()=>o,scaleVector:()=>n,subVector:()=>l,vector3ToArray:()=>r})},"./src/core/actor/PhysXActor.js":(e,t,i)=>{i.r(t),i.d(t,{PhysXActor:()=>a});var s=i("./src/core/PhysXCore.js"),r=i("./src/core/Utils.js");class a{constructor(){this._pxActor=null,this._physXCore=s.PhysXCore.getInstance(),this._id=0,this._scene=null}setUniqueID(e){this._id=e,this.setName(this._id.toString()),this._pxActor.setId(e)}id(){return this._id}addShape(e){this._pxActor.attachShape(e._pxShape)}removeShape(e){this._pxActor.detachShape(e._pxShape,!0)}setWroldTransform(e,t){this._pxActor.setGlobalPose({translation:(0,r.arrayToVector3)(e),rotation:(0,r.arrayToQuat)(t)},!0)}disableGravity(e){this._pxActor.setActorFlag(this._physXCore._physX.PxActorFlag.eDISABLE_GRAVITY,e)}disable(){this._pxActor.setActorFlag(this._physXCore._physX.PxActorFlag.eDISABLE_SIMULATION,!0)}enable(){this._pxActor.setActorFlag(this._physXCore._physX.PxActorFlag.eDISABLE_SIMULATION,!1)}getWorldTransform(){var e=this._pxActor.getGlobalPose();return{position:(0,r.vector3ToArray)(e.translation),rotation:(0,r.quatToArray)(e.rotation)}}copyWorldTransformArray(e,t){var i=this._physXCore._physX._malloc(28),s=new Float32Array(this._physXCore._physX.HEAPU8.buffer,i,7);this._pxActor.copyGlobalPose(i),e.set(s,t),this._physXCore._physX._free(i)}setName(e){this._pxActor.setName&&this._pxActor.setName(e)}get scene(){return this._scene}set scene(e){this._scene=e}release(){this._pxActor&&(this._pxActor.release(),this._pxActor.delete(),this._pxActor=null)}}},"./src/core/joint/PhysXJoint.js":(e,t,i)=>{i.r(t),i.d(t,{PhysXJoint:()=>a});var s=i("./src/core/PhysXCore.js"),r=i("./src/core/Utils.js");class a{constructor(){this._pxJoint=null,this._physXCore=s.PhysXCore.getInstance(),this._id=0,this._scene=null,this._invMassScale0=1,this._invInertiaScale0=1,this._invMassScale1=1,this._invInertiaScale1=1}setUniqueID(e){this._id=e,this.setName(this._id.toString())}id(){return this._id}get invMassScale0(){return this._invMassScale0}set invMassScale0(e){this._pxJoint.setInvMassScale0(e)}get invInertiaScale0(){return this._invInertiaScale0}set invInertiaScale0(e){this._pxJoint.setInvInertiaScale0(e)}get invMassScale1(){return this._invMassScale1}set invMassScale1(e){this._pxJoint.setInvMassScale1(e)}get invInertiaScale1(){return this._invInertiaScale1}set invInertiaScale1(e){this._pxJoint.setInvInertiaScale1(e)}setName(e){this._pxJoint.setName&&this._pxJoint.setName(e)}setActors(e,t){this._pxJoint.setActors(e._pxActor,t._pxActor)}setLocalPose(e,t,i){this._pxJoint.setLocalPose(e,(0,r.arrayToVector3)(t),(0,r.arrayToQuat)(i))}setBreakForce(e,t){this._pxJoint.setBreakForce(e,t),this._pxJoint.setConstraintFlag(1,!0)}setFlagProjection(e){this._pxJoint.setConstraintFlag(6,e)}setFlagDriverLimitsAreForces(e){this._pxJoint.setConstraintFlag(32,e)}setFlagVisualization(e){this._pxJoint.setConstraintFlag(16,e)}setFlagCollisionEnabled(e){this._pxJoint.setConstraintFlag(8,e)}release(){this._pxJoint.release()}}},"../../node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js":(e,t,i)=>{function s(e,t,i,s,r,a,o){try{var n=e[a](o),c=n.value}catch(e){return void i(e)}n.done?t(c):Promise.resolve(c).then(s,r)}function r(e){return function(){var t=this,i=arguments;return new Promise((function(r,a){var o=e.apply(t,i);function n(e){s(o,r,a,n,c,"next",e)}function c(e){s(o,r,a,n,c,"throw",e)}n(void 0)}))}}i.d(t,{default:()=>r})}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}return i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=i("../../node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),t=i("./src/core/Utils.js"),{PhysXActor:s}=i("./src/core/actor/PhysXActor.js");class r extends s{constructor(e,i,s){super(),this._pxActor=this._physXCore._pxPhysics.createRigidDynamic({translation:(0,t.arrayToVector3)(e),rotation:(0,t.arrayToQuat)(i)}),this._drag=0,this._angularDrag=0,this._velocity=[0,0,0],this._angularVelocity=[0,0,0],this._mass=1,this._centerOfMass=[0,0,0],this._inertiaTensor=[0,0,0],this._maxAngularVelocity=0,this._maxLinearVelocity=0,this._maxDepenetrationVelocity=0,this._sleepThreshold=0,this._solverIterations=0,this._collisionDetectionMode=1,this._isKinematic=!1,this._constraints=-1,this._freezeRotation=!1,this._forceSyncTransformToMain=!1,this.setUniqueID(s),this.collisionDetectionMode=1,this.linearDamping=.1,this.angularDamping=.1}get forceSyncTransformToMain(){return this._forceSyncTransformToMain}set forceSyncTransformToMain(e){this._forceSyncTransformToMain=e}get linearDamping(){return this._drag}set linearDamping(e){this._drag=e,this._pxActor.setLinearDamping(e)}get angularDamping(){return this._angularDrag}set angularDamping(e){this._angularDrag=e,this._pxActor.setAngularDamping(e)}set linearVelocity(e){this._velocity=(0,t.arrayToVector3)(e),this._pxActor.setLinearVelocity(this._velocity,!0)}set angularVelocity(e){this._angularVelocity=(0,t.arrayToVector3)(e),this._pxActor.setAngularVelocity(this._angularVelocity,!0)}get mass(){return this._mass}set mass(e){this._mass=e,this._pxActor.setMassAndUpdateInertia(e)}get centerOfMass(){return this._centerOfMass}set centerOfMass(e){this._centerOfMass=e,this._pxActor.setCMassLocalPose((0,t.arrayToVector3)(e))}get inertiaTensor(){return this._inertiaTensor}set inertiaTensor(e){this._inertiaTensor=e,this._pxActor.setMassSpaceInertiaTensor((0,t.arrayToVector3)(e))}get maxAngularVelocity(){return this._maxAngularVelocity}set maxAngularVelocity(e){this._maxAngularVelocity=e,this._pxActor.setMaxAngularVelocity(e)}get maxLinearVelocity(){return this._maxLinearVelocity}set maxLinearVelocity(e){this._maxLinearVelocity=e,this._pxActor.setMaxLinearVelocity(e)}get maxDepenetrationVelocity(){return this._maxDepenetrationVelocity}set maxDepenetrationVelocity(e){this._maxDepenetrationVelocity=e,this._pxActor.setMaxDepenetrationVelocity(e)}get sleepThreshold(){return this._sleepThreshold}set sleepThreshold(e){this._sleepThreshold=e,this._pxActor.setSleepThreshold(e)}get collisionDetectionMode(){return this._collisionDetectionMode}set collisionDetectionMode(e){switch(this._collisionDetectionMode=e,e){case 1:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!0);break;case 2:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!0);break;case 3:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!0);break;case 0:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!1)}}get isKinematic(){return this._isKinematic}set isKinematic(e){this._isKinematic=e,e?(this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eKINEMATIC,!0)):(this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eKINEMATIC,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!0))}get constraints(){return this._constraints}setConstraints(e,t){switch(this._constraints=t?this._constraints|e:this._constraints&~e,e){case 0:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_X,t);break;case 1:case 2:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,t);break;case 3:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_X,t);break;case 4:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Y,t);break;case 5:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Z,t);break;case 8:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_X,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_X,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Y,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Z,t);break;case 6:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_X,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,t);break;case 7:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_X,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Y,t),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Z,t)}}get freezeRotation(){return this._freezeRotation}set freezeRotation(e){this._freezeRotation=e,this.setConstraints(7,e)}addForce(e){this._pxActor.addForce((0,t.arrayToVector3)(e))}addTorque(e){this._pxActor.addTorque((0,t.arrayToVector3)(e))}addForceAtPosition(e,i){this._pxActor.addForceAtPos((0,t.arrayToVector3)(e),(0,t.arrayToVector3)(i))}getPointVelocity(e){var i=this._pxActor.getVelocityAtPos((0,t.arrayToVector3)(e));return(0,t.vector3ToArray)(i)}getRelativePointVelocity(e){var i=this._pxActor.getLocalVelocityAtLocalPos((0,t.arrayToVector3)(e));return(0,t.vector3ToArray)(i)}moveTransform(e,i){this._pxActor.setKinematicTarget((0,t.arrayToVector3)(e),(0,t.arrayToQuat)(i))}movePosition(e){(0,t.arrayToVector3)(e),this._pxActor.setKinematicTarget((0,t.arrayToVector3)(e),{x:0,y:0,z:0,w:1})}MoveRotation(e){var i={translation:{x:0,y:0,z:0},rotation:(0,t.arrayToQuat)(e)};this._pxActor.setKinematicTarget(i)}sleep(){return this._pxActor.putToSleep()}isSleeping(){return this._pxActor.isSleeping()}wakeUp(){return this._pxActor.wakeUp()}release(){super.release()}}var a=i("./src/core/PhysXCore.js"),{PhysXActor:o}=i("./src/core/actor/PhysXActor.js");class n extends o{constructor(e,i,s){super(),this._pxActor=this._physXCore._pxPhysics.createRigidStatic({translation:(0,t.arrayToVector3)(e),rotation:(0,t.arrayToQuat)(i)}),this.setUniqueID(s)}release(){super.release()}}var c=i("./src/core/actor/PhysXActor.js"),l=i("./src/core/Functions.js");class h{constructor(e,t,i,s,r,o){void 0===t&&(t=.5),void 0===i&&(i=.5),void 0===s&&(s=.5),void 0===r&&(r=0),void 0===o&&(o=0),this._pxMaterial=a.PhysXCore.getInstance()._pxPhysics.createMaterial(t,i,s),this._pxMaterial.setFrictionCombineMode(r),this._pxMaterial.setRestitutionCombineMode(o)}setBounciness(e){this._pxMaterial.setRestitution(e)}setDynamicFriction(e){this._pxMaterial.setDynamicFriction(e)}setStaticFriction(e){this._pxMaterial.setStaticFriction(e)}setBounceCombine(e){this._pxMaterial.setRestitutionCombineMode(e)}setFrictionCombine(e){this._pxMaterial.setFrictionCombineMode(e)}release(){this._pxMaterial&&(this._pxMaterial.release(),this._pxMaterial.delete(),this._pxMaterial=null)}}class _{constructor(e){void 0===e&&(e=[0,-9.8,0]),this._jumpTime=0,this._jump=!1,this._v0=0,this._jumpGravity=e[1],this._lastHeight=0,this._disableGravity=!1}startJump(e){return!this._jump&&!this._disableGravity&&(this._jumpTime=0,this._v0=e,this._jump=!0,this._lastHeight=0,!0)}stopJump(){this._jump&&(this._jump=!1)}isJumping(){return this._jump}getHeight(e){if(!this._jump||this._disableGravity)return 0;this._jumpTime+=e;var t=.5*this._jumpGravity*this._jumpTime*this._jumpTime+this._v0*this._jumpTime,i=t-this._lastHeight;return this._lastHeight=t,i}disableGravity(e){this._disableGravity=e}}class p{constructor(e){void 0===e&&(e=[0,-9.8,0]),this._lastHeight=0,this._fallTime=0,this._jumpGravity=e[1],this._disableGravity=!1}getHeight(e){if(this._disableGravity)return 0;this._fallTime+=e;var t=.5*this._jumpGravity*this._fallTime*this._fallTime,i=t-this._lastHeight;return this._lastHeight=t,i}getFallHeight(){return this._lastHeight}disableGravity(e){this._disableGravity=e}stopFall(){this._lastHeight=0,this._fallTime=0}}class y{constructor(e,t,i){this._cameraDistanceScale=0,this._ignoreEyeObstruction=!1,this._cameraForward=[0,0,1],this._scene=e,this._halfHeight=t+i/2}set cameraDistanceScale(e){this._cameraDistanceScale=e}get cameraDistanceScale(){return this._cameraDistanceScale}set ignoreEyeObstruction(e){this._ignoreEyeObstruction=e}get ignoreEyeObstruction(){return this._ignoreEyeObstruction}set cameraForward(e){this._cameraForward=e}get cameraForward(){return this._cameraForward}getPosition(e){var i=[e[0],e[1]+this._halfHeight+.1,e[2]];if(0!=this._cameraDistanceScale){var s=(0,t.scaleVector)(this._cameraForward,this._cameraDistanceScale),r=(0,t.subVector)(i,s),a=(0,t.getDirection)(i,r),o=(0,t.getDistance)(i,r),n=this._scene.raycastSingle(i,a,o);return n&&!this._ignoreEyeObstruction?n.position:r}return i}}class u{constructor(e,t,i,s,r,o,n){void 0===e&&(e=0),void 0===i&&(i=.5),void 0===s&&(s=1),void 0===r&&(r=new h),void 0===o&&(o=[0,0,0]),this._pxCapsulController=null,this._physXCore=a.PhysXCore.getInstance(),this._physXSystem=I.getInstance(),this._material=r,this._gravity=t.gravity,this._jump=new _(this._gravity),this._fall=new p(this._gravity),this._camera=new y(t,i,s),this._target=[0,0,0],this._id=e,this._radius=i,this._height=s,this._pxControllerManager=null,this._scene=t,this._climbingMode=0,this._stepOffset=.1,this._lastHitActorPointer=0,this._lastHitShapePointer=0,this._actorId=n,this._actor=null,this._currentState=null,this._disableGravity=!1,this.createController(o)}reportCallback(){var e=this;return{onShapeHit(t,i){var s=t.$$.ptr,r=i.$$.ptr;e._lastHitActorPointer==s&&e._lastHitShapePointer==r||(console.log(s,r),e._lastHitActorPointer=s,e._lastHitShapePointer=r)}}}createController(e){this._pxControllerManager=this._scene._pxScene.createControllerManager();var i=new this._physXCore._physX.PxCapsuleControllerDesc;i.radius=this._radius,i.height=this._height,i.position=(0,t.arrayToVector3)(e),i.scaleCoeff=.8,i.stepOffset=this._stepOffset,i.contactOffset=.1,i.setMaterial(this._material._pxMaterial),i.setReportCallback(new this._physXCore._physX.DefaultUserControllerHitReport),this._pxCapsulController=this._pxControllerManager.createCapsuleController(i),this.allocActor(),i.delete(),i=null}allocActor(){var e=this._pxCapsulController.getActor(),t=new c.PhysXActor;t._pxActor=e,t.setUniqueID(this._actorId),t.setName("CapsuleController"),this._actor=t}getActor(){return this._actor}releaseController(){this._pxCapsulController.release(),this._pxCapsulController.delete(),this._pxCapsulController=null,this._pxControllerManager.release(),this._pxControllerManager.delete(),this._pxControllerManager=null}jump(e){this._jump.startJump(e)&&this.dispatchCharEvent(l.PhysXControllerFunction.ControllerEventType.OnJumping)}disableGravity(e){this._jump.disableGravity(e),this._fall.disableGravity(e),this._disableGravity=e}move(e){void 0===e&&(e=[0,0,0]),this._target=e}getPosition(){if(this._pxCapsulController){var e=this._pxCapsulController.getPosition();return(0,t.vector3ToArray)(e)}}resize(e){this._pxCapsulController.resize(e)}dispatchCharEvent(e){this._currentState!=e&&(this._physXSystem.postMessage(l.PhysXControllerFunction.OnControllerEvent,{state:e,id:this._id}),this._currentState=e)}updatePosition(e){var i=[];if(this._disableGravity){if(0==this._target[0]&&0==this._target[1]&&0==this._target[2])return;i=this._target}else{var s=this._jump.getHeight(e)||this._fall.getHeight(e);i=[this._target[0],s,this._target[2]]}var r=this._pxCapsulController.move((0,t.arrayToVector3)(i),0,e);r.isSet(this._physXCore._physX.PxControllerCollisionFlag.eCOLLISION_DOWN)?(this._jump.isJumping()&&(this.dispatchCharEvent(l.PhysXControllerFunction.ControllerEventType.OnFinishJump),this._jump.stopJump()),s<-.15&&this.dispatchCharEvent(l.PhysXControllerFunction.ControllerEventType.OnFalled),this._fall.stopFall(this._fall.getFallHeight())):s<-.15&&this.dispatchCharEvent(l.PhysXControllerFunction.ControllerEventType.OnFalling),r.delete(),this._target=[0,0,0]}getWorldTransform(e){this.updatePosition(e);var i=this.getPosition(),s=this._camera.getPosition(i);return{position:i,cameraPosition:s,cameraTarget:(0,t.addVector)(s,this._camera.cameraForward)}}setCameraForward(e){this._camera.cameraForward=e}setCameraDistanceScale(e){this._camera.cameraDistanceScale=e}setCameraIgnoreEyeObstruction(e){this._camera.ignoreEyeObstruction=e}setClimbingMode(e){this._climbingMode=e,this._pxCapsulController.setClimbingMode(this._climbingMode)}setStepOffset(e){this._stepOffset=e,this._pxCapsulController.setStepOffset(this._stepOffset)}release(){this.releaseController(),this._material&&this._material.release()}}class g{constructor(e){this.id=e,this._pxGeometry=null,this._physXCore=a.PhysXCore.getInstance()}getPxGeometry(){return this._pxGeometry}release(){this._pxGeometry&&(this._pxGeometry.delete(),this._pxGeometry=null)}}class d extends g{constructor(e,t){super(e),this._size=t,this._pxGeometry=new this._physXCore._physX.PxBoxGeometry(.5*t[0],.5*t[1],.5*t[2])}setSize(e){this._pxGeometry.halfExtents={x:.5*e[0],y:.5*e[1],z:.5*e[2]}}}class m extends g{constructor(e,t,i){super(e),this._radius=t,this._height=i,this._pxGeometry=new this._physXCore._physX.PxCapsuleGeometry(this._radius,.5*this._height)}setRadius(e){this._radius=e,this._pxGeometry.radius=e}setHeight(e){this._height=e,this._pxGeometry.halfHeight=.5*this._height}}class S extends g{constructor(e,t,i){void 0===i&&(i=[1,1,1]),super(e),this._meshWeldTolerance=0;var s=performance.now();this._pxMesh=null;var r=this.allocMemory(t);this._pxGeometry=this.createGeometry(r,i),this._pxGeometry||console.warn("Create geometry failed");var a=performance.now();a-s>15&&console.warn("Init convex mesh time "+(a-s)+"  vertices: "+t.length)}setScale(e){this._pxGeometry&&(this._pxGeometry.scale=new this._physXCore._physX.PxMeshScale((0,t.arrayToVector3)(e),{x:0,y:0,z:0,w:1}))}createGeometry(e,i){var s=this._physXCore,r=new s._physX.PxTolerancesScale,a=new s._physX.PxCookingParams(r);a.meshPreprocessParams=new s._physX.PxMeshPreprocessingFlags(s._physX.PxMeshPreprocessingFlag.eWELD_VERTICES.value),a.meshWeldTolerance=0,a.planeTolerance=.01;var o=s._physX.PxCreateCooking(s._physX.PX_PHYSICS_VERSION,s._foundation,a),n=new s._physX.PxMeshScale((0,t.arrayToVector3)(i),{x:0,y:0,z:0,w:1}),c=new s._physX.PxConvexMeshGeometryFlags(2);if(this._pxMesh=o.createConvexMeshFromBuffer(e.byteOffset,e.length/3,s._pxPhysics),this._pxMesh){var l=new s._physX.PxConvexMeshGeometry(this._pxMesh,n,c);return r.delete(),r=null,a.delete(),a=null,o.release(),o.delete(),o=null,n.delete(),n=null,c.delete(),c=null,l}console.warn("Create mesh failed.")}allocMemory(e){var t=4*e.length;this._bufferPtr=this._physXCore._physX._malloc(t);for(var i=new Float32Array(this._physXCore._physX.HEAPU8.buffer,this._bufferPtr,e.length),s=0;s<e.length;s++)i[s]=e[s];return i}freeMemory(){this._bufferPtr&&(this._physXCore._physX._free(this._bufferPtr),this._bufferPtr=null)}release(){this.freeMemory(),this._pxMesh&&(this._pxMesh.release(),this._pxMesh.delete(),this._pxMesh=null),super.release()}}class x extends g{constructor(e){super(e),this._pxGeometry=new this._physXCore._physX.PxPlaneGeometry}}class P extends g{constructor(e,t){super(e),this._radius=t,this._pxGeometry=new this._physXCore._physX.PxSphereGeometry(this._radius)}setRadius(e){this._radius=e,this._pxGeometry.radius=this._radius}}class v extends g{constructor(e,t,i,s,r){void 0===s&&(s=[1,1,1]),super(e),this._meshWeldTolerance=t.length>=100?.2:.05,(r[0]<.5&&r[1]<.5||r[1]<.5&&r[2]<.5||r[0]<.5&&r[2]<.5)&&(this._meshWeldTolerance=1e-6);var a=performance.now(),o=this.allocGeometryBuffer(t,i),n=o.bufferP,c=o.bufferI;this._pxMesh=null,this._pxGeometry=this.createGeometry(n,c,s);var l=performance.now();l-a>15&&console.warn("Init triangle mesh time "+(l-a)+", vertices: "+t.length+" "),this.freeMemory()}setScale(e){this._pxGeometry&&(this._pxGeometry.scale=new this._physXCore._physX.PxMeshScale((0,t.arrayToVector3)(e),{x:0,y:0,z:0,w:1}))}createGeometry(e,i,s){var r=this._physXCore,a=new r._physX.PxTolerancesScale,o=new r._physX.PxCookingParams(a);o.meshPreprocessParams=new r._physX.PxMeshPreprocessingFlags(r._physX.PxMeshPreprocessingFlag.eWELD_VERTICES.value),o.meshWeldTolerance=this._meshWeldTolerance,o.planeTolerance=.1;var n=r._physX.PxCreateCooking(r._physX.PX_PHYSICS_VERSION,r._foundation,o),c=new r._physX.PxMeshScale((0,t.arrayToVector3)(s),{x:0,y:0,z:0,w:1}),l=new r._physX.PxMeshGeometryFlags(2);if(this._pxMesh=n.createTriMesh(e.byteOffset,e.length/3,i.byteOffset,i.length/3,!1,r._pxPhysics),this._pxMesh){var h=new r._physX.PxTriangleMeshGeometry(this._pxMesh,c,l);return a.delete(),a=null,o.delete(),o=null,n.release(),n.delete(),n=null,c.delete(),c=null,l.delete(),l=null,h}console.warn("cook failed",e.length)}allocPointsMemory(e){var t=4*e.length;this._pointsBufferPtr=this._physXCore._physX._malloc(t);for(var i=new Float32Array(this._physXCore._physX.HEAPU8.buffer,this._pointsBufferPtr,e.length),s=0;s<e.length;s++)i[s]=e[s];return i}allocIndexesMemory(e){var t=4*e.length;this._indexBufferPtr=this._physXCore._physX._malloc(t);for(var i=new Uint32Array(this._physXCore._physX.HEAPU8.buffer,this._indexBufferPtr,e.length),s=0;s<e.length;s++)i[s]=e[s];return i}allocGeometryBuffer(e,t){var i=4*e.length;this._pointsBufferPtr=this._physXCore._physX._malloc(i),i=4*t.length,this._indexBufferPtr=this._physXCore._physX._malloc(i);for(var s=new Float32Array(this._physXCore._physX.HEAPU8.buffer,this._pointsBufferPtr,e.length),r=0;r<e.length;r++)s[r]=e[r];var a=new Uint32Array(this._physXCore._physX.HEAPU8.buffer,this._indexBufferPtr,t.length);for(r=0;r<t.length;r++)a[r]=t[r];return{bufferP:s,bufferI:a}}freeMemory(){this._pointsBufferPtr&&(this._physXCore._physX._free(this._pointsBufferPtr),this._pointsBufferPtr=null),this._indexBufferPtr&&(this._physXCore._physX._free(this._indexBufferPtr),this._indexBufferPtr=null)}release(){this.freeMemory(),this._pxMesh&&(this._pxMesh.release(),this._pxMesh.delete(),this._pxMesh=null),super.release()}}var{PhysXJoint:f}=i("./src/core/joint/PhysXJoint.js");class C extends f{constructor(e,i,s,r,a,o){super(),this._pxJoint=this._physXCore._pxPhysics.createDistanceJoint(null==e?null:e._pxActor,(0,t.arrayToVector3)(i),(0,t.arrayToQuat)(s),r._pxActor,(0,t.arrayToVector3)(a),(0,t.arrayToQuat)(o)),this.setFlagCollisionEnabled(!0),this._pxJoint.setDistanceJointFlag(4,!0),this._pxJoint.setDistanceJointFlag(2,!0),this._minDistance=0,this._maxDistance=0,this._tolerance=0,this._stiffness=0,this._damping=0}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance=e,this._pxJoint.setMinDistance(e)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance=e,this._pxJoint.setMaxDistance(e)}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e,this._pxJoint.setTolerance(e)}get stiffness(){return this._stiffness}set stiffness(e){this._stiffness=e,this._pxJoint.setStiffness(e),0==e?this._pxJoint.setDistanceJointFlag(8,!1):this._pxJoint.setDistanceJointFlag(8,!0)}get damping(){return this._damping}set damping(e){this._damping=e,this._pxJoint.setDamping(e)}}var{PhysXJoint:F}=i("./src/core/joint/PhysXJoint.js");class X extends F{constructor(e,i,s,r,a,o){super(),this._pxJoint=this._physXCore._pxPhysics.createFixedJoint(null==e?null:e._pxActor,(0,t.arrayToVector3)(i),(0,t.arrayToQuat)(s),r._pxActor,(0,t.arrayToVector3)(a),(0,t.arrayToQuat)(o)),this.setFlagCollisionEnabled(!0),this._linearTolerance=0,this._angularTolerance=0}get linearTolerance(){return this._linearTolerance}set linearTolerance(e){this._linearTolerance=e,this._pxJoint.setProjectionLinearTolerance(e),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(e){this._angularTolerance=e,this._pxJoint.setProjectionAngularTolerance(e),this.setFlagProjection(!0)}}var{PhysXJoint:A}=i("./src/core/joint/PhysXJoint.js");class L extends A{constructor(e,i,s,r,a,o){super(),this._pxJoint=this._physXCore._pxPhysics.createRevoluteJoint(null==e?null:e._pxActor,(0,t.arrayToVector3)(i),(0,t.arrayToQuat)(s),r._pxActor,(0,t.arrayToVector3)(a),(0,t.arrayToQuat)(o)),this.setFlagCollisionEnabled(!0),this._lowerLimit=0,this._upperLimit=0,this._contactDist=0,this._stiffness=0,this._damping=0,this._driveVelocity=0,this._driveForceLimit=0,this._driveGearRatio=0,this._linearTolerance=0,this._angularTolerance=0}get driveVelocity(){return this._driveVelocity}set driveVelocity(e){this._driveVelocity=e,this._pxJoint.setDriveVelocity(e,!0),0==e?this._pxJoint.setRevoluteJointFlag(2,!1):this._pxJoint.setRevoluteJointFlag(2,!0)}get driveForceLimit(){return this._driveForceLimit}set driveForceLimit(e){this._driveForceLimit=e,this._pxJoint.setDriveForceLimit(e),this.setFlagDriverLimitsAreForces(!0)}get driveGearRatio(){return this._driveGearRatio}set driveGearRatio(e){this._driveGearRatio=e,this._pxJoint.setDriveGearRatio(e)}get linearTolerance(){return this._linearTolerance}set linearTolerance(e){this._linearTolerance=e,this._pxJoint.setProjectionLinearTolerance(e),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(e){this._angularTolerance=e,this._pxJoint.setProjectionAngularTolerance(e),this.setFlagProjection(!0)}setHardLimit(e,t,i){this._lowerLimit=e,this._upperLimit=t,this._contactDist=i,this._pxJoint.setHardLimit(e,t,i),this._pxJoint.setRevoluteJointFlag(1,!0)}setSoftLimit(e,t,i,s){this._lowerLimit=e,this._upperLimit=t,this._stiffness=i,this._damping=s,this._pxJoint.setSoftLimit(e,t,i,s),this._pxJoint.setRevoluteJointFlag(1,!0)}setDrive(e,t,i){this._driveVelocity=e,this._driveForceLimit=i,this._pxJoint.setDriveVelocity(e,!0),0==e?this._pxJoint.setRevoluteJointFlag(2,!1):this._pxJoint.setRevoluteJointFlag(2,!0),this.setFlagDriverLimitsAreForces(t),this._pxJoint.setDriveForceLimit(i)}}var{PhysXJoint:T}=i("./src/core/joint/PhysXJoint.js");class b extends T{constructor(e,i,s,r,a,o){super(),this._pxJoint=this._physXCore._pxPhysics.createSphericalJoint(null==e?null:e._pxActor,(0,t.arrayToVector3)(i),(0,t.arrayToQuat)(s),r._pxActor,(0,t.arrayToVector3)(a),(0,t.arrayToQuat)(o)),this.setFlagCollisionEnabled(!0),this._yLimitAngle=0,this._zLimitAngle=0,this._contactDist=0,this._stiffness=0,this._damping=0,this._linearTolerance=0}setHardLimitCone(e,t,i){this._yLimitAngle=e,this._zLimitAngle=t,this._contactDist=i,this._pxJoint.setHardLimitCone(e,t,i),this._pxJoint.setSphericalJointFlag(2,!0)}setSoftLimitCone(e,t,i,s){this._yLimitAngle=e,this._zLimitAngle=t,this._stiffness=i,this._damping=s,this._pxJoint.setSoftLimitCone(e,t,i,s),this._pxJoint.setSphericalJointFlag(2,!0)}get linearTolerance(){return this._linearTolerance}set linearTolerance(e){this._linearTolerance=e,this._pxJoint.setProjectionLinearTolerance(e),this.setFlagProjection(!0)}}var{PhysXJoint:D}=i("./src/core/joint/PhysXJoint.js");class M extends D{constructor(e,i,s,r,a,o){super(),this._pxJoint=this._physXCore._pxPhysics.createPrismaticJoint(null==e?null:e._pxActor,(0,t.arrayToVector3)(i),(0,t.arrayToQuat)(s),r._pxActor,(0,t.arrayToVector3)(a),(0,t.arrayToQuat)(o)),this.setFlagCollisionEnabled(!0),this._scale=0,this._lowerLimit=0,this._upperLimit=0,this._contactDist=0,this._stiffness=0,this._damping=0,this._linearTolerance=0,this._angularTolerance=0,this._prismaticJointFlags=null}get linearTolerance(){return this._linearTolerance}set linearTolerance(e){this._linearTolerance=e,this._pxJoint.setProjectionLinearTolerance(e),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(e){this._angularTolerance=e,this._pxJoint.setProjectionAngularTolerance(e),this.setFlagProjection(!0)}setHardLimitPri(e,t,i){this.scale=this._physXCore._pxPhysics.getTolerancesScale(),this._lowerLimit=e,this._upperLimit=t,this._contactDist=i,this._pxJoint.setHardLimit(this.scale,e,t,i),this._pxJoint.setPrismaticJointFlag(2,!0)}setSoftLimitPri(e,t,i,s){this._lowerLimit=e,this._upperLimit=t,this._stiffness=i,this._damping=s,this._pxJoint.setSoftLimit(e,t,i,s),this._pxJoint.setPrismaticJointFlag(2,!0)}}var{PhysXJoint:R}=i("./src/core/joint/PhysXJoint.js");class J extends R{constructor(e,i,s,r,a,o){super(),this._pxJoint=this._physXCore._pxPhysics.createD6Joint(null==e?null:e._pxActor,(0,t.arrayToVector3)(i),(0,t.arrayToQuat)(s),r._pxActor,(0,t.arrayToVector3)(a),(0,t.arrayToQuat)(o)),this.setFlagCollisionEnabled(!0),this._driveLinearVelocity=0,this._driveAngularVelocity=0,this._linearTolerance=0,this._angularTolerance=0}get driveVelocity(){return this._driveVelocity}setDriveVelocityD6(e,i){this._driveLinearVelocity=e,this._driveAngularVelocity=i,this._pxJoint.setDriveVelocity((0,t.arrayToVector3)(e),(0,t.arrayToVector3)(i),!0)}get linearTolerance(){return this._linearTolerance}set linearTolerance(e){this._linearTolerance=e,this._pxJoint.setProjectionLinearTolerance(e),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(e){this._angularTolerance=e,this._pxJoint.setProjectionAngularTolerance(e),this.setFlagProjection(!0)}setMotion(e,t){this._pxJoint.setMotion(e,t)}setHardDistanceLimit(e,t){this._pxJoint.setHardDistanceLimit(this._physXCore._pxPhysics.getTolerancesScale(),e,t)}setSoftDistanceLimit(e,t,i){this._pxJoint.setSoftDistanceLimit(e,t,i)}setHardLinearLimit(e,t,i,s){this._pxJoint.setHardLinearLimit(e,this._physXCore._pxPhysics.getTolerancesScale(),t,i,s)}setSoftLinearLimit(e,t,i,s,r){this._pxJoint.setSoftLinearLimit(e,t,i,s,r)}setHardTwistLimit(e,t,i){this._pxJoint.setHardTwistLimit(e,t,i)}setSoftTwistLimit(e,t,i,s){this._pxJoint.setSoftTwistLimit(e,t,i,s)}setHardSwingLimit(e,t,i){this._pxJoint.setHardSwingLimit(e,t,i)}setSoftSwingLimit(e,t,i,s){this._pxJoint.setSoftSwingLimit(e,t,i,s)}setHardPyramidSwingLimit(e,t,i,s,r){this._pxJoint.setHardPyramidSwingLimit(e,t,i,s,r)}setSoftPyramidSwingLimit(e,t,i,s,r,a){this._pxJoint.setSoftPyramidSwingLimit(e,t,i,s,r,a)}setDrive(e,t,i,s){this.setFlagDriverLimitsAreForces(!0),this._pxJoint.setDrive(e,t,i,s)}setDrivePosition(e,i){this._pxJoint.setDrivePosition((0,t.arrayToVector3)(e),(0,t.arrayToQuat)(i))}}class k{constructor(e,t){void 0===t&&(t=[0,-9.8,0]),this._id=e,this._gravity=t,this._physXCore=a.PhysXCore.getInstance(),this._pxScene=this._physXCore._pxPhysics.createScene(this._physXCore._pxDesc),this._pxHitResult=new this._physXCore._physX.PxRaycastHit,this._pxFilterData=new this._physXCore._physX.PxQueryFilterData,this._pxFilterData.flags=new this._physXCore._physX.PxQueryFlags(3)}addActor(e){this._pxScene&&this._pxScene.addActor(e._pxActor,null),e.scene=this}removeActor(e){this._pxScene&&this._pxScene.removeActor(e._pxActor,!0),e.scene=null}set gravity(e){this._gravity=e,this._pxScene.setGravity((0,t.arrayToVector3)(e))}get gravity(){return this._gravity}update(e){this._pxScene&&(this._pxScene.simulate(e,!0),this._pxScene.fetchResults(!0))}raycastSingle(e,i,s){if(this._pxScene.raycastSingle((0,t.arrayToVector3)(e),(0,t.arrayToVector3)(i),s,this._pxHitResult,this._pxFilterData)){var r=this._pxHitResult.position,a=this._pxHitResult.normal;return s=this._pxHitResult.distance,{id:this._pxHitResult.getActor().getId(),position:(0,t.vector3ToArray)(r),normal:(0,t.vector3ToArray)(a),distance:s}}return null}release(){this._pxScene&&(this._pxScene.release(),this._pxScene.delete(),this._pxScene=null)}}class w{constructor(e,t,i,s){this._shapeFlags=11,this._pxShape=null,this._physXCore=a.PhysXCore.getInstance(),this._material=i,this._isShared=s,this.allocShape(t._pxGeometry,i._pxMaterial),this.setUniqueID(e)}setLocalPose(e,i){void 0===e&&(e=[0,0,0]),void 0===i&&(i=[0,0,0,1]),this._pxShape.setLocalPose({translation:(0,t.arrayToVector3)(e),rotation:(0,t.arrayToQuat)(i)})}setLocalPosition(e){var i=this._pxShape.getLocalPose();this._pxShape.setLocalPose({translation:(0,t.arrayToVector3)(e),rotation:i.rotation})}setLocalRotation(e){var i=this._pxShape.getLocalPose();this._pxShape.setLocalPose({translation:i.translation,rotation:(0,t.arrayToQuat)(e)})}getMaterial(){return this._material}setMaterial(e){this._material&&this._material.release(),this._material=e,this._pxShape.setMaterials([e._pxMaterial])}setUniqueID(e){var t=new this._physXCore._physX.PxFilterData(e,0,0,0);this._pxShape.setQueryFilterData(t),t.delete(),t=null,this.setName(e.toString()),this._pxShape.setId(e)}modifyFlag(e,t){this._shapeFlags=t?this._shapeFlags|e:this._shapeFlags&~e}setShapeFlags(e){this._shapeFlags=e;var t=new this._physXCore._physX.PxShapeFlags(this._shapeFlags);this._pxShape.setFlags(t),t.delete(),t=null}setIsTrigger(e){this._pxShape.setIsTrigger(e)}setIsSceneQuery(e){this.modifyFlag(2,e),this.setShapeFlags(this._shapeFlags)}allocShape(e,t){var i=new this._physXCore._physX.PxShapeFlags(this._shapeFlags);this._pxShape=this._physXCore._pxPhysics.createShape(e,t,!this._isShared,i),i.delete(),i=null}setGeometry(e){this._pxShape.setGeometry(e._pxGeometry)}setName(e){this._pxShape.setName&&this._pxShape.setName(e)}release(){this._pxShape&&(this._pxShape.release(),this._pxShape.delete(),this._pxShape=null)}}class I{constructor(){this._physx_core=null,this._scenes=new Map,this._actors=new Map,this._shapes=new Map,this._materials=new Map,this._geometries=new Map,this._controllers=new Map,this._joints=new Map,this._postMessage=null,this._enableSyncActorTransform=!1,this._cacheEvent=[]}PhysXGlobalFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXGlobalFunction.InitPhysX:if(s._physx_core)return void console.error("only can init once.");s._physx_core=a.PhysXCore.getInstance(),yield s._physx_core.init(i),s._physx_core.setEventCallback(s.eventCollisionCallback.bind(s));break;case l.PhysXGlobalFunction.ReleasePhysX:s._physx_core&&(s._scenes.clear(),s._actors.clear(),s._shapes.clear(),s._materials.clear(),s._geometries.clear(),s._controllers.clear(),s._joints.clear(),s._enableSyncActorTransform=!1,s._cacheEvent=[],s._physx_core.release(),s._physx_core=null);break;case l.PhysXGlobalFunction.CanSendAllActorTransformFromWorker:s._enableSyncActorTransform=!0}}))()}PhysXSceneFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXSceneFunction.CreateScene:var e=i.id,r=i.gravity;(n=new k(e)).gravity=r,s._scenes.set(e,n);break;case l.PhysXSceneFunction.ReleaseScene:e=i.id,(n=s._scenes.get(e))&&n.release(),s._scenes.delete(e);break;case l.PhysXSceneFunction.SetGravity:e=i.id,r=i.gravity,(n=s._scenes.get(e))&&(n.gravity=r);break;case l.PhysXSceneFunction.AddActor:var a=i.sceneId,o=i.actorId,n=s._scenes.get(a);(_=s._actors.get(o))&&n&&n.addActor(_);break;case l.PhysXSceneFunction.RemoveActor:a=i.sceneId,o=i.actorId,n=s._scenes.get(a),(_=s._actors.get(o))&&n&&n.removeActor(_);break;case l.PhysXSceneFunction.BatchSetTransform:var c=i.transforms;for(var h in c){var _;e=c[h].id,(_=s._actors.get(e))&&(_.isKinematic?_.moveTransform(c[h].position,c[h].quaternion):_.setWroldTransform(c[h].position,c[h].quaternion))}break;case l.PhysXSceneFunction.RaycastSingle:a=i.sceneId;var p=i.origin,y=i.direction,u=i.distance;if(n=s._scenes.get(a))return n.raycastSingle(p,y,u)}}))()}PhysXActorFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXActorFunction.CreateStaticActor:var e=i.id,a=i.position,o=i.rotation,c=new n(a,o,e);s._actors.set(e,c);break;case l.PhysXActorFunction.CreateDynamicActor:e=i.id,a=i.position,o=i.rotation,c=new r(a,o,e),s._actors.set(e,c);break;case l.PhysXActorFunction.SetEnable:e=i.id;var h=i.enable;(c=s._actors.get(e))&&(h?c.enable():c.disable());break;case l.PhysXActorFunction.ReleaseActor:e=i.id,(c=s._actors.get(e))&&(c.release(),s._actors.delete(e));break;case l.PhysXActorFunction.SetTransform:e=i.id,a=i.position,o=i.rotation,(c=s._actors.get(e))&&c.setWroldTransform(a,o);break;case l.PhysXActorFunction.AddForce:e=i.id;var _=i.force;(c=s._actors.get(e))&&c.addForce(_);break;case l.PhysXActorFunction.AddTorque:e=i.id;var p=i.torque;(c=s._actors.get(e))&&c.addTorque(p);break;case l.PhysXActorFunction.SetMass:e=i.id;var y=i.mass;(c=s._actors.get(e))&&(c.mass=y);break;case l.PhysXActorFunction.SetCenterOfMass:e=i.id;var u=i.centerOfMass;(c=s._actors.get(e))&&(c.centerOfMass=u);break;case l.PhysXActorFunction.SetLinearVelocity:e=i.id;var g=i.velocity;(c=s._actors.get(e))&&(c.linearVelocity=g);break;case l.PhysXActorFunction.SetAngularVelocity:e=i.id,g=i.velocity,(c=s._actors.get(e))&&(c.angularVelocity=g);break;case l.PhysXActorFunction.SetMaxAngularVelocity:e=i.id;var d=i.maxVelocity;(c=s._actors.get(e))&&(c.maxAngularVelocity=d);break;case l.PhysXActorFunction.SetMaxLinearVelocity:e=i.id,d=i.maxVelocity,(c=s._actors.get(e))&&(c.maxLinearVelocity=d);break;case l.PhysXActorFunction.SetLinearDamping:e=i.id;var m=i.damping;(c=s._actors.get(e))&&(c.linearDamping=m);break;case l.PhysXActorFunction.SetAngularDaming:e=i.id,m=i.damping,(c=s._actors.get(e))&&(c.angularDamping=m);break;case l.PhysXActorFunction.SetSleepThreshold:e=i.id;var S=i.sleepThreshold;(c=s._actors.get(e))&&(c.sleepThreshold=S);break;case l.PhysXActorFunction.SetInertiaTensor:e=i.id;var x=i.inertiaTensor;(c=s._actors.get(e))&&(c.inertiaTensor=x);break;case l.PhysXActorFunction.SetIsKinematic:e=i.id;var P=i.isKinematic;(c=s._actors.get(e))&&(c.isKinematic=P);break;case l.PhysXActorFunction.SetSleep:e=i.id,(c=s._actors.get(e))&&c.sleep();break;case l.PhysXActorFunction.SetWakeup:e=i.id,(c=s._actors.get(e))&&c.wakeUp();break;case l.PhysXActorFunction.AddShape:var v=i.actorId,f=i.shapeId,C=(c=s._actors.get(v),s._shapes.get(f));c&&C&&c.addShape(C);break;case l.PhysXActorFunction.RemoveShape:v=i.actorId,f=i.shapeId,c=s._actors.get(v),C=s._shapes.get(f),c&&C&&c.removeShape(C);break;case l.PhysXActorFunction.DisableGravity:v=i.id;var F=i.disable;(c=s._actors.get(v)).disableGravity(F)}}))()}PhysXShapeFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXShapeFunction.CreateShape:var e=i.id,r=i.geometryId,a=i.materialId,o=s._geometries.get(r),n=s._materials.get(a),c=i.shared;if(o&&n){var h=new w(e,o,n,c);s._shapes.set(e,h)}break;case l.PhysXShapeFunction.ReleaseShape:e=i.id,(h=s._shapes.get(e))&&h.release(),s._shapes.delete(e);break;case l.PhysXShapeFunction.SetLocalPosition:e=i.id;var _=i.localPosition;(h=s._shapes.get(e))&&h.setLocalPosition(_);break;case l.PhysXShapeFunction.SetLocalRotation:e=i.id;var p=i.localRotation;(h=s._shapes.get(e))&&h.setLocalRotation(p);break;case l.PhysXShapeFunction.SetIsTrigger:e=i.id;var y=i.isTrigger;(h=s._shapes.get(e))&&h.setIsTrigger(y);break;case l.PhysXShapeFunction.SetMaterial:e=i.id,a=i.materialId,h=s._shapes.get(e),n=s._materials.get(e),h&&n&&h.setMaterial(n);break;case l.PhysXShapeFunction.SetGeometry:e=i.id;var u=i.geometryId,g=(h=s._shapes.get(e),s._geometries.get(u));h&&g&&h.setGeometry(g)}}))()}PhysXMaterialFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXMaterialFunction.CreateMaterial:var e=i.id,r=i.staticFriction,a=i.dynamicFriction,o=i.restitution,n=new h(e,r,a,o);s._materials.set(e,n);break;case l.PhysXMaterialFunction.ReleaseMaterial:e=i.id,(n=s._materials.get(e))&&(n.release(),s._materials.delete(e));break;case l.PhysXMaterialFunction.SetStaticFriction:e=i.id,r=i.staticFriction,(n=s._materials.get(e))&&n.setStaticFriction(r);break;case l.PhysXMaterialFunction.SetDynamicFriction:e=i.id,a=i.dynamicFriction,(n=s._materials.get(e))&&n.setDynamicFriction(a);break;case l.PhysXMaterialFunction.SetRestitution:e=i.id,o=i.restitution,(n=s._materials.get(e))&&n.setBounciness(o)}}))()}PhysXGeometryFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXGeometryFunction.CreateGeometry:var e=s.createGeometry(i);s._geometries.set(i.id,e);break;case l.PhysXGeometryFunction.ReleaseGeometry:var r=i.id;(e=s._geometries.get(r))&&(e.release(),s._geometries.delete(r));break;case l.PhysXGeometryFunction.SetBoxSize:r=i.id;var a=i.size;(e=s._geometries.get(r))&&e.setSize(a);break;case l.PhysXGeometryFunction.SetSphereRadius:r=i.id;var o=i.radius;(e=s._geometries.get(r))&&e.setRadius(o);break;case l.PhysXGeometryFunction.SetCapsuleRadius:r=i.id,o=i.radius,(e=s._geometries.get(r))&&e.setRadius(o);break;case l.PhysXGeometryFunction.SetCapsuleHeight:r=i.id;var n=i.height;(e=s._geometries.get(r))&&e.setHeight(n);break;case l.PhysXGeometryFunction.SetPlaneRotation:r=i.id;var c=i.rotation;(e=s._geometries.get(r))&&e.setRotation(c);break;case l.PhysXGeometryFunction.SetConvexMeshScale:r=i.id;var h=i.scale;(e=s._geometries.get(r))&&e.setScale(h);break;case l.PhysXGeometryFunction.SetTriangleMeshScale:r=i.id,h=i.scale,(e=s._geometries.get(r))&&e.setScale(h)}}))()}PhysXControllerFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXControllerFunction.CreateController:var e=i.id,r=i.sceneId,a=i.radius,o=i.height,n=i.position,c=i.materialId,h=i.actorId,_=i.cameraDistanceScale,p=i.ignoreEyeObstruction,y=s._scenes.get(r),g=s._materials.get(c);if(y&&g){var d=new u(e,y,a,o,g,n,h);s._controllers.set(e,d);var m=d.getActor();d.setCameraDistanceScale(_),d.setCameraIgnoreEyeObstruction(p),s._actors.set(h,m)}break;case l.PhysXControllerFunction.ReleaseController:e=i.id,(d=s._controllers.get(e))&&(d.release(),s._controllers.delete(e),s._actors.delete(d.getActor().id));break;case l.PhysXControllerFunction.MoveController:e=i.id;var S=i.target,x=i.deltaTime;(d=s._controllers.get(e))&&d.move(S,x);break;case l.PhysXControllerFunction.ControllerJump:e=i.id;var P=i.velocity;(d=s._controllers.get(e))&&d.jump(P);break;case l.PhysXControllerFunction.DisableControllerGravity:e=i.id;var v=i.disable;(d=s._controllers.get(e))&&d.disableGravity(v);break;case l.PhysXControllerFunction.SetCameraForward:e=i.id;var f=i.forward;(d=s._controllers.get(e))&&d.setCameraForward(f);break;case l.PhysXControllerFunction.SetCameraDistanceScale:e=i.id,_=i.cameraDistanceScale,(d=s._controllers.get(e))&&d.setCameraDistanceScale(_)}}))()}PhysXJointFunction(t,i){var s=this;return(0,e.default)((function*(){switch(t){case l.PhysXJointFunction.CreateDistanceJoint:var e=i.id,r=s._actors.get(i.id0),a=i.localPosition0,o=i.localRotation0,n=s._actors.get(i.id1),c=i.localPosition1,h=i.localRotation1;($=new C(r,a,o,n,c,h)).setUniqueID(e),s._joints.set(e,$);break;case l.PhysXJointFunction.CreateFixedJoint:e=i.id,r=s._actors.get(i.id0),a=i.localPosition0,o=i.localRotation0,n=s._actors.get(i.id1),c=i.localPosition1,h=i.localRotation1,($=new X(r,a,o,n,c,h)).setUniqueID(e),s._joints.set(e,$);break;case l.PhysXJointFunction.CreateRevoluteJoint:e=i.id,r=s._actors.get(i.id0),a=i.localPosition0,o=i.localRotation0,n=s._actors.get(i.id1),c=i.localPosition1,h=i.localRotation1,($=new L(r,a,o,n,c,h)).setUniqueID(e),s._joints.set(e,$);break;case l.PhysXJointFunction.CreateSphericalJoint:e=i.id,r=s._actors.get(i.id0),a=i.localPosition0,o=i.localRotation0,n=s._actors.get(i.id1),c=i.localPosition1,h=i.localRotation1,($=new b(r,a,o,n,c,h)).setUniqueID(e),s._joints.set(e,$);break;case l.PhysXJointFunction.CreatePrismaticJoint:e=i.id,r=s._actors.get(i.id0),a=i.localPosition0,o=i.localRotation0,n=s._actors.get(i.id1),c=i.localPosition1,h=i.localRotation1,($=new M(r,a,o,n,c,h)).setUniqueID(e),s._joints.set(e,$);break;case l.PhysXJointFunction.CreateD6Joint:e=i.id,r=s._actors.get(i.id0),a=i.localPosition0,o=i.localRotation0,n=s._actors.get(i.id1),c=i.localPosition1,h=i.localRotation1,($=new J(r,a,o,n,c,h)).setUniqueID(e),s._joints.set(e,$);break;case l.PhysXJointFunction.SetActors:e=i.id,r=s._actors.get(i.id0),n=s._actors.get(i.id1),($=s._joints.get(e))&&$.setActors(r,n);break;case l.PhysXJointFunction.SetLocalPose:e=i.id;var _=i.actor,p=i.localPosition,y=i.localRotation;($=s._joints.get(e))&&$.setLocalPose(_,p,y);break;case l.PhysXJointFunction.SetBreakForce:e=i.id;var u=i.linear,g=i.angular;($=s._joints.get(e))&&$.setBreakForce(u,g);break;case l.PhysXJointFunction.ReleaseJoint:e=i.id,($=s._joints.get(e))&&$.release();break;case l.PhysXJointFunction.InvMassScale0:e=i.id;var d=i.invMassScale0;($=s._joints.get(e))&&($.invMassScale0=d);break;case l.PhysXJointFunction.InvInertiaScale0:e=i.id;var m=i.invInertiaScale0;($=s._joints.get(e))&&($.invInertiaScale0=m);break;case l.PhysXJointFunction.InvMassScale1:e=i.id;var S=i.invMassScale1;($=s._joints.get(e))&&($.invMassScale1=S);break;case l.PhysXJointFunction.InvInertiaScale1:e=i.id;var x=i.invInertiaScale1;($=s._joints.get(e))&&($.invInertiaScale1=x);break;case l.PhysXJointFunction.SetMinDistance:e=i.id;var P=i.minDistance;($=s._joints.get(e))&&($.minDistance=P);break;case l.PhysXJointFunction.SetMaxDistance:e=i.id;var v=i.maxDistance;($=s._joints.get(e))&&($.maxDistance=v);break;case l.PhysXJointFunction.SetTolerance:e=i.id;var f=i.tolerance;($=s._joints.get(e))&&($.tolerance=f);break;case l.PhysXJointFunction.SetStiffness:e=i.id;var F=i.stiffness;($=s._joints.get(e))&&($.stiffness=F);break;case l.PhysXJointFunction.SetDamping:e=i.id;var A=i.damping;($=s._joints.get(e))&&($.damping=A);break;case l.PhysXJointFunction.SetProjectionLinearTolerance:e=i.id;var T=i.linearTolerance;($=s._joints.get(e))&&($.linearTolerance=T);break;case l.PhysXJointFunction.SetProjectionAngularTolerance:e=i.id;var D=i.angularTolerance;($=s._joints.get(e))&&($.angularTolerance=D);break;case l.PhysXJointFunction.SetHardLimit:e=i.id;var R=i.lowerLimit,k=i.upperLimit,w=i.contactDist;($=s._joints.get(e))&&$.setHardLimit(R,k,w);break;case l.PhysXJointFunction.SetSoftLimit:e=i.id,R=i.lowerLimit,k=i.upperLimit,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftLimit(R,k,F,A);break;case l.PhysXJointFunction.SetDriveVelocity:e=i.id;var I=i.driveVelocity;($=s._joints.get(e))&&($.driveVelocity=I);break;case l.PhysXJointFunction.SetDriveForceLimit:e=i.id;var G=i.driveForceLimit;($=s._joints.get(e))&&($.driveForceLimit=G);break;case l.PhysXJointFunction.SetDriveGearRatio:e=i.id;var j=i.driveGearRatio;($=s._joints.get(e))&&($.driveGearRatio=j);break;case l.PhysXJointFunction.SetRevoluteDrive:e=i.id,I=i.driveVelocity;var V=i.driveForceFlag;G=i.driveForceLimit,($=s._joints.get(e))&&$.setDrive(I,V,G);break;case l.PhysXJointFunction.SetHardLimitCone:e=i.id;var E=i.yLimitAngle,H=i.zLimitAngle;w=i.contactDist,($=s._joints.get(e))&&$.setHardLimitCone(E,H,w);break;case l.PhysXJointFunction.SetSoftLimitCone:e=i.id,E=i.yLimitAngle,H=i.zLimitAngle,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftLimitCone(E,H,F,A);break;case l.PhysXJointFunction.SetHardLimitPri:e=i.id,R=i.lowerLimit,k=i.upperLimit,w=i.contactDist,($=s._joints.get(e))&&$.setHardLimitPri(R,k,w);break;case l.PhysXJointFunction.SetSoftLimitPri:e=i.id,R=i.lowerLimit,k=i.upperLimit,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftLimitPri(R,k,F,A);break;case l.PhysXJointFunction.SetMotion:e=i.id;var O=i.axis,B=i.axisType;($=s._joints.get(e))&&$.setMotion(O,B);break;case l.PhysXJointFunction.SetHardDistanceLimit:e=i.id;var N=i.extent;w=i.contactDist,($=s._joints.get(e))&&$.setHardDistanceLimit(N,w);break;case l.PhysXJointFunction.SetSoftDistanceLimit:e=i.id,N=i.extent,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftDistanceLimit(N,F,A);break;case l.PhysXJointFunction.SetHardLinearLimit:e=i.id,O=i.axis,R=i.lowerLimit,k=i.upperLimit,w=i.contactDist,($=s._joints.get(e))&&$.setHardLinearLimit(O,R,k,w);break;case l.PhysXJointFunction.SetSoftLinearLimit:e=i.id,O=i.axis,R=i.lowerLimit,k=i.upperLimit,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftLinearLimit(O,R,k,F,A);break;case l.PhysXJointFunction.SetHardTwistLimit:e=i.id,R=i.lowerLimit,k=i.upperLimit,w=i.contactDist,($=s._joints.get(e))&&$.setHardTwistLimit(R,k,w);break;case l.PhysXJointFunction.SetSoftTwistLimit:e=i.id,R=i.lowerLimit,k=i.upperLimit,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftTwistLimit(R,k,F,A);break;case l.PhysXJointFunction.SetHardSwingLimit:e=i.id,E=i.yLimitAngle,H=i.zLimitAngle,w=i.contactDist,($=s._joints.get(e))&&$.setHardSwingLimit(E,H,w);break;case l.PhysXJointFunction.SetSoftSwingLimit:e=i.id,E=i.yLimitAngle,H=i.zLimitAngle,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftSwingLimit(E,H,F,A);break;case l.PhysXJointFunction.SetHardPyramidSwingLimit:e=i.id;var U=i.yLimitAngleMin,z=i.yLimitAngleMax,K=i.zLimitAngleMin,W=i.zLimitAngleMax;w=i.contactDist,($=s._joints.get(e))&&$.setHardPyramidSwingLimit(U,z,K,W,w);break;case l.PhysXJointFunction.SetSoftPyramidSwingLimit:e=i.id,U=i.yLimitAngleMin,z=i.yLimitAngleMax,K=i.zLimitAngleMin,W=i.zLimitAngleMax,F=i.stiffness,A=i.damping,($=s._joints.get(e))&&$.setSoftPyramidSwingLimit(U,z,K,W,F,A);break;case l.PhysXJointFunction.SetDrive:e=i.id;var q=i.drive,Q=i.driveStiffness,Y=i.driveDamping;G=i.driveForceLimit,($=s._joints.get(e))&&$.setDrive(q,Q,Y,G);break;case l.PhysXJointFunction.SetDriveVelocityD6:e=i.id,u=i.linear,g=i.angular,($=s._joints.get(e))&&$.setDriveVelocityD6(u,g);break;case l.PhysXJointFunction.SetDrivePosition:e=i.id;var $,Z=i.pos,ee=i.quat;($=s._joints.get(e))&&$.setDrivePosition(Z,ee)}}))()}createGeometry(e){var t=e.geometryType,i=e.id,s=null;if("Box"==t){var r=e.size;s=new d(i,r)}else if("Sphere"==t){var a=e.radius;s=new P(i,a)}else if("Plane"==t)s=new x(i);else if("Capsule"==t){a=e.radius;var o=e.height;s=new m(i,a,o)}else if("ConvexMesh"==t){var n=e.vertices,c=e.scale;s=new S(i,n,c)}else if("TriangleMesh"==t){n=e.vertices;var l=e.indexes,h=(c=e.scale,e.obbSize);s=new v(i,n,l,c,h)}return s}getActorIdByPointer(e){var t=null,i=e.$$.ptr;return this._actors.forEach((function(e,s){t||e._pxActor.$$.ptr!=i||(t=s)})),t}getShapeIdByPointer(e){var t=null,i=e.$$.ptr;return this._shapes.forEach((function(e,s){t||e._pxShape.$$.ptr!=i||(t=s)})),t}eventCollisionCallback(e,t){e!=l.PhysXGlobalFunction.OnContactBegin&&e!=l.PhysXGlobalFunction.OnContactEnd&&e!=l.PhysXGlobalFunction.OnColliderEnter&&e!=l.PhysXGlobalFunction.OnColliderLeave||this._cacheEvent.push(new Uint32Array([e,t.actor0,t.shape0,t.actor1,t.shape1]))}onMessage(t){var i=this;return(0,e.default)((function*(){var e=null,s=t.type,r=t.param;return l.PhysXActorFunction[s]?e=yield i.PhysXActorFunction(s,r):l.PhysXGlobalFunction[s]?e=yield i.PhysXGlobalFunction(s,r):l.PhysXSceneFunction[s]?e=yield i.PhysXSceneFunction(s,r):l.PhysXShapeFunction[s]?e=yield i.PhysXShapeFunction(s,r):l.PhysXMaterialFunction[s]?e=yield i.PhysXMaterialFunction(s,r):l.PhysXGeometryFunction[s]?e=yield i.PhysXGeometryFunction(s,r):l.PhysXControllerFunction[s]?e=yield i.PhysXControllerFunction(s,r):l.PhysXJointFunction[s]&&(e=yield i.PhysXJointFunction(s,r)),e}))()}setPostMessageFunction(e){this._postMessage=e}update(e){this._scenes.forEach((function(t,i){t.update(e)})),this.updateTransform(e),this.updateEvent(e),this.postMessage(l.PhysXGlobalFunction.CanSendAllActorTransformFromMain,{})}postMessage(e,t,i){void 0===i&&(i=[]),this._postMessage&&this._postMessage({type:e,param:t},null,i)}updateEvent(e){var t=this._cacheEvent,i=t.length;if(i>0){for(var s=new Uint32Array(5*i),r=[],a=0;a<i;a++)s.set(t[a],5*a+0);r.push(s.buffer),this.postMessage(l.PhysXGlobalFunction.SetAllCollisionEvent,s,r),this._cacheEvent.length=0}}updateTransform(e){if(this._enableSyncActorTransform){var t={actors:{transforms:null,length:0},controllers:[]},i=[],s=new Float32Array(8*this._actors.size),a=0;this._actors.forEach((function(e,t){(e.forceSyncTransformToMain||e.scene&&e instanceof r&&!e.isSleeping())&&(e.forceSyncTransformToMain=!1,s[8*a+0]=t,e.copyWorldTransformArray(s,8*a+1),a++)})),t.actors.transforms=s,t.actors.length=a,i.push(s.buffer),this._controllers.forEach((function(i,s){t.controllers.push({id:s,transform:i.getWorldTransform(e)})})),(t.actors.length||t.controllers.length)&&this.postMessage(l.PhysXGlobalFunction.SetAllActorTransform,t,i),this._enableSyncActorTransform=!1}else this._actors.forEach((function(e,t){e.scene&&e instanceof r&&!e.isSleeping()&&(e.forceSyncTransformToMain=!0)}))}static getInstance(){return I.instance=I.instance||new I,I.instance}}I.instance=null;var G=new class{constructor(){this._physXSystem=I.getInstance(),this._physXSystem.setPostMessageFunction(this.postMessage),this._IDBase=-1,this._callbackMap=new Map}onMessage(t){var i=this;return(0,e.default)((function*(){var e=t.id;if(e&&e<0)i._callbackMap.has(e)&&(i._callbackMap.get(e)(t.ret),i._callbackMap.delete(e));else{var s=yield i._physXSystem.onMessage(t);e&&e>0&&self.postMessage({id:e,type:"Callback",ret:s})}}))()}postMessage(e,t,i){void 0===t&&(t=null),void 0===i&&(i=[]),t&&(e.id=this._IDBase--,this._callbackMap.set(e.id,t)),self.postMessage(e,i)}update(e){this._physXSystem.update(e)}},j=1e3/60,V=new Date;self.fps=1,setInterval((()=>{var e=new Date,t=e-V;self.fps=parseInt(1e3/t),self.fps=self.fps>60?60:self.fps,V=e,G.update(j/1e3)}),j),self.onmessage=function(e){G.onMessage(e.data)}})(),{}})()));