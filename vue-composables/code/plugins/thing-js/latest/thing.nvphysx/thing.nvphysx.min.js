/*! For license information please see thing.nvphysx.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("THING"),require("@uino/base-thing")):"function"==typeof define&&define.amd?define("THING",["THING"],e):"object"==typeof exports?exports.THING=e(require("THING"),require("@uino/base-thing")):(t.THING=t.THING||{},t.THING.PHYSX=e(t.THING,t.THING))}(self,((t,e)=>(()=>{var i={"./src/core/Functions.js":(t,e,i)=>{"use strict";i.d(e,{PhysXActorFunction:()=>r,PhysXControllerFunction:()=>c,PhysXGeometryFunction:()=>l,PhysXGlobalFunction:()=>s,PhysXJointFunction:()=>h,PhysXMaterialFunction:()=>n,PhysXSceneFunction:()=>o,PhysXShapeFunction:()=>a});var s={InitPhysX:"InitPhysX",ReleasePhysX:"ReleasePhysX",OnColliderEnter:1,OnColliderLeave:2,OnContactBegin:3,OnContactEnd:4,CanSendAllActorTransformFromWorker:"CanSendAllActorTransformFromWorker",CanSendAllActorTransformFromMain:"CanSendAllActorTransformFromMain",SetAllActorTransform:"SetAllActorTransform",SetAllCollisionEvent:"SetAllCollisionEvent",ReleaseWorker:"ReleaseWorker"},o={CreateScene:"CreateScene",ReleaseScene:"ReleaseScene",SetGravity:"SetGravity",AddActor:"AddActor",RemoveActor:"RemoveActor",BatchSetTransform:"BatchSetTransform",RaycastSingle:"RaycastSingle"},r={CreateStaticActor:"CreateStaticActor",CreateDynamicActor:"CreateDynamicActor",SetEnable:"SetEnable",ReleaseActor:"ReleaseActor",SetTransform:"SetTransform",AddForce:"AddForce",AddTorque:"AddTorque",SetMass:"SetMass",SetCenterOfMass:"SetCenterOfMass",SetLinearVelocity:"SetLinearVelocity",SetMaxAngularVelocity:"SetMaxAngularVelocity",SetMaxLinearVelocity:"SetMaxLinearVelocity",SetAngularVelocity:"SetAngularVelocity",SetLinearDamping:"SetLinearDamping",SetAngularDaming:"SetAngularDaming",SetInertiaTensor:"SetInertiaTensor",SetIsKinematic:"SetIsKinematic",SetConstraints:"SetConstraints",SetCollisionDetectionMode:"SetCollisionDetectionMode",SetSleepThreshold:"SetSleepThreshold",SetSleep:"SetSleep",SetWakeup:"SetWakeup",AddShape:"AddShape",RemoveShape:"RemoveShape",DisableGravity:"DisableGravity"},a={CreateShape:"CreateShape",ReleaseShape:"ReleaseShape",SetLocalPosition:"SetLocalPosition",SetLocalRotation:"SetLocalRotation",SetIsTrigger:"SetIsTrigger",SetMaterial:"SetMaterial",SetGeometry:"SetGeometry"},n={CreateMaterial:"CreateMaterial",ReleaseMaterial:"ReleaseMaterial",SetStaticFriction:"SetStaticFriction",SetDynamicFriction:"SetDynamicFriction",SetRestitution:"SetRestitution"},l={CreateGeometry:"CreateGeometry",ReleaseGeometry:"ReleaseGeometry",SetBoxSize:"SetBoxSize",SetSphereRadius:"SetSphereRadius",SetCapsuleRadius:"SetCapsuleRadius",SetCapsuleHeight:"SetCapsuleHeight",SetPlaneRotation:"SetPlaneRotation",SetConvexMeshScale:"SetConvexMeshScale",SetTriangleMeshScale:"SetTriangleMeshScale"},c={CreateController:"CreateController",ReleaseController:"ReleaseController",SetCapsuleRaidus:"SetCapsuleRaidus",SetCapsuleHeight:"SetCapsuleHeight",MoveController:"MoveController",ControllerJump:"ControllerJump",DisableControllerGravity:"DisableControllerGravity",SetCameraForward:"SetCameraForward",SetCameraDistanceScale:"SetCameraDistanceScale",OnControllerEvent:"OnControllerEvent",ControllerEventType:{OnJumping:"OnJumping",OnFalling:"OnFalling",OnFalled:"OnFalled",OnFinishJump:"OnFinishJump"}},h={CreateDistanceJoint:"CreateDistanceJoint",CreateFixedJoint:"CreateFixedJoint",CreateRevoluteJoint:"CreateRevoluteJoint",CreateSphericalJoint:"CreateSphericalJoint",CreatePrismaticJoint:"CreatePrismaticJoint",CreateD6Joint:"CreateD6Joint",SetActors:"SetActors",SetLocalPose:"SetLocalPose",SetBreakForce:"SetBreakForce",ReleaseJoint:"ReleaseJoint",InvMassScale0:"InvMassScale0",InvInertiaScale0:"InvInertiaScale0",InvMassScale1:"InvMassScale1",InvInertiaScale1:"InvInertiaScale1",SetMinDistance:"SetMinDistance",SetMaxDistance:"SetMaxDistance",SetTolerance:"SetTolerance",SetStiffness:"SetStiffness",SetDamping:"SetDamping",SetProjectionLinearTolerance:"SetProjectionLinearTolerance",SetProjectionAngularTolerance:"SetProjectionAngularTolerance",SetHardLimit:"SetHardLimit",SetSoftLimit:"SetSoftLimit",SetDriveVelocity:"SetDriveVelocity",SetDriveForceLimit:"SetDriveForceLimit",SetDriveGearRatio:"SetDriveGearRatio",SetRevoluteDrive:"SetRevoluteDrive",SetHardLimitCone:"SetHardLimitCone",SetSoftLimitCone:"SetSoftLimitCone",SetHardLimitPri:"SetHardLimitPri",SetSoftLimitPri:"SetSoftLimitPri",SetMotion:"SetMotion",SetHardDistanceLimit:"SetHardDistanceLimit",SetSoftDistanceLimit:"SetSoftDistanceLimit",SetHardLinearLimit:"SetHardLinearLimit",SetSoftLinearLimit:"SetSoftLinearLimit",SetHardTwistLimit:"SetHardTwistLimit",SetSoftTwistLimit:"SetSoftTwistLimit",SetHardSwingLimit:"SetHardSwingLimit",SetSoftSwingLimit:"SetSoftSwingLimit",SetHardPyramidSwingLimit:"SetHardPyramidSwingLimit",SetSoftPyramidSwingLimit:"SetSoftPyramidSwingLimit",SetDrive:"SetDrive",SetDriveVelocityD6:"SetDriveVelocityD6",SetDrivePosition:"SetDrivePosition"}},"./src/core/PhysXCore.js":(t,e,i)=>{"use strict";i.d(e,{PhysXCore:()=>r});var s=i("../../node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=i("./src/core/Functions.js");class r{constructor(t){this._physX=null,this._pxPhysics=null,this._pxDesc=null,this._eventCallback=null}loadLibrary(t,e,i){return(0,s.default)((function*(){var t="release",e="nvphysx.js",o="./"+e+"/"+t+"/physx."+t+".js",r="./"+e+"/"+t+"/physx."+t+".wasm";if(i){yield importScripts(o);var a=yield new self.PHYSX({locateFile:function(){return r}});return Promise.resolve(a)}return new Promise((function(t,e){var i=document.scripts,a="";for(var n in i)if(i[n].src.indexOf("thing.nvphysx.js")>0){a=i[n].src;break}if(a){var l=document.createElement("script"),c=a.replace("thing.nvphysx.js","")+o,h=a.replace("thing.nvphysx.js","")+r;l.src=c,l.onload=(0,s.default)((function*(){var e=yield new self.PHYSX({locateFile:function(){return h}});t(e)})),document.head.append(l)}}))}))()}createFoundation(t){var e=t.PX_PHYSICS_VERSION,i=new t.PxDefaultErrorCallback,s=new t.PxDefaultAllocator;return t.PxCreateFoundation(e,s,i)}createDebuggerProxy(t){var e=null,i=[];return{connect:function(){return(e=new WebSocket("ws://127.0.0.1:5426",["binary"])).onopen=()=>{console.log("Connected to PhysX Debugger"),i.forEach((t=>e.send(t))),i=[]},e.onclose=()=>{console.log("Socket disconnect"),i=null,e=null},!0},disconnect:function(){console.log("Disconnect Debugger"),e&&e.close()},write:function(s,o){if(e){var r=t.HEAPU8.slice(s,s+o);e.readyState===WebSocket.OPEN?(i.length&&(i.forEach((t=>e.send(t))),i.length=0),e.send(r)):i.push(r)}return!0}}}connectToDebugger(t,e){var i=this.createDebuggerProxy(t),s=t.PxPvdTransport.implement(i),o=t.PxCreatePvd(e);return o.connect(s,new t.PxPvdInstrumentationFlags(t.PxPvdInstrumentationFlag.eALL.value)),o}createPhysics(t,e,i){var s=t.PxCreatePhysics(t.PX_PHYSICS_VERSION,e,new t.PxTolerancesScale,!1,i);return t.PxInitExtensions(s,i),s}createTriggerCallback(){var t=this,e={onContactBegin:function(e,i,s,r){t.onEventCallback(o.PhysXGlobalFunction.OnContactBegin,{actor0:e,shape0:i,actor1:s,shape1:r})},onContactEnd:function(e,i,s,r){t.onEventCallback(o.PhysXGlobalFunction.OnContactEnd,{actor0:e,shape0:i,actor1:s,shape1:r})}};return this._physX.PxSimulationEventCallback.implement(e)}getDefaultSceneDesc(t,e){return t.getDefaultSceneDesc(e.getTolerancesScale(),0,this.createTriggerCallback())}init(t){var e=this;return(0,s.default)((function*(){var i=t.enablePVD,s=t.physXPath||"../physx.js",o=t.enableWorker;e._physX||(e._physX=yield e.loadLibrary(i,s,o));var r=e._physX;e._foundation||(e._foundation=e.createFoundation(r));var a=e._foundation,n=e._pvd=i?e.connectToDebugger(r,a):null;e._pxPhysics=e.createPhysics(r,a,n),e._pxDesc=e.getDefaultSceneDesc(r,e._pxPhysics)}))()}onEventCallback(t,e){this._eventCallback&&this._eventCallback(t,e)}setEventCallback(t){this._eventCallback=t}static getInstance(){return r.instance}release(){this._pxPhysics&&(this._pxDesc=null,this._physX.PxCloseExtensions(),this._pxPhysics.release(),this._pxPhysics=null,this._pvd&&(this._pvd.disconnect(),this._pvd.release(),this._pvd=null))}}r.instance=new r},"./src/core/Utils.js":(t,e,i)=>{"use strict";function s(t){return{x:t[0],y:t[1],z:t[2]}}function o(t){return[t.x,t.y,t.z]}function r(t){return{x:t[0],y:t[1],z:t[2],w:t[3]}}function a(t){return[t.x,t.y,t.z,t.w]}function n(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function l(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}function c(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function h(t,e){var i=t[0]-e[0],s=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(i*i+s*s+o*o)}function d(t,e){var i,s,o,r,a,n;return i=[0,0,0],(n=(o=(s=c(e,t))[0])*o+(r=s[1])*r+(a=s[2])*a)>0&&(n=1/Math.sqrt(n)),i[0]=s[0]*n,i[1]=s[1]*n,i[2]=s[2]*n,i}i.d(e,{addVector:()=>l,arrayToQuat:()=>r,arrayToVector3:()=>s,getDirection:()=>d,getDistance:()=>h,quatToArray:()=>a,scaleVector:()=>n,subVector:()=>c,vector3ToArray:()=>o})},"./src/core/actor/PhysXActor.js":(t,e,i)=>{"use strict";i.r(e),i.d(e,{PhysXActor:()=>r});var s=i("./src/core/PhysXCore.js"),o=i("./src/core/Utils.js");class r{constructor(){this._pxActor=null,this._physXCore=s.PhysXCore.getInstance(),this._id=0,this._scene=null}setUniqueID(t){this._id=t,this.setName(this._id.toString()),this._pxActor.setId(t)}id(){return this._id}addShape(t){this._pxActor.attachShape(t._pxShape)}removeShape(t){this._pxActor.detachShape(t._pxShape,!0)}setWroldTransform(t,e){this._pxActor.setGlobalPose({translation:(0,o.arrayToVector3)(t),rotation:(0,o.arrayToQuat)(e)},!0)}disableGravity(t){this._pxActor.setActorFlag(this._physXCore._physX.PxActorFlag.eDISABLE_GRAVITY,t)}disable(){this._pxActor.setActorFlag(this._physXCore._physX.PxActorFlag.eDISABLE_SIMULATION,!0)}enable(){this._pxActor.setActorFlag(this._physXCore._physX.PxActorFlag.eDISABLE_SIMULATION,!1)}getWorldTransform(){var t=this._pxActor.getGlobalPose();return{position:(0,o.vector3ToArray)(t.translation),rotation:(0,o.quatToArray)(t.rotation)}}copyWorldTransformArray(t,e){var i=this._physXCore._physX._malloc(28),s=new Float32Array(this._physXCore._physX.HEAPU8.buffer,i,7);this._pxActor.copyGlobalPose(i),t.set(s,e),this._physXCore._physX._free(i)}setName(t){this._pxActor.setName&&this._pxActor.setName(t)}get scene(){return this._scene}set scene(t){this._scene=t}release(){this._pxActor&&(this._pxActor.release(),this._pxActor.delete(),this._pxActor=null)}}},"./src/core/joint/PhysXJoint.js":(t,e,i)=>{"use strict";i.r(e),i.d(e,{PhysXJoint:()=>r});var s=i("./src/core/PhysXCore.js"),o=i("./src/core/Utils.js");class r{constructor(){this._pxJoint=null,this._physXCore=s.PhysXCore.getInstance(),this._id=0,this._scene=null,this._invMassScale0=1,this._invInertiaScale0=1,this._invMassScale1=1,this._invInertiaScale1=1}setUniqueID(t){this._id=t,this.setName(this._id.toString())}id(){return this._id}get invMassScale0(){return this._invMassScale0}set invMassScale0(t){this._pxJoint.setInvMassScale0(t)}get invInertiaScale0(){return this._invInertiaScale0}set invInertiaScale0(t){this._pxJoint.setInvInertiaScale0(t)}get invMassScale1(){return this._invMassScale1}set invMassScale1(t){this._pxJoint.setInvMassScale1(t)}get invInertiaScale1(){return this._invInertiaScale1}set invInertiaScale1(t){this._pxJoint.setInvInertiaScale1(t)}setName(t){this._pxJoint.setName&&this._pxJoint.setName(t)}setActors(t,e){this._pxJoint.setActors(t._pxActor,e._pxActor)}setLocalPose(t,e,i){this._pxJoint.setLocalPose(t,(0,o.arrayToVector3)(e),(0,o.arrayToQuat)(i))}setBreakForce(t,e){this._pxJoint.setBreakForce(t,e),this._pxJoint.setConstraintFlag(1,!0)}setFlagProjection(t){this._pxJoint.setConstraintFlag(6,t)}setFlagDriverLimitsAreForces(t){this._pxJoint.setConstraintFlag(32,t)}setFlagVisualization(t){this._pxJoint.setConstraintFlag(16,t)}setFlagCollisionEnabled(t){this._pxJoint.setConstraintFlag(8,t)}release(){this._pxJoint.release()}}},"../../node_modules/.pnpm/debug@3.2.7_supports-color@6.1.0/node_modules/debug/src/browser.js":(t,e,i)=>{"use strict";function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}e.log=function(){var t;return"object"===("undefined"==typeof console?"undefined":s(console))&&console.log&&(t=console).log.apply(t,arguments)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),this.useColors){var i="color: "+this.color;e.splice(1,0,i,"color: inherit");var s=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(s++,"%c"===t&&(o=s))})),e.splice(o,0,i)}},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){var t;try{t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=i("../../node_modules/.pnpm/debug@3.2.7_supports-color@6.1.0/node_modules/debug/src/common.js")(e),t.exports.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},"../../node_modules/.pnpm/debug@3.2.7_supports-color@6.1.0/node_modules/debug/src/common.js":(t,e,i)=>{"use strict";t.exports=function(t){function e(t){for(var e=0,i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return s.colors[Math.abs(e)%s.colors.length]}function s(t){var i;function a(){if(a.enabled){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];var r=a,n=Number(new Date),l=n-(i||n);r.diff=l,r.prev=i,r.curr=n,i=n,e[0]=s.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");var c=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(function(t,i){if("%%"===t)return t;c++;var o=s.formatters[i];if("function"==typeof o){var a=e[c];t=o.call(r,a),e.splice(c,1),c--}return t})),s.formatArgs.call(r,e),(r.log||s.log).apply(r,e)}}return a.namespace=t,a.enabled=s.enabled(t),a.useColors=s.useColors(),a.color=e(t),a.destroy=o,a.extend=r,"function"==typeof s.init&&s.init(a),s.instances.push(a),a}function o(){var t=s.instances.indexOf(this);return-1!==t&&(s.instances.splice(t,1),!0)}function r(t,e){return s(this.namespace+(void 0===e?":":e)+t)}return s.debug=s,s.default=s,s.coerce=function(t){return t instanceof Error?t.stack||t.message:t},s.disable=function(){s.enable("")},s.enable=function(t){var e;s.save(t),s.names=[],s.skips=[];var i=("string"==typeof t?t:"").split(/[\s,]+/),o=i.length;for(e=0;e<o;e++)i[e]&&("-"===(t=i[e].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+t.substr(1)+"$")):s.names.push(new RegExp("^"+t+"$")));for(e=0;e<s.instances.length;e++){var r=s.instances[e];r.enabled=s.enabled(r.namespace)}},s.enabled=function(t){if("*"===t[t.length-1])return!0;var e,i;for(e=0,i=s.skips.length;e<i;e++)if(s.skips[e].test(t))return!1;for(e=0,i=s.names.length;e<i;e++)if(s.names[e].test(t))return!0;return!1},s.humanize=i("../../node_modules/.pnpm/ms@2.1.3/node_modules/ms/index.js"),Object.keys(t).forEach((function(e){s[e]=t[e]})),s.instances=[],s.names=[],s.skips=[],s.formatters={},s.selectColor=e,s.enable(s.load()),s}},"../../node_modules/.pnpm/get-plane-normal@1.0.0/node_modules/get-plane-normal/index.js":(t,e,i)=>{var s=i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/normalize.js"),o=i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/subtract.js"),r=i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/cross.js"),a=[0,0,0];t.exports=function(t,e,i,n){return o(t,e,i),o(a,i,n),r(t,t,a),s(t,t)}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/add.js":t=>{t.exports=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/copy.js":t=>{t.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/cross.js":t=>{t.exports=function(t,e,i){var s=e[0],o=e[1],r=e[2],a=i[0],n=i[1],l=i[2];return t[0]=o*l-r*n,t[1]=r*a-s*l,t[2]=s*n-o*a,t}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/distance.js":t=>{t.exports=function(t,e){var i=e[0]-t[0],s=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(i*i+s*s+o*o)}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/dot.js":t=>{t.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/length.js":t=>{t.exports=function(t){var e=t[0],i=t[1],s=t[2];return Math.sqrt(e*e+i*i+s*s)}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/normalize.js":t=>{t.exports=function(t,e){var i=e[0],s=e[1],o=e[2],r=i*i+s*s+o*o;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r),t}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/scale.js":t=>{t.exports=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/scaleAndAdd.js":t=>{t.exports=function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t[2]=e[2]+i[2]*s,t}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/squaredDistance.js":t=>{t.exports=function(t,e){var i=e[0]-t[0],s=e[1]-t[1],o=e[2]-t[2];return i*i+s*s+o*o}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/squaredLength.js":t=>{t.exports=function(t){var e=t[0],i=t[1],s=t[2];return e*e+i*i+s*s}},"../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/subtract.js":t=>{t.exports=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}},"../../node_modules/.pnpm/ms@2.1.3/node_modules/ms/index.js":t=>{var e=1e3,i=60*e,s=60*i,o=24*s;function r(t,e,i,s){var o=e>=1.5*i;return Math.round(t/i)+" "+s+(o?"s":"")}t.exports=function(t,a){a=a||{};var n,l,c=typeof t;if("string"===c&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(r){var a=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*s;case"minutes":case"minute":case"mins":case"min":case"m":return a*i;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===c&&isFinite(t))return a.long?(n=t,(l=Math.abs(n))>=o?r(n,l,o,"day"):l>=s?r(n,l,s,"hour"):l>=i?r(n,l,i,"minute"):l>=e?r(n,l,e,"second"):n+" ms"):function(t){var r=Math.abs(t);return r>=o?Math.round(t/o)+"d":r>=s?Math.round(t/s)+"h":r>=i?Math.round(t/i)+"m":r>=e?Math.round(t/e)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},"../../node_modules/.pnpm/point-line-distance@1.0.0/node_modules/point-line-distance/index.js":(t,e,i)=>{"use strict";var s=i("../../node_modules/.pnpm/point-line-distance@1.0.0/node_modules/point-line-distance/squared.js");t.exports=function(t,e,i){return Math.sqrt(s(t,e,i))}},"../../node_modules/.pnpm/point-line-distance@1.0.0/node_modules/point-line-distance/squared.js":(t,e,i)=>{var s=i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/subtract.js"),o=i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/cross.js"),r=i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/squaredLength.js"),a=[],n=[],l=[];t.exports=function(t,e,i){s(a,i,e),s(n,t,e);var c=r(o(l,n,a)),h=r(a);if(0===h)throw Error("a and b are the same point");return c/h}},"../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/Face.js":(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DELETED=e.NON_CONVEX=e.VISIBLE=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/dot.js")),r=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/add.js")),a=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/subtract.js")),n=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/cross.js")),l=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/copy.js")),c=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/length.js")),h=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/scale.js")),d=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/scaleAndAdd.js")),u=p(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/normalize.js")),_=p(i("../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/HalfEdge.js"));function p(t){return t&&t.__esModule?t:{default:t}}var m=i("../../node_modules/.pnpm/debug@3.2.7_supports-color@6.1.0/node_modules/debug/src/browser.js")("face"),g=e.VISIBLE=0,y=(e.NON_CONVEX=1,e.DELETED=2),v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=g,this.edge=null,this.nVertices=0}return s(t,[{key:"getEdge",value:function(t){if("number"!=typeof t)throw Error("requires a number");for(var e=this.edge;t>0;)e=e.next,t-=1;for(;t<0;)e=e.prev,t+=1;return e}},{key:"computeNormal",value:function(){var t=this.edge,e=t.next,i=e.next,s=(0,a.default)([],e.head().point,t.head().point),o=[],d=[];for(this.nVertices=2,this.normal=[0,0,0];i!==t;)(0,l.default)(d,s),(0,a.default)(s,i.head().point,t.head().point),(0,r.default)(this.normal,this.normal,(0,n.default)(o,d,s)),i=i.next,this.nVertices+=1;this.area=(0,c.default)(this.normal),this.normal=(0,h.default)(this.normal,this.normal,1/this.area)}},{key:"computeNormalMinArea",value:function(t){if(this.computeNormal(),this.area<t){var e=void 0,i=0,s=this.edge;do{var r=s.lengthSquared();r>i&&(e=s,i=r),s=s.next}while(s!==this.edge);var n=e.tail().point,l=e.head().point,c=(0,a.default)([],l,n),_=Math.sqrt(i);(0,h.default)(c,c,1/_);var p=(0,o.default)(this.normal,c);(0,d.default)(this.normal,this.normal,c,-p),(0,u.default)(this.normal,this.normal)}}},{key:"computeCentroid",value:function(){this.centroid=[0,0,0];var t=this.edge;do{(0,r.default)(this.centroid,this.centroid,t.head().point),t=t.next}while(t!==this.edge);(0,h.default)(this.centroid,this.centroid,1/this.nVertices)}},{key:"computeNormalAndCentroid",value:function(t){void 0!==t?this.computeNormalMinArea(t):this.computeNormal(),this.computeCentroid(),this.offset=(0,o.default)(this.normal,this.centroid)}},{key:"distanceToPlane",value:function(t){return(0,o.default)(this.normal,t)-this.offset}},{key:"connectHalfEdges",value:function(t,e){var i=void 0;if(t.opposite.face===e.opposite.face){var s=e.opposite.face,o=void 0;t===this.edge&&(this.edge=e),3===s.nVertices?(o=e.opposite.prev.opposite,s.mark=y,i=s):(o=e.opposite.next,s.edge===o.prev&&(s.edge=o),o.prev=o.prev.prev,o.prev.next=o),e.prev=t.prev,e.prev.next=e,e.setOpposite(o),s.computeNormalAndCentroid()}else t.next=e,e.prev=t;return i}},{key:"mergeAdjacentFaces",value:function(t,e){var i=t.opposite,s=i.face;e.push(s),s.mark=y;for(var o=t.prev,r=t.next,a=i.prev,n=i.next;o.opposite.face===s;)o=o.prev,n=n.next;for(;r.opposite.face===s;)r=r.next,a=a.prev;var l=void 0;for(l=n;l!==a.next;l=l.next)l.face=this;this.edge=r;var c=void 0;return(c=this.connectHalfEdges(a,r))&&e.push(c),(c=this.connectHalfEdges(o,n))&&e.push(c),this.computeNormalAndCentroid(),e}},{key:"collectIndices",value:function(){var t=[],e=this.edge;do{t.push(e.head().index),e=e.next}while(e!==this.edge);return t}}],[{key:"createTriangle",value:function(e,i,s){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=new t,a=new _.default(e,r),n=new _.default(i,r),l=new _.default(s,r);return a.next=l.prev=n,n.next=a.prev=l,l.next=n.prev=a,r.edge=a,r.computeNormalAndCentroid(o),m.enabled&&m("face created %j",r.collectIndices()),r}}]),t}();e.default=v},"../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/HalfEdge.js":(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=a(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/distance.js")),r=a(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/squaredDistance.js"));function a(t){return t&&t.__esModule?t:{default:t}}var n=i("../../node_modules/.pnpm/debug@3.2.7_supports-color@6.1.0/node_modules/debug/src/browser.js")("halfedge"),l=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.vertex=e,this.face=i,this.next=null,this.prev=null,this.opposite=null}return s(t,[{key:"head",value:function(){return this.vertex}},{key:"tail",value:function(){return this.prev?this.prev.vertex:null}},{key:"length",value:function(){return this.tail()?(0,o.default)(this.tail().point,this.head().point):-1}},{key:"lengthSquared",value:function(){return this.tail()?(0,r.default)(this.tail().point,this.head().point):-1}},{key:"setOpposite",value:function(t){var e=this;n.enabled&&n("opposite "+e.tail().index+" <--\x3e "+e.head().index+" between "+e.face.collectIndices()+", "+t.face.collectIndices()),this.opposite=t,t.opposite=this}}]),t}();e.default=l,t.exports=e.default},"../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/QuickHull.js":(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=d(i("../../node_modules/.pnpm/point-line-distance@1.0.0/node_modules/point-line-distance/index.js")),r=d(i("../../node_modules/.pnpm/get-plane-normal@1.0.0/node_modules/get-plane-normal/index.js")),a=d(i("../../node_modules/.pnpm/gl-vec3@1.1.3/node_modules/gl-vec3/dot.js")),n=d(i("../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/VertexList.js")),l=d(i("../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/Vertex.js")),c=i("../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/Face.js"),h=d(c);function d(t){return t&&t.__esModule?t:{default:t}}var u=i("../../node_modules/.pnpm/debug@3.2.7_supports-color@6.1.0/node_modules/debug/src/browser.js")("quickhull"),_=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=e.length,this.faces=[],this.newFaces=[],this.claimed=new n.default,this.unclaimed=new n.default,this.vertices=[];for(var i=0;i<e.length;i+=1)this.vertices.push(new l.default(e[i],i));this.discardedFaces=[],this.vertexPointIndices=[]}return s(t,[{key:"addVertexToFace",value:function(t,e){t.face=e,e.outside?this.claimed.insertBefore(e.outside,t):this.claimed.add(t),e.outside=t}},{key:"removeVertexFromFace",value:function(t,e){t===e.outside&&(t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.claimed.remove(t)}},{key:"removeAllVerticesFromFace",value:function(t){if(t.outside){for(var e=t.outside;e.next&&e.next.face===t;)e=e.next;return this.claimed.removeChain(t.outside,e),e.next=null,t.outside}}},{key:"deleteFaceVertices",value:function(t,e){var i=this.removeAllVerticesFromFace(t);if(i)if(e)for(var s=void 0,o=i;o;o=s)s=o.next,e.distanceToPlane(o.point)>this.tolerance?this.addVertexToFace(o,e):this.unclaimed.add(o);else this.unclaimed.addAll(i)}},{key:"resolveUnclaimedPoints",value:function(t){for(var e=this.unclaimed.first(),i=e;i;i=e){e=i.next;for(var s=this.tolerance,o=void 0,r=0;r<t.length;r+=1){var a=t[r];if(a.mark===c.VISIBLE){var n=a.distanceToPlane(i.point);if(n>s&&(s=n,o=a),s>1e3*this.tolerance)break}}o&&this.addVertexToFace(i,o)}}},{key:"computeExtremes",value:function(){var t=[],e=[],i=[],s=[],o=void 0,r=void 0;for(o=0;o<3;o+=1)i[o]=s[o]=this.vertices[0];for(o=0;o<3;o+=1)t[o]=e[o]=this.vertices[0].point[o];for(o=1;o<this.vertices.length;o+=1){var a=this.vertices[o],n=a.point;for(r=0;r<3;r+=1)n[r]<t[r]&&(t[r]=n[r],i[r]=a);for(r=0;r<3;r+=1)n[r]>e[r]&&(e[r]=n[r],s[r]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t[0]),Math.abs(e[0]))+Math.max(Math.abs(t[1]),Math.abs(e[1]))+Math.max(Math.abs(t[2]),Math.abs(e[2]))),u.enabled&&u("tolerance %d",this.tolerance),[i,s]}},{key:"createInitialSimplex",value:function(){var t,e,i=this.vertices,s=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],s=!0,o=!1,r=void 0;try{for(var a,n=t[Symbol.iterator]();!(s=(a=n.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,r=t}finally{try{!s&&n.return&&n.return()}finally{if(o)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(this.computeExtremes(),2),n=s[0],l=s[1],c=void 0,d=void 0,u=void 0,_=void 0,p=0,m=0;for(u=0;u<3;u+=1){var g=l[u].point[u]-n[u].point[u];g>p&&(p=g,m=u)}for(t=n[m],e=l[m],p=0,u=0;u<this.vertices.length;u+=1){var y=this.vertices[u];if(y!==t&&y!==e){var v=(0,o.default)(y.point,t.point,e.point);v>p&&(p=v,c=y)}}var f=(0,r.default)([],t.point,e.point,c.point),S=(0,a.default)(t.point,f);for(p=-1,u=0;u<this.vertices.length;u+=1){var C=this.vertices[u];if(C!==t&&C!==e&&C!==c){var x=Math.abs((0,a.default)(f,C.point)-S);x>p&&(p=x,d=C)}}var P=[];if((0,a.default)(d.point,f)-S<0)for(P.push(h.default.createTriangle(t,e,c),h.default.createTriangle(d,e,t),h.default.createTriangle(d,c,e),h.default.createTriangle(d,t,c)),u=0;u<3;u+=1){var L=(u+1)%3;P[u+1].getEdge(2).setOpposite(P[0].getEdge(L)),P[u+1].getEdge(1).setOpposite(P[L+1].getEdge(0))}else for(P.push(h.default.createTriangle(t,c,e),h.default.createTriangle(d,t,e),h.default.createTriangle(d,e,c),h.default.createTriangle(d,c,t)),u=0;u<3;u+=1){var T=(u+1)%3;P[u+1].getEdge(2).setOpposite(P[0].getEdge((3-u)%3)),P[u+1].getEdge(0).setOpposite(P[T+1].getEdge(1))}for(u=0;u<4;u+=1)this.faces.push(P[u]);for(u=0;u<i.length;u+=1){var F=i[u];if(F!==t&&F!==e&&F!==c&&F!==d){p=this.tolerance;var b=void 0;for(_=0;_<4;_+=1){var M=P[_].distanceToPlane(F.point);M>p&&(p=M,b=P[_])}b&&this.addVertexToFace(F,b)}}}},{key:"reindexFaceAndVertices",value:function(){for(var t=[],e=0;e<this.faces.length;e+=1){var i=this.faces[e];i.mark===c.VISIBLE&&t.push(i)}this.faces=t}},{key:"collectFaces",value:function(t){for(var e=[],i=0;i<this.faces.length;i+=1){if(this.faces[i].mark!==c.VISIBLE)throw Error("attempt to include a destroyed face in the hull");var s=this.faces[i].collectIndices();if(t)e.push(s);else for(var o=0;o<s.length-2;o+=1)e.push([s[0],s[o+1],s[o+2]])}return e}},{key:"nextVertexToAdd",value:function(){if(!this.claimed.isEmpty()){var t=void 0,e=void 0,i=0,s=this.claimed.first().face;for(e=s.outside;e&&e.face===s;e=e.next){var o=s.distanceToPlane(e.point);o>i&&(i=o,t=e)}return t}}},{key:"computeHorizon",value:function(t,e,i,s){this.deleteFaceVertices(i),i.mark=c.DELETED;var o=void 0;o=e?e.next:e=i.getEdge(0);do{var r=o.opposite,a=r.face;a.mark===c.VISIBLE&&(a.distanceToPlane(t)>this.tolerance?this.computeHorizon(t,r,a,s):s.push(o)),o=o.next}while(o!==e)}},{key:"addAdjoiningFace",value:function(t,e){var i=h.default.createTriangle(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setOpposite(e.opposite),i.getEdge(0)}},{key:"addNewFaces",value:function(t,e){this.newFaces=[];for(var i=void 0,s=void 0,o=0;o<e.length;o+=1){var r=e[o],a=this.addAdjoiningFace(t,r);i?a.next.setOpposite(s):i=a,this.newFaces.push(a.face),s=a}i.next.setOpposite(s)}},{key:"oppositeFaceDistance",value:function(t){return t.face.distanceToPlane(t.opposite.face.centroid)}},{key:"doAdjacentMerge",value:function(t,e){var i=t.edge,s=!0,o=0;do{if(o>=t.nVertices)throw Error("merge recursion limit exceeded");var r=i.opposite.face,a=!1;if(2===e?(this.oppositeFaceDistance(i)>-this.tolerance||this.oppositeFaceDistance(i.opposite)>-this.tolerance)&&(a=!0):t.area>r.area?this.oppositeFaceDistance(i)>-this.tolerance?a=!0:this.oppositeFaceDistance(i.opposite)>-this.tolerance&&(s=!1):this.oppositeFaceDistance(i.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(i)>-this.tolerance&&(s=!1),a){u("face merge");for(var n=t.mergeAdjacentFaces(i,[]),l=0;l<n.length;l+=1)this.deleteFaceVertices(n[l],t);return!0}i=i.next,o+=1}while(i!==t.edge);return s||(t.mark=c.NON_CONVEX),!1}},{key:"addVertexToHull",value:function(t){var e=[];this.unclaimed.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),u.enabled&&u("horizon %j",e.map((function(t){return t.head().index}))),this.addNewFaces(t,e),u("first merge");for(var i=0;i<this.newFaces.length;i+=1){var s=this.newFaces[i];if(s.mark===c.VISIBLE)for(;this.doAdjacentMerge(s,1););}u("second merge");for(var o=0;o<this.newFaces.length;o+=1){var r=this.newFaces[o];if(r.mark===c.NON_CONVEX)for(r.mark=c.VISIBLE;this.doAdjacentMerge(r,2););}u("reassigning points to newFaces"),this.resolveUnclaimedPoints(this.newFaces)}},{key:"build",value:function(){var t=0,e=void 0;for(this.createInitialSimplex();e=this.nextVertexToAdd();)u("== iteration %j ==",t+=1),u("next vertex to add = %d %j",e.index,e.point),this.addVertexToHull(e),u("end");this.reindexFaceAndVertices()}}]),t}();e.default=_,t.exports=e.default},"../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/Vertex.js":(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.point=e,this.index=i,this.next=null,this.prev=null,this.face=null},t.exports=e.default},"../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/VertexList.js":(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null}return i(t,[{key:"clear",value:function(){this.head=this.tail=null}},{key:"insertBefore",value:function(t,e){e.prev=t.prev,e.next=t,e.prev?e.prev.next=e:this.head=e,t.prev=e}},{key:"insertAfter",value:function(t,e){e.prev=t,e.next=t.next,e.next?e.next.prev=e:this.tail=e,t.next=e}},{key:"add",value:function(t){this.head?this.tail.next=t:this.head=t,t.prev=this.tail,t.next=null,this.tail=t}},{key:"addAll",value:function(t){for(this.head?this.tail.next=t:this.head=t,t.prev=this.tail;t.next;)t=t.next;this.tail=t}},{key:"remove",value:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev}},{key:"removeChain",value:function(t,e){t.prev?t.prev.next=e.next:this.head=e.next,e.next?e.next.prev=t.prev:this.tail=t.prev}},{key:"first",value:function(){return this.head}},{key:"isEmpty",value:function(){return!this.head}}]),t}();e.default=s,t.exports=e.default},"../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/index.js":(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new o.default(t);return i.build(),i.collectFaces(e.skipTriangulation)};var s,o=(s=i("../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/QuickHull.js"))&&s.__esModule?s:{default:s};t.exports=e.default},"@uino/thing":e=>{"use strict";e.exports=t},"@uino/base-thing":t=>{"use strict";t.exports=e},"../../node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js":(t,e,i)=>{"use strict";function s(t,e,i,s,o,r,a){try{var n=t[r](a),l=n.value}catch(t){return void i(t)}n.done?e(l):Promise.resolve(l).then(s,o)}function o(t){return function(){var e=this,i=arguments;return new Promise((function(o,r){var a=t.apply(e,i);function n(t){s(a,o,r,n,l,"next",t)}function l(t){s(a,o,r,n,l,"throw",t)}n(void 0)}))}}i.d(e,{default:()=>o})}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var r=s[t]={exports:{}};return i[t](r,r.exports,o),r.exports}o.m=i,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.u=t=>t+".thing.nvphysx.min.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&!t;)t=i[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),o.b=document.baseURI||self.location.href;var r={};return(()=>{"use strict";o.r(r),o.d(r,{BoxColliderShape:()=>Ct,CapsuleColliderShape:()=>xt,ConvexMeshColliderShape:()=>Tt,D6Axis:()=>s,D6Motion:()=>a,DynamicColliderComponent:()=>pt,EventType:()=>t,FirstPersonAnimateState:()=>i,FirstPersonComponent:()=>rt,FirstPersonEventType:()=>e,OBBColliderShape:()=>bt,PhysicsBoxGeometry:()=>mt,PhysicsCapsuleController:()=>st,PhysicsCapsuleGeometry:()=>gt,PhysicsConvexMeshGeometry:()=>ft,PhysicsD6Joint:()=>Rt,PhysicsDistanceJoint:()=>At,PhysicsFixedJoint:()=>kt,PhysicsGeometry:()=>ht,PhysicsJoint:()=>Mt,PhysicsMaterial:()=>tt,PhysicsPlaneGeometry:()=>ut,PhysicsPrismaticJoint:()=>Dt,PhysicsRevoluteJoint:()=>wt,PhysicsShape:()=>et,PhysicsSphereGeometry:()=>St,PhysicsSphericalJoint:()=>Xt,PhysicsTriangleMeshGeometry:()=>dt,PhysicsWorldComponent:()=>Z,PlaneColliderShape:()=>Pt,SphereColliderShape:()=>Lt,StaticColliderComponent:()=>ct,TriangleMeshColliderShape:()=>Ft,VERSION:()=>n});var t={ColliderTriggerEnter:"ColliderTriggerEnter",ColliderTriggerLeave:"ColliderTriggerLeave",ColliderContactBegin:"ColliderContactBegin",ColliderContactEnd:"ColliderContactEnd"},e={ChangeMoveDirection:"ChangeMoveDirection",ChangeAnimation:"ChangeAnimation"},i={Idle:"Idle",Walk:"Walk",Run:"Run",Jump:"Jump",WalkJump:"WalkJump"},s={LinearX:0,LinearY:1,LinearZ:2,AngularX:3,AngularY:4,AngularZ:5},a={Locked:0,Limited:1,Free:2},n="1.1.1",l=o("../../node_modules/.pnpm/@babel+runtime@7.22.5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),c=o("@uino/thing");class h{static determinant(t){var e=t,i=e[0],s=e[4],o=e[8],r=e[12],a=e[1],n=e[5],l=e[9],c=e[13],h=e[2],d=e[6],u=e[10],_=e[14];return e[3]*(+r*l*d-o*c*d-r*n*u+s*c*u+o*n*_-s*l*_)+e[7]*(+i*l*_-i*c*u+r*a*u-o*a*_+o*c*h-r*l*h)+e[11]*(+i*c*d-i*n*_-r*a*d+s*a*_+r*n*h-s*c*h)+e[15]*(-o*n*h-i*l*d+i*n*u+o*a*d-s*a*u+s*l*h)}static setFromRotationMatrix(t,e){var i,s=t,o=s[0],r=s[4],a=s[8],n=s[1],l=s[5],c=s[9],h=s[2],d=s[6],u=s[10],_=o+l+u;_>0?(i=.5/Math.sqrt(_+1),e[3]=.25/i,e[0]=(d-c)*i,e[1]=(a-h)*i,e[2]=(n-r)*i):o>l&&o>u?(i=2*Math.sqrt(1+o-l-u),e[3]=(d-c)/i,e[0]=.25*i,e[1]=(r+n)/i,e[2]=(a+h)/i):l>u?(i=2*Math.sqrt(1+l-o-u),e[3]=(a-h)/i,e[0]=(r+n)/i,e[1]=.25*i,e[2]=(c+d)/i):(i=2*Math.sqrt(1+u-o-l),e[3]=(n-r)/i,e[0]=(a+h)/i,e[1]=(c+d)/i,e[2]=.25*i)}static decomposeFromMatrix(t,e,i,s){var o=t,r=THING.Math.getVectorLength([o[0],o[1],o[2]]),a=THING.Math.getVectorLength([o[4],o[5],o[6]]),n=THING.Math.getVectorLength([o[8],o[9],o[10]]);this.determinant(o)<0&&(r=-r),e[0]=o[12],e[1]=o[13],e[2]=o[14];var l=1/r,c=1/a,h=1/n;o[0]*=l,o[1]*=l,o[2]*=l,o[4]*=c,o[5]*=c,o[6]*=c,o[8]*=h,o[9]*=h,o[10]*=h,this.setFromRotationMatrix(o,i),s[0]=r,s[1]=a,s[2]=n}}class d extends c.Utils{static computeOBB(t){var e=t.orientedBox,i=THING.Math.getQuatFromAngles(e.angles),s=THING.Math.subVector(e.center,t.position),o=this.vec3CancelQuat(s,i);return{size:e.size,localPosition:o}}static getRelativeInfo(t,e){if(t){var i=THING.MathUtils.mat4.invert([],t.getMatrixWorld([],!0)),s=e.getMatrixWorld([],!0),o=THING.MathUtils.mat4.multiply([],i,s),r=[0,0,0],a=[0,0,0,1],n=[1,1,1];return h.decomposeFromMatrix(o,r,a,n),{relativePosition:r,relativeRotation:a,relativeScale:n,relativeForward:THING.Math.normalizeVector([-o[8],-o[9],-o[10]])}}return{relativePosition:e.position,relativeRotation:e.quaternion,relativeScale:e.scale,relativeForward:e.forward}}static positionWorldToSelf(t,e){return t?t.worldToSelf(e,!0):e}static positionSelfToWorld(t,e){return t?t.selfToWorld(e,!0):e}static quatWorldToSelf(t,e){if(t){var i=t.quaternion,s=THING.Math.quat.conjugate([0,0,0,0],i);return THING.Math.multiplyQuat(e,s)}return e}static quatSelfToWorld(t,e){if(t){var i=t.quaternion;return THING.Math.multiplyQuat(i,e)}return e}static vec3CancelQuat(t,e){return THING.Math.vec3.transformQuat([0,0,0],t,THING.Math.quat.conjugate([0,0,0,0],e))}static vec3ApplyQuat(t,e){return THING.Math.vec3.transformQuat([0,0,0],t,quat)}static getCurrentSceneComponent(){return Z.getCurrentPhysicsWorldComponent()}static getRootObject(){return this.getCurrentSceneComponent().rootObject}}var u=o("./src/core/Functions.js"),_=o("./src/core/Utils.js"),{PhysXActor:p}=o("./src/core/actor/PhysXActor.js");class m extends p{constructor(t,e,i){super(),this._pxActor=this._physXCore._pxPhysics.createRigidDynamic({translation:(0,_.arrayToVector3)(t),rotation:(0,_.arrayToQuat)(e)}),this._drag=0,this._angularDrag=0,this._velocity=[0,0,0],this._angularVelocity=[0,0,0],this._mass=1,this._centerOfMass=[0,0,0],this._inertiaTensor=[0,0,0],this._maxAngularVelocity=0,this._maxLinearVelocity=0,this._maxDepenetrationVelocity=0,this._sleepThreshold=0,this._solverIterations=0,this._collisionDetectionMode=1,this._isKinematic=!1,this._constraints=-1,this._freezeRotation=!1,this._forceSyncTransformToMain=!1,this.setUniqueID(i),this.collisionDetectionMode=1,this.linearDamping=.1,this.angularDamping=.1}get forceSyncTransformToMain(){return this._forceSyncTransformToMain}set forceSyncTransformToMain(t){this._forceSyncTransformToMain=t}get linearDamping(){return this._drag}set linearDamping(t){this._drag=t,this._pxActor.setLinearDamping(t)}get angularDamping(){return this._angularDrag}set angularDamping(t){this._angularDrag=t,this._pxActor.setAngularDamping(t)}set linearVelocity(t){this._velocity=(0,_.arrayToVector3)(t),this._pxActor.setLinearVelocity(this._velocity,!0)}set angularVelocity(t){this._angularVelocity=(0,_.arrayToVector3)(t),this._pxActor.setAngularVelocity(this._angularVelocity,!0)}get mass(){return this._mass}set mass(t){this._mass=t,this._pxActor.setMassAndUpdateInertia(t)}get centerOfMass(){return this._centerOfMass}set centerOfMass(t){this._centerOfMass=t,this._pxActor.setCMassLocalPose((0,_.arrayToVector3)(t))}get inertiaTensor(){return this._inertiaTensor}set inertiaTensor(t){this._inertiaTensor=t,this._pxActor.setMassSpaceInertiaTensor((0,_.arrayToVector3)(t))}get maxAngularVelocity(){return this._maxAngularVelocity}set maxAngularVelocity(t){this._maxAngularVelocity=t,this._pxActor.setMaxAngularVelocity(t)}get maxLinearVelocity(){return this._maxLinearVelocity}set maxLinearVelocity(t){this._maxLinearVelocity=t,this._pxActor.setMaxLinearVelocity(t)}get maxDepenetrationVelocity(){return this._maxDepenetrationVelocity}set maxDepenetrationVelocity(t){this._maxDepenetrationVelocity=t,this._pxActor.setMaxDepenetrationVelocity(t)}get sleepThreshold(){return this._sleepThreshold}set sleepThreshold(t){this._sleepThreshold=t,this._pxActor.setSleepThreshold(t)}get collisionDetectionMode(){return this._collisionDetectionMode}set collisionDetectionMode(t){switch(this._collisionDetectionMode=t,t){case 1:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!0);break;case 2:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!0);break;case 3:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!0);break;case 0:this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!1)}}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t,t?(this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eKINEMATIC,!0)):(this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eKINEMATIC,!1),this._pxActor.setRigidBodyFlag(this._physXCore._physX.PxRigidBodyFlag.eENABLE_CCD,!0))}get constraints(){return this._constraints}setConstraints(t,e){switch(this._constraints=e?this._constraints|t:this._constraints&~t,t){case 0:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_X,e);break;case 1:case 2:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,e);break;case 3:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_X,e);break;case 4:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Y,e);break;case 5:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Z,e);break;case 8:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_X,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_X,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Y,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Z,e);break;case 6:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_X,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_LINEAR_Y,e);break;case 7:this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_X,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Y,e),this._pxActor.setRigidDynamicLockFlag(this._physXCore._physX.PxRigidDynamicLockFlag.eLOCK_ANGULAR_Z,e)}}get freezeRotation(){return this._freezeRotation}set freezeRotation(t){this._freezeRotation=t,this.setConstraints(7,t)}addForce(t){this._pxActor.addForce((0,_.arrayToVector3)(t))}addTorque(t){this._pxActor.addTorque((0,_.arrayToVector3)(t))}addForceAtPosition(t,e){this._pxActor.addForceAtPos((0,_.arrayToVector3)(t),(0,_.arrayToVector3)(e))}getPointVelocity(t){var e=this._pxActor.getVelocityAtPos((0,_.arrayToVector3)(t));return(0,_.vector3ToArray)(e)}getRelativePointVelocity(t){var e=this._pxActor.getLocalVelocityAtLocalPos((0,_.arrayToVector3)(t));return(0,_.vector3ToArray)(e)}moveTransform(t,e){this._pxActor.setKinematicTarget((0,_.arrayToVector3)(t),(0,_.arrayToQuat)(e))}movePosition(t){(0,_.arrayToVector3)(t),this._pxActor.setKinematicTarget((0,_.arrayToVector3)(t),{x:0,y:0,z:0,w:1})}MoveRotation(t){var e={translation:{x:0,y:0,z:0},rotation:(0,_.arrayToQuat)(t)};this._pxActor.setKinematicTarget(e)}sleep(){return this._pxActor.putToSleep()}isSleeping(){return this._pxActor.isSleeping()}wakeUp(){return this._pxActor.wakeUp()}release(){super.release()}}var g=o("./src/core/PhysXCore.js"),{PhysXActor:y}=o("./src/core/actor/PhysXActor.js");class v extends y{constructor(t,e,i){super(),this._pxActor=this._physXCore._pxPhysics.createRigidStatic({translation:(0,_.arrayToVector3)(t),rotation:(0,_.arrayToQuat)(e)}),this.setUniqueID(i)}release(){super.release()}}var f=o("./src/core/actor/PhysXActor.js");class S{constructor(t,e,i,s,o,r){void 0===e&&(e=.5),void 0===i&&(i=.5),void 0===s&&(s=.5),void 0===o&&(o=0),void 0===r&&(r=0),this._pxMaterial=g.PhysXCore.getInstance()._pxPhysics.createMaterial(e,i,s),this._pxMaterial.setFrictionCombineMode(o),this._pxMaterial.setRestitutionCombineMode(r)}setBounciness(t){this._pxMaterial.setRestitution(t)}setDynamicFriction(t){this._pxMaterial.setDynamicFriction(t)}setStaticFriction(t){this._pxMaterial.setStaticFriction(t)}setBounceCombine(t){this._pxMaterial.setRestitutionCombineMode(t)}setFrictionCombine(t){this._pxMaterial.setFrictionCombineMode(t)}release(){this._pxMaterial&&(this._pxMaterial.release(),this._pxMaterial.delete(),this._pxMaterial=null)}}class C{constructor(t){void 0===t&&(t=[0,-9.8,0]),this._jumpTime=0,this._jump=!1,this._v0=0,this._jumpGravity=t[1],this._lastHeight=0,this._disableGravity=!1}startJump(t){return!this._jump&&!this._disableGravity&&(this._jumpTime=0,this._v0=t,this._jump=!0,this._lastHeight=0,!0)}stopJump(){this._jump&&(this._jump=!1)}isJumping(){return this._jump}getHeight(t){if(!this._jump||this._disableGravity)return 0;this._jumpTime+=t;var e=.5*this._jumpGravity*this._jumpTime*this._jumpTime+this._v0*this._jumpTime,i=e-this._lastHeight;return this._lastHeight=e,i}disableGravity(t){this._disableGravity=t}}class x{constructor(t){void 0===t&&(t=[0,-9.8,0]),this._lastHeight=0,this._fallTime=0,this._jumpGravity=t[1],this._disableGravity=!1}getHeight(t){if(this._disableGravity)return 0;this._fallTime+=t;var e=.5*this._jumpGravity*this._fallTime*this._fallTime,i=e-this._lastHeight;return this._lastHeight=e,i}getFallHeight(){return this._lastHeight}disableGravity(t){this._disableGravity=t}stopFall(){this._lastHeight=0,this._fallTime=0}}class P{constructor(t,e,i){this._cameraDistanceScale=0,this._ignoreEyeObstruction=!1,this._cameraForward=[0,0,1],this._scene=t,this._halfHeight=e+i/2}set cameraDistanceScale(t){this._cameraDistanceScale=t}get cameraDistanceScale(){return this._cameraDistanceScale}set ignoreEyeObstruction(t){this._ignoreEyeObstruction=t}get ignoreEyeObstruction(){return this._ignoreEyeObstruction}set cameraForward(t){this._cameraForward=t}get cameraForward(){return this._cameraForward}getPosition(t){var e=[t[0],t[1]+this._halfHeight+.1,t[2]];if(0!=this._cameraDistanceScale){var i=(0,_.scaleVector)(this._cameraForward,this._cameraDistanceScale),s=(0,_.subVector)(e,i),o=(0,_.getDirection)(e,s),r=(0,_.getDistance)(e,s),a=this._scene.raycastSingle(e,o,r);return a&&!this._ignoreEyeObstruction?a.position:s}return e}}class L{constructor(t,e,i,s,o,r,a){void 0===t&&(t=0),void 0===i&&(i=.5),void 0===s&&(s=1),void 0===o&&(o=new S),void 0===r&&(r=[0,0,0]),this._pxCapsulController=null,this._physXCore=g.PhysXCore.getInstance(),this._physXSystem=z.getInstance(),this._material=o,this._gravity=e.gravity,this._jump=new C(this._gravity),this._fall=new x(this._gravity),this._camera=new P(e,i,s),this._target=[0,0,0],this._id=t,this._radius=i,this._height=s,this._pxControllerManager=null,this._scene=e,this._climbingMode=0,this._stepOffset=.1,this._lastHitActorPointer=0,this._lastHitShapePointer=0,this._actorId=a,this._actor=null,this._currentState=null,this._disableGravity=!1,this.createController(r)}reportCallback(){var t=this;return{onShapeHit(e,i){var s=e.$$.ptr,o=i.$$.ptr;t._lastHitActorPointer==s&&t._lastHitShapePointer==o||(console.log(s,o),t._lastHitActorPointer=s,t._lastHitShapePointer=o)}}}createController(t){this._pxControllerManager=this._scene._pxScene.createControllerManager();var e=new this._physXCore._physX.PxCapsuleControllerDesc;e.radius=this._radius,e.height=this._height,e.position=(0,_.arrayToVector3)(t),e.scaleCoeff=.8,e.stepOffset=this._stepOffset,e.contactOffset=.1,e.setMaterial(this._material._pxMaterial),e.setReportCallback(new this._physXCore._physX.DefaultUserControllerHitReport),this._pxCapsulController=this._pxControllerManager.createCapsuleController(e),this.allocActor(),e.delete(),e=null}allocActor(){var t=this._pxCapsulController.getActor(),e=new f.PhysXActor;e._pxActor=t,e.setUniqueID(this._actorId),e.setName("CapsuleController"),this._actor=e}getActor(){return this._actor}releaseController(){this._pxCapsulController.release(),this._pxCapsulController.delete(),this._pxCapsulController=null,this._pxControllerManager.release(),this._pxControllerManager.delete(),this._pxControllerManager=null}jump(t){this._jump.startJump(t)&&this.dispatchCharEvent(u.PhysXControllerFunction.ControllerEventType.OnJumping)}disableGravity(t){this._jump.disableGravity(t),this._fall.disableGravity(t),this._disableGravity=t}move(t){void 0===t&&(t=[0,0,0]),this._target=t}getPosition(){if(this._pxCapsulController){var t=this._pxCapsulController.getPosition();return(0,_.vector3ToArray)(t)}}resize(t){this._pxCapsulController.resize(t)}dispatchCharEvent(t){this._currentState!=t&&(this._physXSystem.postMessage(u.PhysXControllerFunction.OnControllerEvent,{state:t,id:this._id}),this._currentState=t)}updatePosition(t){var e=[];if(this._disableGravity){if(0==this._target[0]&&0==this._target[1]&&0==this._target[2])return;e=this._target}else{var i=this._jump.getHeight(t)||this._fall.getHeight(t);e=[this._target[0],i,this._target[2]]}var s=this._pxCapsulController.move((0,_.arrayToVector3)(e),0,t);s.isSet(this._physXCore._physX.PxControllerCollisionFlag.eCOLLISION_DOWN)?(this._jump.isJumping()&&(this.dispatchCharEvent(u.PhysXControllerFunction.ControllerEventType.OnFinishJump),this._jump.stopJump()),i<-.15&&this.dispatchCharEvent(u.PhysXControllerFunction.ControllerEventType.OnFalled),this._fall.stopFall(this._fall.getFallHeight())):i<-.15&&this.dispatchCharEvent(u.PhysXControllerFunction.ControllerEventType.OnFalling),s.delete(),this._target=[0,0,0]}getWorldTransform(t){this.updatePosition(t);var e=this.getPosition(),i=this._camera.getPosition(e);return{position:e,cameraPosition:i,cameraTarget:(0,_.addVector)(i,this._camera.cameraForward)}}setCameraForward(t){this._camera.cameraForward=t}setCameraDistanceScale(t){this._camera.cameraDistanceScale=t}setCameraIgnoreEyeObstruction(t){this._camera.ignoreEyeObstruction=t}setClimbingMode(t){this._climbingMode=t,this._pxCapsulController.setClimbingMode(this._climbingMode)}setStepOffset(t){this._stepOffset=t,this._pxCapsulController.setStepOffset(this._stepOffset)}release(){this.releaseController(),this._material&&this._material.release()}}class T{constructor(t){this.id=t,this._pxGeometry=null,this._physXCore=g.PhysXCore.getInstance()}getPxGeometry(){return this._pxGeometry}release(){this._pxGeometry&&(this._pxGeometry.delete(),this._pxGeometry=null)}}class F extends T{constructor(t,e){super(t),this._size=e,this._pxGeometry=new this._physXCore._physX.PxBoxGeometry(.5*e[0],.5*e[1],.5*e[2])}setSize(t){this._pxGeometry.halfExtents={x:.5*t[0],y:.5*t[1],z:.5*t[2]}}}class b extends T{constructor(t,e,i){super(t),this._radius=e,this._height=i,this._pxGeometry=new this._physXCore._physX.PxCapsuleGeometry(this._radius,.5*this._height)}setRadius(t){this._radius=t,this._pxGeometry.radius=t}setHeight(t){this._height=t,this._pxGeometry.halfHeight=.5*this._height}}class M extends T{constructor(t,e,i){void 0===i&&(i=[1,1,1]),super(t),this._meshWeldTolerance=0;var s=performance.now();this._pxMesh=null;var o=this.allocMemory(e);this._pxGeometry=this.createGeometry(o,i),this._pxGeometry||console.warn("Create geometry failed");var r=performance.now();r-s>15&&console.warn("Init convex mesh time "+(r-s)+"  vertices: "+e.length)}setScale(t){this._pxGeometry&&(this._pxGeometry.scale=new this._physXCore._physX.PxMeshScale((0,_.arrayToVector3)(t),{x:0,y:0,z:0,w:1}))}createGeometry(t,e){var i=this._physXCore,s=new i._physX.PxTolerancesScale,o=new i._physX.PxCookingParams(s);o.meshPreprocessParams=new i._physX.PxMeshPreprocessingFlags(i._physX.PxMeshPreprocessingFlag.eWELD_VERTICES.value),o.meshWeldTolerance=0,o.planeTolerance=.01;var r=i._physX.PxCreateCooking(i._physX.PX_PHYSICS_VERSION,i._foundation,o),a=new i._physX.PxMeshScale((0,_.arrayToVector3)(e),{x:0,y:0,z:0,w:1}),n=new i._physX.PxConvexMeshGeometryFlags(2);if(this._pxMesh=r.createConvexMeshFromBuffer(t.byteOffset,t.length/3,i._pxPhysics),this._pxMesh){var l=new i._physX.PxConvexMeshGeometry(this._pxMesh,a,n);return s.delete(),s=null,o.delete(),o=null,r.release(),r.delete(),r=null,a.delete(),a=null,n.delete(),n=null,l}console.warn("Create mesh failed.")}allocMemory(t){var e=4*t.length;this._bufferPtr=this._physXCore._physX._malloc(e);for(var i=new Float32Array(this._physXCore._physX.HEAPU8.buffer,this._bufferPtr,t.length),s=0;s<t.length;s++)i[s]=t[s];return i}freeMemory(){this._bufferPtr&&(this._physXCore._physX._free(this._bufferPtr),this._bufferPtr=null)}release(){this.freeMemory(),this._pxMesh&&(this._pxMesh.release(),this._pxMesh.delete(),this._pxMesh=null),super.release()}}class A extends T{constructor(t){super(t),this._pxGeometry=new this._physXCore._physX.PxPlaneGeometry}}class k extends T{constructor(t,e){super(t),this._radius=e,this._pxGeometry=new this._physXCore._physX.PxSphereGeometry(this._radius)}setRadius(t){this._radius=t,this._pxGeometry.radius=this._radius}}class w extends T{constructor(t,e,i,s,o){void 0===s&&(s=[1,1,1]),super(t),this._meshWeldTolerance=e.length>=100?.2:.05,(o[0]<.5&&o[1]<.5||o[1]<.5&&o[2]<.5||o[0]<.5&&o[2]<.5)&&(this._meshWeldTolerance=1e-6);var r=performance.now(),a=this.allocGeometryBuffer(e,i),n=a.bufferP,l=a.bufferI;this._pxMesh=null,this._pxGeometry=this.createGeometry(n,l,s);var c=performance.now();c-r>15&&console.warn("Init triangle mesh time "+(c-r)+", vertices: "+e.length+" "),this.freeMemory()}setScale(t){this._pxGeometry&&(this._pxGeometry.scale=new this._physXCore._physX.PxMeshScale((0,_.arrayToVector3)(t),{x:0,y:0,z:0,w:1}))}createGeometry(t,e,i){var s=this._physXCore,o=new s._physX.PxTolerancesScale,r=new s._physX.PxCookingParams(o);r.meshPreprocessParams=new s._physX.PxMeshPreprocessingFlags(s._physX.PxMeshPreprocessingFlag.eWELD_VERTICES.value),r.meshWeldTolerance=this._meshWeldTolerance,r.planeTolerance=.1;var a=s._physX.PxCreateCooking(s._physX.PX_PHYSICS_VERSION,s._foundation,r),n=new s._physX.PxMeshScale((0,_.arrayToVector3)(i),{x:0,y:0,z:0,w:1}),l=new s._physX.PxMeshGeometryFlags(2);if(this._pxMesh=a.createTriMesh(t.byteOffset,t.length/3,e.byteOffset,e.length/3,!1,s._pxPhysics),this._pxMesh){var c=new s._physX.PxTriangleMeshGeometry(this._pxMesh,n,l);return o.delete(),o=null,r.delete(),r=null,a.release(),a.delete(),a=null,n.delete(),n=null,l.delete(),l=null,c}console.warn("cook failed",t.length)}allocPointsMemory(t){var e=4*t.length;this._pointsBufferPtr=this._physXCore._physX._malloc(e);for(var i=new Float32Array(this._physXCore._physX.HEAPU8.buffer,this._pointsBufferPtr,t.length),s=0;s<t.length;s++)i[s]=t[s];return i}allocIndexesMemory(t){var e=4*t.length;this._indexBufferPtr=this._physXCore._physX._malloc(e);for(var i=new Uint32Array(this._physXCore._physX.HEAPU8.buffer,this._indexBufferPtr,t.length),s=0;s<t.length;s++)i[s]=t[s];return i}allocGeometryBuffer(t,e){var i=4*t.length;this._pointsBufferPtr=this._physXCore._physX._malloc(i),i=4*e.length,this._indexBufferPtr=this._physXCore._physX._malloc(i);for(var s=new Float32Array(this._physXCore._physX.HEAPU8.buffer,this._pointsBufferPtr,t.length),o=0;o<t.length;o++)s[o]=t[o];var r=new Uint32Array(this._physXCore._physX.HEAPU8.buffer,this._indexBufferPtr,e.length);for(o=0;o<e.length;o++)r[o]=e[o];return{bufferP:s,bufferI:r}}freeMemory(){this._pointsBufferPtr&&(this._physXCore._physX._free(this._pointsBufferPtr),this._pointsBufferPtr=null),this._indexBufferPtr&&(this._physXCore._physX._free(this._indexBufferPtr),this._indexBufferPtr=null)}release(){this.freeMemory(),this._pxMesh&&(this._pxMesh.release(),this._pxMesh.delete(),this._pxMesh=null),super.release()}}var{PhysXJoint:X}=o("./src/core/joint/PhysXJoint.js");class D extends X{constructor(t,e,i,s,o,r){super(),this._pxJoint=this._physXCore._pxPhysics.createDistanceJoint(null==t?null:t._pxActor,(0,_.arrayToVector3)(e),(0,_.arrayToQuat)(i),s._pxActor,(0,_.arrayToVector3)(o),(0,_.arrayToQuat)(r)),this.setFlagCollisionEnabled(!0),this._pxJoint.setDistanceJointFlag(4,!0),this._pxJoint.setDistanceJointFlag(2,!0),this._minDistance=0,this._maxDistance=0,this._tolerance=0,this._stiffness=0,this._damping=0}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance=t,this._pxJoint.setMinDistance(t)}get maxDistance(){return this._maxDistance}set maxDistance(t){this._maxDistance=t,this._pxJoint.setMaxDistance(t)}get tolerance(){return this._tolerance}set tolerance(t){this._tolerance=t,this._pxJoint.setTolerance(t)}get stiffness(){return this._stiffness}set stiffness(t){this._stiffness=t,this._pxJoint.setStiffness(t),0==t?this._pxJoint.setDistanceJointFlag(8,!1):this._pxJoint.setDistanceJointFlag(8,!0)}get damping(){return this._damping}set damping(t){this._damping=t,this._pxJoint.setDamping(t)}}var{PhysXJoint:R}=o("./src/core/joint/PhysXJoint.js");class I extends R{constructor(t,e,i,s,o,r){super(),this._pxJoint=this._physXCore._pxPhysics.createFixedJoint(null==t?null:t._pxActor,(0,_.arrayToVector3)(e),(0,_.arrayToQuat)(i),s._pxActor,(0,_.arrayToVector3)(o),(0,_.arrayToQuat)(r)),this.setFlagCollisionEnabled(!0),this._linearTolerance=0,this._angularTolerance=0}get linearTolerance(){return this._linearTolerance}set linearTolerance(t){this._linearTolerance=t,this._pxJoint.setProjectionLinearTolerance(t),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(t){this._angularTolerance=t,this._pxJoint.setProjectionAngularTolerance(t),this.setFlagProjection(!0)}}var{PhysXJoint:G}=o("./src/core/joint/PhysXJoint.js");class E extends G{constructor(t,e,i,s,o,r){super(),this._pxJoint=this._physXCore._pxPhysics.createRevoluteJoint(null==t?null:t._pxActor,(0,_.arrayToVector3)(e),(0,_.arrayToQuat)(i),s._pxActor,(0,_.arrayToVector3)(o),(0,_.arrayToQuat)(r)),this.setFlagCollisionEnabled(!0),this._lowerLimit=0,this._upperLimit=0,this._contactDist=0,this._stiffness=0,this._damping=0,this._driveVelocity=0,this._driveForceLimit=0,this._driveGearRatio=0,this._linearTolerance=0,this._angularTolerance=0}get driveVelocity(){return this._driveVelocity}set driveVelocity(t){this._driveVelocity=t,this._pxJoint.setDriveVelocity(t,!0),0==t?this._pxJoint.setRevoluteJointFlag(2,!1):this._pxJoint.setRevoluteJointFlag(2,!0)}get driveForceLimit(){return this._driveForceLimit}set driveForceLimit(t){this._driveForceLimit=t,this._pxJoint.setDriveForceLimit(t),this.setFlagDriverLimitsAreForces(!0)}get driveGearRatio(){return this._driveGearRatio}set driveGearRatio(t){this._driveGearRatio=t,this._pxJoint.setDriveGearRatio(t)}get linearTolerance(){return this._linearTolerance}set linearTolerance(t){this._linearTolerance=t,this._pxJoint.setProjectionLinearTolerance(t),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(t){this._angularTolerance=t,this._pxJoint.setProjectionAngularTolerance(t),this.setFlagProjection(!0)}setHardLimit(t,e,i){this._lowerLimit=t,this._upperLimit=e,this._contactDist=i,this._pxJoint.setHardLimit(t,e,i),this._pxJoint.setRevoluteJointFlag(1,!0)}setSoftLimit(t,e,i,s){this._lowerLimit=t,this._upperLimit=e,this._stiffness=i,this._damping=s,this._pxJoint.setSoftLimit(t,e,i,s),this._pxJoint.setRevoluteJointFlag(1,!0)}setDrive(t,e,i){this._driveVelocity=t,this._driveForceLimit=i,this._pxJoint.setDriveVelocity(t,!0),0==t?this._pxJoint.setRevoluteJointFlag(2,!1):this._pxJoint.setRevoluteJointFlag(2,!0),this.setFlagDriverLimitsAreForces(e),this._pxJoint.setDriveForceLimit(i)}}var{PhysXJoint:V}=o("./src/core/joint/PhysXJoint.js");class J extends V{constructor(t,e,i,s,o,r){super(),this._pxJoint=this._physXCore._pxPhysics.createSphericalJoint(null==t?null:t._pxActor,(0,_.arrayToVector3)(e),(0,_.arrayToQuat)(i),s._pxActor,(0,_.arrayToVector3)(o),(0,_.arrayToQuat)(r)),this.setFlagCollisionEnabled(!0),this._yLimitAngle=0,this._zLimitAngle=0,this._contactDist=0,this._stiffness=0,this._damping=0,this._linearTolerance=0}setHardLimitCone(t,e,i){this._yLimitAngle=t,this._zLimitAngle=e,this._contactDist=i,this._pxJoint.setHardLimitCone(t,e,i),this._pxJoint.setSphericalJointFlag(2,!0)}setSoftLimitCone(t,e,i,s){this._yLimitAngle=t,this._zLimitAngle=e,this._stiffness=i,this._damping=s,this._pxJoint.setSoftLimitCone(t,e,i,s),this._pxJoint.setSphericalJointFlag(2,!0)}get linearTolerance(){return this._linearTolerance}set linearTolerance(t){this._linearTolerance=t,this._pxJoint.setProjectionLinearTolerance(t),this.setFlagProjection(!0)}}var{PhysXJoint:j}=o("./src/core/joint/PhysXJoint.js");class H extends j{constructor(t,e,i,s,o,r){super(),this._pxJoint=this._physXCore._pxPhysics.createPrismaticJoint(null==t?null:t._pxActor,(0,_.arrayToVector3)(e),(0,_.arrayToQuat)(i),s._pxActor,(0,_.arrayToVector3)(o),(0,_.arrayToQuat)(r)),this.setFlagCollisionEnabled(!0),this._scale=0,this._lowerLimit=0,this._upperLimit=0,this._contactDist=0,this._stiffness=0,this._damping=0,this._linearTolerance=0,this._angularTolerance=0,this._prismaticJointFlags=null}get linearTolerance(){return this._linearTolerance}set linearTolerance(t){this._linearTolerance=t,this._pxJoint.setProjectionLinearTolerance(t),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(t){this._angularTolerance=t,this._pxJoint.setProjectionAngularTolerance(t),this.setFlagProjection(!0)}setHardLimitPri(t,e,i){this.scale=this._physXCore._pxPhysics.getTolerancesScale(),this._lowerLimit=t,this._upperLimit=e,this._contactDist=i,this._pxJoint.setHardLimit(this.scale,t,e,i),this._pxJoint.setPrismaticJointFlag(2,!0)}setSoftLimitPri(t,e,i,s){this._lowerLimit=t,this._upperLimit=e,this._stiffness=i,this._damping=s,this._pxJoint.setSoftLimit(t,e,i,s),this._pxJoint.setPrismaticJointFlag(2,!0)}}var{PhysXJoint:O}=o("./src/core/joint/PhysXJoint.js");class N extends O{constructor(t,e,i,s,o,r){super(),this._pxJoint=this._physXCore._pxPhysics.createD6Joint(null==t?null:t._pxActor,(0,_.arrayToVector3)(e),(0,_.arrayToQuat)(i),s._pxActor,(0,_.arrayToVector3)(o),(0,_.arrayToQuat)(r)),this.setFlagCollisionEnabled(!0),this._driveLinearVelocity=0,this._driveAngularVelocity=0,this._linearTolerance=0,this._angularTolerance=0}get driveVelocity(){return this._driveVelocity}setDriveVelocityD6(t,e){this._driveLinearVelocity=t,this._driveAngularVelocity=e,this._pxJoint.setDriveVelocity((0,_.arrayToVector3)(t),(0,_.arrayToVector3)(e),!0)}get linearTolerance(){return this._linearTolerance}set linearTolerance(t){this._linearTolerance=t,this._pxJoint.setProjectionLinearTolerance(t),this.setFlagProjection(!0)}get angularTolerance(){return this._angularTolerance}set angularTolerance(t){this._angularTolerance=t,this._pxJoint.setProjectionAngularTolerance(t),this.setFlagProjection(!0)}setMotion(t,e){this._pxJoint.setMotion(t,e)}setHardDistanceLimit(t,e){this._pxJoint.setHardDistanceLimit(this._physXCore._pxPhysics.getTolerancesScale(),t,e)}setSoftDistanceLimit(t,e,i){this._pxJoint.setSoftDistanceLimit(t,e,i)}setHardLinearLimit(t,e,i,s){this._pxJoint.setHardLinearLimit(t,this._physXCore._pxPhysics.getTolerancesScale(),e,i,s)}setSoftLinearLimit(t,e,i,s,o){this._pxJoint.setSoftLinearLimit(t,e,i,s,o)}setHardTwistLimit(t,e,i){this._pxJoint.setHardTwistLimit(t,e,i)}setSoftTwistLimit(t,e,i,s){this._pxJoint.setSoftTwistLimit(t,e,i,s)}setHardSwingLimit(t,e,i){this._pxJoint.setHardSwingLimit(t,e,i)}setSoftSwingLimit(t,e,i,s){this._pxJoint.setSoftSwingLimit(t,e,i,s)}setHardPyramidSwingLimit(t,e,i,s,o){this._pxJoint.setHardPyramidSwingLimit(t,e,i,s,o)}setSoftPyramidSwingLimit(t,e,i,s,o,r){this._pxJoint.setSoftPyramidSwingLimit(t,e,i,s,o,r)}setDrive(t,e,i,s){this.setFlagDriverLimitsAreForces(!0),this._pxJoint.setDrive(t,e,i,s)}setDrivePosition(t,e){this._pxJoint.setDrivePosition((0,_.arrayToVector3)(t),(0,_.arrayToQuat)(e))}}class W{constructor(t,e){void 0===e&&(e=[0,-9.8,0]),this._id=t,this._gravity=e,this._physXCore=g.PhysXCore.getInstance(),this._pxScene=this._physXCore._pxPhysics.createScene(this._physXCore._pxDesc),this._pxHitResult=new this._physXCore._physX.PxRaycastHit,this._pxFilterData=new this._physXCore._physX.PxQueryFilterData,this._pxFilterData.flags=new this._physXCore._physX.PxQueryFlags(3)}addActor(t){this._pxScene&&this._pxScene.addActor(t._pxActor,null),t.scene=this}removeActor(t){this._pxScene&&this._pxScene.removeActor(t._pxActor,!0),t.scene=null}set gravity(t){this._gravity=t,this._pxScene.setGravity((0,_.arrayToVector3)(t))}get gravity(){return this._gravity}update(t){this._pxScene&&(this._pxScene.simulate(t,!0),this._pxScene.fetchResults(!0))}raycastSingle(t,e,i){if(this._pxScene.raycastSingle((0,_.arrayToVector3)(t),(0,_.arrayToVector3)(e),i,this._pxHitResult,this._pxFilterData)){var s=this._pxHitResult.position,o=this._pxHitResult.normal;return i=this._pxHitResult.distance,{id:this._pxHitResult.getActor().getId(),position:(0,_.vector3ToArray)(s),normal:(0,_.vector3ToArray)(o),distance:i}}return null}release(){this._pxScene&&(this._pxScene.release(),this._pxScene.delete(),this._pxScene=null)}}class B{constructor(t,e,i,s){this._shapeFlags=11,this._pxShape=null,this._physXCore=g.PhysXCore.getInstance(),this._material=i,this._isShared=s,this.allocShape(e._pxGeometry,i._pxMaterial),this.setUniqueID(t)}setLocalPose(t,e){void 0===t&&(t=[0,0,0]),void 0===e&&(e=[0,0,0,1]),this._pxShape.setLocalPose({translation:(0,_.arrayToVector3)(t),rotation:(0,_.arrayToQuat)(e)})}setLocalPosition(t){var e=this._pxShape.getLocalPose();this._pxShape.setLocalPose({translation:(0,_.arrayToVector3)(t),rotation:e.rotation})}setLocalRotation(t){var e=this._pxShape.getLocalPose();this._pxShape.setLocalPose({translation:e.translation,rotation:(0,_.arrayToQuat)(t)})}getMaterial(){return this._material}setMaterial(t){this._material&&this._material.release(),this._material=t,this._pxShape.setMaterials([t._pxMaterial])}setUniqueID(t){var e=new this._physXCore._physX.PxFilterData(t,0,0,0);this._pxShape.setQueryFilterData(e),e.delete(),e=null,this.setName(t.toString()),this._pxShape.setId(t)}modifyFlag(t,e){this._shapeFlags=e?this._shapeFlags|t:this._shapeFlags&~t}setShapeFlags(t){this._shapeFlags=t;var e=new this._physXCore._physX.PxShapeFlags(this._shapeFlags);this._pxShape.setFlags(e),e.delete(),e=null}setIsTrigger(t){this._pxShape.setIsTrigger(t)}setIsSceneQuery(t){this.modifyFlag(2,t),this.setShapeFlags(this._shapeFlags)}allocShape(t,e){var i=new this._physXCore._physX.PxShapeFlags(this._shapeFlags);this._pxShape=this._physXCore._pxPhysics.createShape(t,e,!this._isShared,i),i.delete(),i=null}setGeometry(t){this._pxShape.setGeometry(t._pxGeometry)}setName(t){this._pxShape.setName&&this._pxShape.setName(t)}release(){this._pxShape&&(this._pxShape.release(),this._pxShape.delete(),this._pxShape=null)}}class z{constructor(){this._physx_core=null,this._scenes=new Map,this._actors=new Map,this._shapes=new Map,this._materials=new Map,this._geometries=new Map,this._controllers=new Map,this._joints=new Map,this._postMessage=null,this._enableSyncActorTransform=!1,this._cacheEvent=[]}PhysXGlobalFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXGlobalFunction.InitPhysX:if(i._physx_core)return void console.error("only can init once.");i._physx_core=g.PhysXCore.getInstance(),yield i._physx_core.init(e),i._physx_core.setEventCallback(i.eventCollisionCallback.bind(i));break;case u.PhysXGlobalFunction.ReleasePhysX:i._physx_core&&(i._scenes.clear(),i._actors.clear(),i._shapes.clear(),i._materials.clear(),i._geometries.clear(),i._controllers.clear(),i._joints.clear(),i._enableSyncActorTransform=!1,i._cacheEvent=[],i._physx_core.release(),i._physx_core=null);break;case u.PhysXGlobalFunction.CanSendAllActorTransformFromWorker:i._enableSyncActorTransform=!0}}))()}PhysXSceneFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXSceneFunction.CreateScene:var s=e.id,o=e.gravity;(n=new W(s)).gravity=o,i._scenes.set(s,n);break;case u.PhysXSceneFunction.ReleaseScene:s=e.id,(n=i._scenes.get(s))&&n.release(),i._scenes.delete(s);break;case u.PhysXSceneFunction.SetGravity:s=e.id,o=e.gravity,(n=i._scenes.get(s))&&(n.gravity=o);break;case u.PhysXSceneFunction.AddActor:var r=e.sceneId,a=e.actorId,n=i._scenes.get(r);(h=i._actors.get(a))&&n&&n.addActor(h);break;case u.PhysXSceneFunction.RemoveActor:r=e.sceneId,a=e.actorId,n=i._scenes.get(r),(h=i._actors.get(a))&&n&&n.removeActor(h);break;case u.PhysXSceneFunction.BatchSetTransform:var l=e.transforms;for(var c in l){var h;s=l[c].id,(h=i._actors.get(s))&&(h.isKinematic?h.moveTransform(l[c].position,l[c].quaternion):h.setWroldTransform(l[c].position,l[c].quaternion))}break;case u.PhysXSceneFunction.RaycastSingle:r=e.sceneId;var d=e.origin,_=e.direction,p=e.distance;if(n=i._scenes.get(r))return n.raycastSingle(d,_,p)}}))()}PhysXActorFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXActorFunction.CreateStaticActor:var s=e.id,o=e.position,r=e.rotation,a=new v(o,r,s);i._actors.set(s,a);break;case u.PhysXActorFunction.CreateDynamicActor:s=e.id,o=e.position,r=e.rotation,a=new m(o,r,s),i._actors.set(s,a);break;case u.PhysXActorFunction.SetEnable:s=e.id;var n=e.enable;(a=i._actors.get(s))&&(n?a.enable():a.disable());break;case u.PhysXActorFunction.ReleaseActor:s=e.id,(a=i._actors.get(s))&&(a.release(),i._actors.delete(s));break;case u.PhysXActorFunction.SetTransform:s=e.id,o=e.position,r=e.rotation,(a=i._actors.get(s))&&a.setWroldTransform(o,r);break;case u.PhysXActorFunction.AddForce:s=e.id;var l=e.force;(a=i._actors.get(s))&&a.addForce(l);break;case u.PhysXActorFunction.AddTorque:s=e.id;var c=e.torque;(a=i._actors.get(s))&&a.addTorque(c);break;case u.PhysXActorFunction.SetMass:s=e.id;var h=e.mass;(a=i._actors.get(s))&&(a.mass=h);break;case u.PhysXActorFunction.SetCenterOfMass:s=e.id;var d=e.centerOfMass;(a=i._actors.get(s))&&(a.centerOfMass=d);break;case u.PhysXActorFunction.SetLinearVelocity:s=e.id;var _=e.velocity;(a=i._actors.get(s))&&(a.linearVelocity=_);break;case u.PhysXActorFunction.SetAngularVelocity:s=e.id,_=e.velocity,(a=i._actors.get(s))&&(a.angularVelocity=_);break;case u.PhysXActorFunction.SetMaxAngularVelocity:s=e.id;var p=e.maxVelocity;(a=i._actors.get(s))&&(a.maxAngularVelocity=p);break;case u.PhysXActorFunction.SetMaxLinearVelocity:s=e.id,p=e.maxVelocity,(a=i._actors.get(s))&&(a.maxLinearVelocity=p);break;case u.PhysXActorFunction.SetLinearDamping:s=e.id;var g=e.damping;(a=i._actors.get(s))&&(a.linearDamping=g);break;case u.PhysXActorFunction.SetAngularDaming:s=e.id,g=e.damping,(a=i._actors.get(s))&&(a.angularDamping=g);break;case u.PhysXActorFunction.SetSleepThreshold:s=e.id;var y=e.sleepThreshold;(a=i._actors.get(s))&&(a.sleepThreshold=y);break;case u.PhysXActorFunction.SetInertiaTensor:s=e.id;var f=e.inertiaTensor;(a=i._actors.get(s))&&(a.inertiaTensor=f);break;case u.PhysXActorFunction.SetIsKinematic:s=e.id;var S=e.isKinematic;(a=i._actors.get(s))&&(a.isKinematic=S);break;case u.PhysXActorFunction.SetSleep:s=e.id,(a=i._actors.get(s))&&a.sleep();break;case u.PhysXActorFunction.SetWakeup:s=e.id,(a=i._actors.get(s))&&a.wakeUp();break;case u.PhysXActorFunction.AddShape:var C=e.actorId,x=e.shapeId,P=(a=i._actors.get(C),i._shapes.get(x));a&&P&&a.addShape(P);break;case u.PhysXActorFunction.RemoveShape:C=e.actorId,x=e.shapeId,a=i._actors.get(C),P=i._shapes.get(x),a&&P&&a.removeShape(P);break;case u.PhysXActorFunction.DisableGravity:C=e.id;var L=e.disable;(a=i._actors.get(C)).disableGravity(L)}}))()}PhysXShapeFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXShapeFunction.CreateShape:var s=e.id,o=e.geometryId,r=e.materialId,a=i._geometries.get(o),n=i._materials.get(r),l=e.shared;if(a&&n){var c=new B(s,a,n,l);i._shapes.set(s,c)}break;case u.PhysXShapeFunction.ReleaseShape:s=e.id,(c=i._shapes.get(s))&&c.release(),i._shapes.delete(s);break;case u.PhysXShapeFunction.SetLocalPosition:s=e.id;var h=e.localPosition;(c=i._shapes.get(s))&&c.setLocalPosition(h);break;case u.PhysXShapeFunction.SetLocalRotation:s=e.id;var d=e.localRotation;(c=i._shapes.get(s))&&c.setLocalRotation(d);break;case u.PhysXShapeFunction.SetIsTrigger:s=e.id;var _=e.isTrigger;(c=i._shapes.get(s))&&c.setIsTrigger(_);break;case u.PhysXShapeFunction.SetMaterial:s=e.id,r=e.materialId,c=i._shapes.get(s),n=i._materials.get(s),c&&n&&c.setMaterial(n);break;case u.PhysXShapeFunction.SetGeometry:s=e.id;var p=e.geometryId,m=(c=i._shapes.get(s),i._geometries.get(p));c&&m&&c.setGeometry(m)}}))()}PhysXMaterialFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXMaterialFunction.CreateMaterial:var s=e.id,o=e.staticFriction,r=e.dynamicFriction,a=e.restitution,n=new S(s,o,r,a);i._materials.set(s,n);break;case u.PhysXMaterialFunction.ReleaseMaterial:s=e.id,(n=i._materials.get(s))&&(n.release(),i._materials.delete(s));break;case u.PhysXMaterialFunction.SetStaticFriction:s=e.id,o=e.staticFriction,(n=i._materials.get(s))&&n.setStaticFriction(o);break;case u.PhysXMaterialFunction.SetDynamicFriction:s=e.id,r=e.dynamicFriction,(n=i._materials.get(s))&&n.setDynamicFriction(r);break;case u.PhysXMaterialFunction.SetRestitution:s=e.id,a=e.restitution,(n=i._materials.get(s))&&n.setBounciness(a)}}))()}PhysXGeometryFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXGeometryFunction.CreateGeometry:var s=i.createGeometry(e);i._geometries.set(e.id,s);break;case u.PhysXGeometryFunction.ReleaseGeometry:var o=e.id;(s=i._geometries.get(o))&&(s.release(),i._geometries.delete(o));break;case u.PhysXGeometryFunction.SetBoxSize:o=e.id;var r=e.size;(s=i._geometries.get(o))&&s.setSize(r);break;case u.PhysXGeometryFunction.SetSphereRadius:o=e.id;var a=e.radius;(s=i._geometries.get(o))&&s.setRadius(a);break;case u.PhysXGeometryFunction.SetCapsuleRadius:o=e.id,a=e.radius,(s=i._geometries.get(o))&&s.setRadius(a);break;case u.PhysXGeometryFunction.SetCapsuleHeight:o=e.id;var n=e.height;(s=i._geometries.get(o))&&s.setHeight(n);break;case u.PhysXGeometryFunction.SetPlaneRotation:o=e.id;var l=e.rotation;(s=i._geometries.get(o))&&s.setRotation(l);break;case u.PhysXGeometryFunction.SetConvexMeshScale:o=e.id;var c=e.scale;(s=i._geometries.get(o))&&s.setScale(c);break;case u.PhysXGeometryFunction.SetTriangleMeshScale:o=e.id,c=e.scale,(s=i._geometries.get(o))&&s.setScale(c)}}))()}PhysXControllerFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXControllerFunction.CreateController:var s=e.id,o=e.sceneId,r=e.radius,a=e.height,n=e.position,l=e.materialId,c=e.actorId,h=e.cameraDistanceScale,d=e.ignoreEyeObstruction,_=i._scenes.get(o),p=i._materials.get(l);if(_&&p){var m=new L(s,_,r,a,p,n,c);i._controllers.set(s,m);var g=m.getActor();m.setCameraDistanceScale(h),m.setCameraIgnoreEyeObstruction(d),i._actors.set(c,g)}break;case u.PhysXControllerFunction.ReleaseController:s=e.id,(m=i._controllers.get(s))&&(m.release(),i._controllers.delete(s),i._actors.delete(m.getActor().id));break;case u.PhysXControllerFunction.MoveController:s=e.id;var y=e.target,v=e.deltaTime;(m=i._controllers.get(s))&&m.move(y,v);break;case u.PhysXControllerFunction.ControllerJump:s=e.id;var f=e.velocity;(m=i._controllers.get(s))&&m.jump(f);break;case u.PhysXControllerFunction.DisableControllerGravity:s=e.id;var S=e.disable;(m=i._controllers.get(s))&&m.disableGravity(S);break;case u.PhysXControllerFunction.SetCameraForward:s=e.id;var C=e.forward;(m=i._controllers.get(s))&&m.setCameraForward(C);break;case u.PhysXControllerFunction.SetCameraDistanceScale:s=e.id,h=e.cameraDistanceScale,(m=i._controllers.get(s))&&m.setCameraDistanceScale(h)}}))()}PhysXJointFunction(t,e){var i=this;return(0,l.default)((function*(){switch(t){case u.PhysXJointFunction.CreateDistanceJoint:var s=e.id,o=i._actors.get(e.id0),r=e.localPosition0,a=e.localRotation0,n=i._actors.get(e.id1),l=e.localPosition1,c=e.localRotation1;(Z=new D(o,r,a,n,l,c)).setUniqueID(s),i._joints.set(s,Z);break;case u.PhysXJointFunction.CreateFixedJoint:s=e.id,o=i._actors.get(e.id0),r=e.localPosition0,a=e.localRotation0,n=i._actors.get(e.id1),l=e.localPosition1,c=e.localRotation1,(Z=new I(o,r,a,n,l,c)).setUniqueID(s),i._joints.set(s,Z);break;case u.PhysXJointFunction.CreateRevoluteJoint:s=e.id,o=i._actors.get(e.id0),r=e.localPosition0,a=e.localRotation0,n=i._actors.get(e.id1),l=e.localPosition1,c=e.localRotation1,(Z=new E(o,r,a,n,l,c)).setUniqueID(s),i._joints.set(s,Z);break;case u.PhysXJointFunction.CreateSphericalJoint:s=e.id,o=i._actors.get(e.id0),r=e.localPosition0,a=e.localRotation0,n=i._actors.get(e.id1),l=e.localPosition1,c=e.localRotation1,(Z=new J(o,r,a,n,l,c)).setUniqueID(s),i._joints.set(s,Z);break;case u.PhysXJointFunction.CreatePrismaticJoint:s=e.id,o=i._actors.get(e.id0),r=e.localPosition0,a=e.localRotation0,n=i._actors.get(e.id1),l=e.localPosition1,c=e.localRotation1,(Z=new H(o,r,a,n,l,c)).setUniqueID(s),i._joints.set(s,Z);break;case u.PhysXJointFunction.CreateD6Joint:s=e.id,o=i._actors.get(e.id0),r=e.localPosition0,a=e.localRotation0,n=i._actors.get(e.id1),l=e.localPosition1,c=e.localRotation1,(Z=new N(o,r,a,n,l,c)).setUniqueID(s),i._joints.set(s,Z);break;case u.PhysXJointFunction.SetActors:s=e.id,o=i._actors.get(e.id0),n=i._actors.get(e.id1),(Z=i._joints.get(s))&&Z.setActors(o,n);break;case u.PhysXJointFunction.SetLocalPose:s=e.id;var h=e.actor,d=e.localPosition,_=e.localRotation;(Z=i._joints.get(s))&&Z.setLocalPose(h,d,_);break;case u.PhysXJointFunction.SetBreakForce:s=e.id;var p=e.linear,m=e.angular;(Z=i._joints.get(s))&&Z.setBreakForce(p,m);break;case u.PhysXJointFunction.ReleaseJoint:s=e.id,(Z=i._joints.get(s))&&Z.release();break;case u.PhysXJointFunction.InvMassScale0:s=e.id;var g=e.invMassScale0;(Z=i._joints.get(s))&&(Z.invMassScale0=g);break;case u.PhysXJointFunction.InvInertiaScale0:s=e.id;var y=e.invInertiaScale0;(Z=i._joints.get(s))&&(Z.invInertiaScale0=y);break;case u.PhysXJointFunction.InvMassScale1:s=e.id;var v=e.invMassScale1;(Z=i._joints.get(s))&&(Z.invMassScale1=v);break;case u.PhysXJointFunction.InvInertiaScale1:s=e.id;var f=e.invInertiaScale1;(Z=i._joints.get(s))&&(Z.invInertiaScale1=f);break;case u.PhysXJointFunction.SetMinDistance:s=e.id;var S=e.minDistance;(Z=i._joints.get(s))&&(Z.minDistance=S);break;case u.PhysXJointFunction.SetMaxDistance:s=e.id;var C=e.maxDistance;(Z=i._joints.get(s))&&(Z.maxDistance=C);break;case u.PhysXJointFunction.SetTolerance:s=e.id;var x=e.tolerance;(Z=i._joints.get(s))&&(Z.tolerance=x);break;case u.PhysXJointFunction.SetStiffness:s=e.id;var P=e.stiffness;(Z=i._joints.get(s))&&(Z.stiffness=P);break;case u.PhysXJointFunction.SetDamping:s=e.id;var L=e.damping;(Z=i._joints.get(s))&&(Z.damping=L);break;case u.PhysXJointFunction.SetProjectionLinearTolerance:s=e.id;var T=e.linearTolerance;(Z=i._joints.get(s))&&(Z.linearTolerance=T);break;case u.PhysXJointFunction.SetProjectionAngularTolerance:s=e.id;var F=e.angularTolerance;(Z=i._joints.get(s))&&(Z.angularTolerance=F);break;case u.PhysXJointFunction.SetHardLimit:s=e.id;var b=e.lowerLimit,M=e.upperLimit,A=e.contactDist;(Z=i._joints.get(s))&&Z.setHardLimit(b,M,A);break;case u.PhysXJointFunction.SetSoftLimit:s=e.id,b=e.lowerLimit,M=e.upperLimit,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftLimit(b,M,P,L);break;case u.PhysXJointFunction.SetDriveVelocity:s=e.id;var k=e.driveVelocity;(Z=i._joints.get(s))&&(Z.driveVelocity=k);break;case u.PhysXJointFunction.SetDriveForceLimit:s=e.id;var w=e.driveForceLimit;(Z=i._joints.get(s))&&(Z.driveForceLimit=w);break;case u.PhysXJointFunction.SetDriveGearRatio:s=e.id;var X=e.driveGearRatio;(Z=i._joints.get(s))&&(Z.driveGearRatio=X);break;case u.PhysXJointFunction.SetRevoluteDrive:s=e.id,k=e.driveVelocity;var R=e.driveForceFlag;w=e.driveForceLimit,(Z=i._joints.get(s))&&Z.setDrive(k,R,w);break;case u.PhysXJointFunction.SetHardLimitCone:s=e.id;var G=e.yLimitAngle,V=e.zLimitAngle;A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardLimitCone(G,V,A);break;case u.PhysXJointFunction.SetSoftLimitCone:s=e.id,G=e.yLimitAngle,V=e.zLimitAngle,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftLimitCone(G,V,P,L);break;case u.PhysXJointFunction.SetHardLimitPri:s=e.id,b=e.lowerLimit,M=e.upperLimit,A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardLimitPri(b,M,A);break;case u.PhysXJointFunction.SetSoftLimitPri:s=e.id,b=e.lowerLimit,M=e.upperLimit,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftLimitPri(b,M,P,L);break;case u.PhysXJointFunction.SetMotion:s=e.id;var j=e.axis,O=e.axisType;(Z=i._joints.get(s))&&Z.setMotion(j,O);break;case u.PhysXJointFunction.SetHardDistanceLimit:s=e.id;var W=e.extent;A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardDistanceLimit(W,A);break;case u.PhysXJointFunction.SetSoftDistanceLimit:s=e.id,W=e.extent,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftDistanceLimit(W,P,L);break;case u.PhysXJointFunction.SetHardLinearLimit:s=e.id,j=e.axis,b=e.lowerLimit,M=e.upperLimit,A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardLinearLimit(j,b,M,A);break;case u.PhysXJointFunction.SetSoftLinearLimit:s=e.id,j=e.axis,b=e.lowerLimit,M=e.upperLimit,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftLinearLimit(j,b,M,P,L);break;case u.PhysXJointFunction.SetHardTwistLimit:s=e.id,b=e.lowerLimit,M=e.upperLimit,A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardTwistLimit(b,M,A);break;case u.PhysXJointFunction.SetSoftTwistLimit:s=e.id,b=e.lowerLimit,M=e.upperLimit,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftTwistLimit(b,M,P,L);break;case u.PhysXJointFunction.SetHardSwingLimit:s=e.id,G=e.yLimitAngle,V=e.zLimitAngle,A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardSwingLimit(G,V,A);break;case u.PhysXJointFunction.SetSoftSwingLimit:s=e.id,G=e.yLimitAngle,V=e.zLimitAngle,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftSwingLimit(G,V,P,L);break;case u.PhysXJointFunction.SetHardPyramidSwingLimit:s=e.id;var B=e.yLimitAngleMin,z=e.yLimitAngleMax,q=e.zLimitAngleMin,U=e.zLimitAngleMax;A=e.contactDist,(Z=i._joints.get(s))&&Z.setHardPyramidSwingLimit(B,z,q,U,A);break;case u.PhysXJointFunction.SetSoftPyramidSwingLimit:s=e.id,B=e.yLimitAngleMin,z=e.yLimitAngleMax,q=e.zLimitAngleMin,U=e.zLimitAngleMax,P=e.stiffness,L=e.damping,(Z=i._joints.get(s))&&Z.setSoftPyramidSwingLimit(B,z,q,U,P,L);break;case u.PhysXJointFunction.SetDrive:s=e.id;var Q=e.drive,K=e.driveStiffness,Y=e.driveDamping;w=e.driveForceLimit,(Z=i._joints.get(s))&&Z.setDrive(Q,K,Y,w);break;case u.PhysXJointFunction.SetDriveVelocityD6:s=e.id,p=e.linear,m=e.angular,(Z=i._joints.get(s))&&Z.setDriveVelocityD6(p,m);break;case u.PhysXJointFunction.SetDrivePosition:s=e.id;var Z,$=e.pos,tt=e.quat;(Z=i._joints.get(s))&&Z.setDrivePosition($,tt)}}))()}createGeometry(t){var e=t.geometryType,i=t.id,s=null;if("Box"==e){var o=t.size;s=new F(i,o)}else if("Sphere"==e){var r=t.radius;s=new k(i,r)}else if("Plane"==e)s=new A(i);else if("Capsule"==e){r=t.radius;var a=t.height;s=new b(i,r,a)}else if("ConvexMesh"==e){var n=t.vertices,l=t.scale;s=new M(i,n,l)}else if("TriangleMesh"==e){n=t.vertices;var c=t.indexes,h=(l=t.scale,t.obbSize);s=new w(i,n,c,l,h)}return s}getActorIdByPointer(t){var e=null,i=t.$$.ptr;return this._actors.forEach((function(t,s){e||t._pxActor.$$.ptr!=i||(e=s)})),e}getShapeIdByPointer(t){var e=null,i=t.$$.ptr;return this._shapes.forEach((function(t,s){e||t._pxShape.$$.ptr!=i||(e=s)})),e}eventCollisionCallback(t,e){t!=u.PhysXGlobalFunction.OnContactBegin&&t!=u.PhysXGlobalFunction.OnContactEnd&&t!=u.PhysXGlobalFunction.OnColliderEnter&&t!=u.PhysXGlobalFunction.OnColliderLeave||this._cacheEvent.push(new Uint32Array([t,e.actor0,e.shape0,e.actor1,e.shape1]))}onMessage(t){var e=this;return(0,l.default)((function*(){var i=null,s=t.type,o=t.param;return u.PhysXActorFunction[s]?i=yield e.PhysXActorFunction(s,o):u.PhysXGlobalFunction[s]?i=yield e.PhysXGlobalFunction(s,o):u.PhysXSceneFunction[s]?i=yield e.PhysXSceneFunction(s,o):u.PhysXShapeFunction[s]?i=yield e.PhysXShapeFunction(s,o):u.PhysXMaterialFunction[s]?i=yield e.PhysXMaterialFunction(s,o):u.PhysXGeometryFunction[s]?i=yield e.PhysXGeometryFunction(s,o):u.PhysXControllerFunction[s]?i=yield e.PhysXControllerFunction(s,o):u.PhysXJointFunction[s]&&(i=yield e.PhysXJointFunction(s,o)),i}))()}setPostMessageFunction(t){this._postMessage=t}update(t){this._scenes.forEach((function(e,i){e.update(t)})),this.updateTransform(t),this.updateEvent(t),this.postMessage(u.PhysXGlobalFunction.CanSendAllActorTransformFromMain,{})}postMessage(t,e,i){void 0===i&&(i=[]),this._postMessage&&this._postMessage({type:t,param:e},null,i)}updateEvent(t){var e=this._cacheEvent,i=e.length;if(i>0){for(var s=new Uint32Array(5*i),o=[],r=0;r<i;r++)s.set(e[r],5*r+0);o.push(s.buffer),this.postMessage(u.PhysXGlobalFunction.SetAllCollisionEvent,s,o),this._cacheEvent.length=0}}updateTransform(t){if(this._enableSyncActorTransform){var e={actors:{transforms:null,length:0},controllers:[]},i=[],s=new Float32Array(8*this._actors.size),o=0;this._actors.forEach((function(t,e){(t.forceSyncTransformToMain||t.scene&&t instanceof m&&!t.isSleeping())&&(t.forceSyncTransformToMain=!1,s[8*o+0]=e,t.copyWorldTransformArray(s,8*o+1),o++)})),e.actors.transforms=s,e.actors.length=o,i.push(s.buffer),this._controllers.forEach((function(i,s){e.controllers.push({id:s,transform:i.getWorldTransform(t)})})),(e.actors.length||e.controllers.length)&&this.postMessage(u.PhysXGlobalFunction.SetAllActorTransform,e,i),this._enableSyncActorTransform=!1}else this._actors.forEach((function(t,e){t.scene&&t instanceof m&&!t.isSleeping()&&(t.forceSyncTransformToMain=!0)}))}static getInstance(){return z.instance=z.instance||new z,z.instance}}z.instance=null;class q{constructor(){console.error("Can not instantiate this type")}static syncColliderTransform(t){for(var e={position:[],rotation:[]},i=0;i<t.actors.length;i++){var s=t.actors.transforms,o=parseInt(s[8*i+0]);e.rotation=[s[8*i+1],s[8*i+2],s[8*i+3],s[8*i+4]],e.position=[s[8*i+5],s[8*i+6],s[8*i+7]],(r=q.colliderMap.get(o))&&r.syncColliderTransform(e)}for(i=0;i<t.controllers.length;i++){var r;o=t.controllers[i].id,e=t.controllers[i].transform,(r=q.controllerMap.get(o))&&r.syncColliderTransform(e)}}static addCollider(t,e){q.colliderMap.set(t,e)}static removeCollider(t){q.colliderMap.delete(t)}static addController(t,e){q.controllerMap.set(t,e)}static removeController(t){q.controllerMap.delete(t)}static onAllCollisionEvent(t){for(var e=0;e<t.length;e+=5){var i=t[e],s=q.getEventParamObjectByID(t[e+1],t[e+2],t[e+3],t[e+4]);i==u.PhysXGlobalFunction.OnColliderEnter?(s.actor0&&s.actor0.onColliderTriggerEnter(s.shape0,s.actor1,s.shape1),s.actor1&&s.actor1.onColliderTriggerEnter(s.shape1,s.actor0,s.shape0)):i==u.PhysXGlobalFunction.OnColliderLeave?(s.actor0&&s.actor0.onColliderTriggerLeave(s.shape0,s.actor1,s.shape1),s.actor1&&s.actor1.onColliderTriggerLeave(s.shape1,s.actor0,s.shape0)):i==u.PhysXGlobalFunction.OnContactBegin?(s.actor0&&s.actor1&&(s.shape0&&s.shape0.isTrigger||s.shape1&&s.shape1.isTrigger)&&(s.actor0&&s.actor0.onColliderTriggerEnter(s.shape0,s.actor1,s.shape1),s.actor1&&s.actor1.onColliderTriggerEnter(s.shape1,s.actor0,s.shape0)),s.actor0&&s.actor0.onColliderContactBegin(s.shape0,s.actor1,s.shape1),s.actor1&&s.actor1.onColliderContactBegin(s.shape1,s.actor0,s.shape0)):i==u.PhysXGlobalFunction.OnContactEnd&&(s.actor0&&s.actor1&&(s.shape0&&s.shape0.isTrigger||s.shape1&&s.shape1.isTrigger)&&(s.actor0&&s.actor0.onColliderTriggerLeave(s.shape0,s.actor1,s.shape1),s.actor1&&s.actor1.onColliderTriggerLeave(s.shape1,s.actor0,s.shape0)),s.actor0&&s.actor0.onColliderContactEnd(s.shape0,s.actor1,s.shape1),s.actor1&&s.actor1.onColliderContactEnd(s.shape1,s.actor0,s.shape0))}}static onControllerEvent(t){var e=t.id,i=q.controllerMap.get(e);i&&i.onControllerEvent(t)}static getEventParamObjectByID(t,e,i,s){var o=q.colliderMap.get(t),r=q.colliderMap.get(i),a=null,n=null;return o&&r&&(a=o.getShape(e),n=r.getShape(s)),{actor0:o,actor1:r,shape0:a,shape1:n}}}q.colliderMap=new Map,q.controllerMap=new Map;class U{constructor(){this._idBase=1,this._callbackMap=new Map}onMessage(t){var e=t.id;if(e&&e>0)this._callbackMap.has(e)&&(this._callbackMap.get(e)(t.ret),this._callbackMap.delete(e));else{var i=t.param;switch(t.type){case u.PhysXGlobalFunction.SetAllActorTransform:q.syncColliderTransform(i);break;case u.PhysXGlobalFunction.SetAllCollisionEvent:q.onAllCollisionEvent(i);break;case u.PhysXGlobalFunction.CanSendAllActorTransformFromMain:Q.getInstance().onCanSendAllActorTransformFromMain();break;case u.PhysXControllerFunction.OnControllerEvent:q.onControllerEvent(i)}e&&e<0&&this.postMessage({id:e,type:"Callback",ret})}}postMessage(t,e){var i=this;return(0,l.default)((function*(){if(i._enableWorker)e&&(t.id=i._idBase++,i._callbackMap.set(t.id,e)),i._worker&&i._worker.postMessage(t),t.type==u.PhysXGlobalFunction.ReleaseWorker&&(i._worker.terminate(),i._worker=null);else{var s=yield i._physXSystem.onMessage(t);e&&e(s)}}))()}update(t){this._enableWorker||this._physXSystem.update(t)}Init(t){var e=this;return(0,l.default)((function*(){if(void 0===t&&(t=!0),e._enableWorker=t,t){e._worker||(e._worker=new Worker(new URL(o.p+o.u("src_workers_nvphysx_worker_js"),o.b)));var i=e;e._worker.onmessage=function(t){i.onMessage(t.data)}}else{e._physXSystem=z.getInstance(),e._physXSystem.setPostMessageFunction(e.onMessage);var s=1e3/60,r=new Date;self.fps=1,setInterval((()=>{var t=new Date,i=t-r;self.fps=parseInt(1e3/i),self.fps=self.fps>60?60:self.fps,r=t,e.update(s/1e3)}),s)}}))()}static getInstance(){return U.instance=U.instance||new U,U.instance}}U.instance=null;class Q{constructor(){this._workerAdapter=null,this._enableHelper=!1,this._init=!1,this._app=null,this._worldComponents=[]}initWorker(t){var e=this;return(0,l.default)((function*(){void 0===t&&(t=!0),e._workerAdapter=U.getInstance(),yield e._workerAdapter.Init(t)}))()}initPhysX(t,e,i){var s=this;return(0,l.default)((function*(){var o=s;return new Promise((function(s,r){o._workerAdapter.postMessage({type:u.PhysXGlobalFunction.InitPhysX,param:{physXPath:t,enablePVD:e,enableWorker:i}},(function(t){s()}))}))}))()}releasePhysX(){var t=this;return(0,l.default)((function*(){t._enableHelper=!1,t._init=!1,t._app=null,t._workerAdapter.postMessage({type:u.PhysXGlobalFunction.ReleasePhysX}),t._workerAdapter.postMessage({type:u.PhysXGlobalFunction.ReleaseWorker})}))()}init(t){var e=this;return(0,l.default)((function*(){if(!e._init){var i=null==t.enableWorker||t.enableWorker,s=d.parseValue(t.physXPath,"./js/thing.physx.libs");e._enablePVD=d.parseValue(t.enablePVD,!1),e._enableHelper=d.parseValue(t.enableHelper,!1),yield e.initWorker(i),yield e.initPhysX(s,e._enablePVD,i),e._init=!0}}))()}update(){this._init&&this._workerAdapter.postMessage({type:u.PhysXGlobalFunction.CanSendAllActorTransformFromWorker})}onCanSendAllActorTransformFromMain(){for(var t=0;t<this._worldComponents.length;t++)this._worldComponents[t].canSendTransform()}addWorldComponent(t){this._worldComponents.push(t)}removeWorldComponent(t){this._worldComponents.splice(this._worldComponents.indexOf(t),1)}get enableHelper(){return this._enableHelper}get enablePVD(){return this._enablePVD}static getInstance(){return Q.instance}static init(t){return(0,l.default)((function*(){yield Q.instance.init(t)}))()}}Q.instance=new Q;class K{constructor(t){void 0===t&&(t={}),this._workerAdapter=U.getInstance(),this._id=K.idBase++,this._gravity=t.gravity||[0,-9.8,0],this.createScene()}get id(){return this._id}createScene(){this._workerAdapter.postMessage({type:u.PhysXSceneFunction.CreateScene,param:{id:this._id,gravity:this._gravity}})}get gravity(){return this._gravity}set gravity(t){t!=this._gravity&&(this._gravity=t,this._workerAdapter.postMessage({type:u.PhysXSceneFunction.SetGravity,param:{id:this._id,gravity:t}}))}attachToScene(t){this._workerAdapter.postMessage({type:u.PhysXSceneFunction.AddActor,param:{sceneId:this._id,actorId:t.id}})}detachFromScene(t){this._workerAdapter.postMessage({type:u.PhysXSceneFunction.RemoveActor,param:{sceneId:this._id,actorId:t.id}})}batchSetTransform(t){this._workerAdapter.postMessage({type:u.PhysXSceneFunction.BatchSetTransform,param:{transforms:t}})}destroy(){this._workerAdapter.postMessage({type:u.PhysXSceneFunction.ReleaseScene,param:{id:this._id}})}raycastSingle(t,e,i){var s=this;return(0,l.default)((function*(){var o=s;return new Promise((function(s,r){o._workerAdapter.postMessage({type:u.PhysXSceneFunction.RaycastSingle,param:{sceneId:o._id,origin:t,direction:e,distance:i}},(function(t){s(t)}))}))}))()}}K.idBase=1;var Y=null;class Z extends c.BaseComponent{constructor(t){void 0===t&&(t={}),super(),this._scene=null,this._afterRenderCallback=this.onAfterRender.bind(this),this._actorComponents=new Set,this._cacheTransform=new Map,this._canSendTransform=!0,this._rootObject=null,this._gravity=[0,-9.8,0],Y=this}get id(){return this._scene&&this._scene.id}onAdd(t){"RootObject"===t.type?(this._host=t,this._scene||(this._scene=new K({gravity:this._gravity})),this._host.app.scene.addAfterRenderCallback(this._afterRenderCallback)):console.error("PhysicsWorldComponent can only added to root node.")}onRemove(){this._scene.destroy(),Q.getInstance().removeWorldComponent(this),Q.getInstance().releasePhysX(),this._host.app.scene.removeAfterRenderCallback(this._afterRenderCallback),this._actorComponents=new Set,this._cacheTransform=new Map,this._scene=null,Y==this&&(Y=null)}onAfterRender(){Q.getInstance().update();var t=this._cacheTransform;this._actorComponents.forEach((function(e){e.onUpdateTransform((function(e){t.set(e.id,e)}))})),t.size&&this._canSendTransform&&(this._scene.batchSetTransform([...t.values()]),this._canSendTransform=!1)}canSendTransform(){this._canSendTransform=!0}get gravity(){return this._scene&&this._scene.gravity}set gravity(t){this._gravity=t,this._scene&&(this._scene.gravity=t)}get rootObject(){return this._rootObject}set rootObject(t){this._rootObject=t}attachToScene(t){this._scene&&(this._scene.attachToScene(t.getActor()),this._actorComponents.add(t))}detachFromScene(t){this._scene&&(this._scene.detachFromScene(t.getActor()),this._actorComponents.delete(t))}get scene(){return this._scene}init(t){var e=this;return(0,l.default)((function*(){var i=Q.getInstance();yield i.init(t),i.addWorldComponent(e),t.gravity&&(e.gravity=t.gravity),t.rootObject&&(e.rootObject=t.rootObject)}))()}static getCurrentPhysicsWorldComponent(){return Y}}Z.idBase=1;var $=o("@uino/base-thing");class tt{constructor(t){void 0===t&&(t={}),this._id=tt.idBase++,this._staticFriction=t.staticFriction||.5,this._dynamicFriction=t.dynamicFriction||.5,this._restitution=t.restitution||.5,this._workerAdapter=U.getInstance(),this.createMaterial()}postMessageToWorker(t,e){this._workerAdapter.postMessage({type:t,param:e})}createMaterial(){this.postMessageToWorker(u.PhysXMaterialFunction.CreateMaterial,{id:this._id,staticFriction:this._staticFriction,dynamicFriction:this._dynamicFriction,restitution:this._restitution})}destroy(){this.release()}release(){this.postMessageToWorker(u.PhysXMaterialFunction.ReleaseMaterial,{id:this._id})}get staticFriction(){return this._staticFriction}set staticFriction(t){this._staticFriction=t,this.postMessageToWorker(u.PhysXMaterialFunction.SetStaticFriction,{id:this._id,staticFriction:this.staticFriction})}get dynamicFriction(){return this._dynamicFriction}set dynamicFriction(t){this._dynamicFriction=t,this.postMessageToWorker(u.PhysXMaterialFunction.SetDynamicFriction,{id:this._id,dynamicFriction:this.dynamicFriction})}get restitution(){return this._restitution}set restitution(t){this._restitution=t,this.postMessageToWorker(u.PhysXMaterialFunction.SetRestitution,{id:this._id,restitution:this.restitution})}get id(){return this._id}}tt.idBase=1;class et{constructor(t){void 0===t&&(t={}),this._id=et.idBase++,this._geometry=t.geometry,this._material=t.material,this._localPosition=[0,0,0],this._localRotation=[0,0,0,1],this._isTrigger=!1,this._shared=t.shared||!1,this._workerAdapter=U.getInstance(),this.constructor.name===et.name&&this.createShape()}postMessageToWorker(t,e){this._workerAdapter.postMessage({type:t,param:e})}get id(){return this._id}get localPosition(){return this._localPosition}set localPosition(t){this._localPosition=t,this.postMessageToWorker(u.PhysXShapeFunction.SetLocalPosition,{id:this._id,localPosition:this._localPosition})}get localRotation(){return this._localRotation}set localRotation(t){this._localRotation=t,this.postMessageToWorker(u.PhysXShapeFunction.SetLocalRotation,{id:this._id,localRotation:this._localRotation})}get isTrigger(){return this._isTrigger}set isTrigger(t){t&&this._geometry instanceof w?console.error("TriangleMeshGeometry can not set isTrigger=true"):(this._isTrigger=t,this.postMessageToWorker(u.PhysXShapeFunction.SetIsTrigger,{id:this._id,isTrigger:this._isTrigger}))}setMaterial(t){this._material=t,this.postMessageToWorker(u.PhysXShapeFunction.SetMaterial,{id:this._id,materialId:t.id})}setGeometry(t){this._geometry=t,this.postMessageToWorker(u.PhysXShapeFunction.SetGeometry,{id:this._id,geometryId:t.id})}get geometry(){return this._geometry}createShape(){this.postMessageToWorker(u.PhysXShapeFunction.CreateShape,{id:this._id,geometryId:this._geometry.id,materialId:this._material.id,shared:this._shared})}destroy(){this.release()}release(){this.postMessageToWorker(u.PhysXShapeFunction.ReleaseShape,{id:this._id})}}et.idBase=1;class it{constructor(t){this._id=it.idBase++,this._workerAdapter=U.getInstance(),this._transformCallback=null,this._onControllerEvent=null,this._component=t.component,this._currentScene=t.world,this._actor=null,q.addController(this._id,this)}postMessageToWorker(t,e){this._workerAdapter.postMessage({type:t,param:e})}moveController(t,e){this.postMessageToWorker(u.PhysXControllerFunction.MoveController,{id:this._id,target:e,deltaTime:t})}jump(t){void 0===t&&(t=4),this.postMessageToWorker(u.PhysXControllerFunction.ControllerJump,{id:this._id,velocity:t})}disableGravity(t){this.postMessageToWorker(u.PhysXControllerFunction.DisableControllerGravity,{id:this._id,disable:t})}release(){this._transformCallback=null,this._onControllerEvent=null,q.removeController(this._id),this.postMessageToWorker(u.PhysXControllerFunction.ReleaseController,{id:this._id}),this._component=null,this._currentScene=null,this._actor&&(this._actor.destroy(),this._actor=null)}destroy(){this.release()}syncColliderTransform(t){this._transformCallback&&this._transformCallback(t)}setSyncColliderTransformCallback(t){this._transformCallback=t}onControllerEvent(t){this._onControllerEvent&&this._onControllerEvent(t)}setControllerEventCallback(t){this._onControllerEvent=t}setCameraDistanceScale(t){this.postMessageToWorker(u.PhysXControllerFunction.SetCameraDistanceScale,{id:this._id,cameraDistanceScale:t})}setCameraForward(t){this.postMessageToWorker(u.PhysXControllerFunction.SetCameraForward,{id:this._id,forward:t})}}it.idBase=1;class st extends it{constructor(t){void 0===t&&(t={}),super(t),this._radius=t.radius||.5,this._height=t.height||1,this._position=t.position||[0,0,0],this._material=t.material||new tt,this._cameraDistanceScale=t.cameraDistanceScale,this._ignoreEyeObstruction=t.ignoreEyeObstruction,this.createController()}createController(){this._actor=new at({component:this._component}),this.postMessageToWorker(u.PhysXControllerFunction.CreateController,{id:this._id,sceneId:this._currentScene.id,radius:this._radius,height:this._height,position:this._position,materialId:this._material.id,actorId:this._actor.id,cameraDistanceScale:this._cameraDistanceScale,ignoreEyeObstruction:this._ignoreEyeObstruction})}getActor(){return this._actor}get radius(){return this._radius}set radius(t){this._radius=t,this.postMessageToWorker(u.PhysXControllerFunction.SetCapsuleRaidus,{id:this._id,radius:this._radius})}get height(){return this._height}set height(t){this._height=t,this.postMessageToWorker(u.PhysXControllerFunction.SetCapsuleHeight,{id:this._id,height:this._height})}}class ot{constructor(){this._state=i.Idle}get state(){return this._state}setMove(t){void 0===t&&(t=!1),this._state!=i.Fall&&this._state!=i.Jump&&this._state!=i.WalkJump&&(this._state=t?i.Run:i.Walk)}setJump(){this._state==i.Run||this._state==i.Walk?this._state=i.WalkJump:this._state=i.Jump}setFinishedJump(){this._state=i.Idle}setFall(){this._state=i.Fall}setIdle(){this._state!=i.Jump&&this._state!=i.Fall&&this._state!=i.Landing&&(this._state=i.Idle)}setLanding(){this._state=i.Landing}}class rt{constructor(t){this._radius=t.radius||.5,this._height=t.height||1,this._mForward=!1,this._mBackward=!1,this._mLeft=!1,this._mRight=!1,this._mRun=!1,this._app=null,this._appEvent={},this._halfHeight=this._radius+this._height/2,this._enable=!0,this._cameraDistanceScale=t.cameraDistanceScale||0,this._autoComputeDistanceScale=t.autoComputeDistanceScale,this._minCameraDistanceScale=t.minCameraDistanceScale||1,this._maxCameraDistanceScale=t.maxCameraDistanceScale||20,this._ignoreEyeObstruction=t.ignoreEyeObstruction||!1,this._controller=null,this._actor=null,this._eventDispatcher=new $.EventDispatcher,this._localPosition=t.localPosition||[0,0,0],this._walkSpeed=t.walkSpeed||5,this._runSpeed=t.runSpeed||10,this._rotateYSpeed=t.rotateYSpeed||.1,this._rotateXSpeed=t.rotateXSpeed||.1,this._autoComputeCapsuleInfo=t.autoComputeCapsuleInfo,this._contactOffset=.1,this._rootObject=d.getRootObject(),this._draging=!1,this._mousePosition=[0,0],this._spherePosition=[0,0],this._enableLockPointer=t.enableLockPointer,this._animateState=new ot,this._currentAnimateState="",this._currentMoveTarget=[0,0,0],this._onBlur=null,this._camera=null,this._oldCameraNear=.1,this._oldCameraFov=50,this._lockChangeCallback=null,this._listeners=new Map}moveLeft(t){this._mLeft=t}moveRight(t){this._mRight=t}moveForward(t){this._mForward=t}moveBackward(t){this._mBackward=t}moveRun(t){this._mRun=t}updateWalk(t){if(this._mBackward||this._mForward||this._mLeft||this._mRight){var e=d.getRelativeInfo(this.getRootObject(),this._camera).relativeForward;e[1]=0,e=THING.Math.normalizeVector(e);var i=THING.Math.crossVector(e,[0,1,0]),s=[0,0,0];if(this._mForward&&(s=THING.Math.addVector(s,e)),this._mBackward&&(s=THING.Math.subVector(s,e)),this._mRight&&(s=THING.Math.addVector(s,i)),this._mLeft&&(s=THING.Math.subVector(s,i)),s=THING.Math.scaleVector(s,this._mRun?this._runSpeed:this._walkSpeed),s=THING.Math.scaleVector(s,t),this._mBackward+this._mForward+this._mLeft+this._mRight>=2&&(s[0]*=.707,s[2]*=.707),0==s[0]&&0==s[1]&&0==s[2])return;this._controller&&this._controller.moveController(t,s),this._animateState.setMove(this._mRun),this.updateMoveDirection(s)}else this._animateState.setIdle()}onUpdate(t){this._enable&&(this.updateWalk(t),this.updateAnimateState())}jump(t){void 0===t&&(t=4),this._controller&&this._controller.jump(t)}disableGravity(t){void 0===t&&(t=!0),this._controller&&this._controller.disableGravity(t)}get controller(){return this._controller}onAdd(t){this._host=t;var e=d.getRelativeInfo(this.getRootObject(),t);this._position=e.relativePosition,this._app=t.app,Q.getInstance().enableHelper&&(this._host.helper.orientedBox.visible=!0,this._host.helper.axes=!0);var i=this._app.camera;i.enable=!1,this._oldCameraNear=i.near,this._oldCameraFov=i.fov,i.near=.1,this._camera=i,this.createController(),this.setOrientation(i),this._appEvent.keydown="physicsFirstPersonKeydown",this._appEvent.keyup="physicsFirstPersonKeyup",this._appEvent.mousedown="physicsFirstPersonMousedown",this._appEvent.mouseup="physicsFirstPersonMouseup",this._appEvent.mousemove="physicsFirstPersonMousemove",this._appEvent.wheel="physicsFirstPersonWheel",this._onBlur=this.onBlur.bind(this),t.app.on("keydown",this.onKeyDown.bind(this),this._appEvent.keydown),t.app.on("keyup",this.onKeyUp.bind(this),this._appEvent.keyup),t.app.on("mousedown",this.onMouseDown.bind(this),this._appEvent.mousedown),t.app.on("mouseup",this.onMouseUp.bind(this),this._appEvent.mouseup),t.app.on("mousemove",this.onMouseMove.bind(this),this._appEvent.mousemove),t.app.on("wheel",this.onMouseWheel.bind(this),this._appEvent.wheel),window.addEventListener("blur",this._onBlur);var s=this._host.app.view.getContainer(),o=this.lockPointerEvent.bind(this);this._lockChangeCallback=()=>{document.pointerLockElement==s?document.addEventListener("mousemove",o,!1):document.removeEventListener("mousemove",o,!1)},document.addEventListener("pointerlockchange",this._lockChangeCallback,!1)}getRootObject(){return this._rootObject}createController(){if(this._autoComputeCapsuleInfo){var t=d.computeOBB(this._host);this._radius=Math.min(t.size[0],t.size[2])/2,this._height=t.size[1]-2*this._radius,this._height=this._height>=0?this._height:.01,this._localPosition=t.localPosition,this._localPosition[1]+=this._contactOffset}this._halfHeight=this._radius+this._height/2;var e=THING.Math.addVector(THING.Math.addVector(this._localPosition,this._position),[0,this._halfHeight+.1,0]);if(this._autoComputeDistanceScale){var i=d.positionSelfToWorld(this.getRootObject(),e);this._camera.lookAt(i);var s=THING.Math.subVector(i,this._camera.position),o=THING.Math.divideVector(s,this._camera.forward);this._cameraDistanceScale=Math.max(Math.min(o[0],this._maxCameraDistanceScale),this._minCameraDistanceScale)}if(!this._cameraDistanceScale){var r=d.positionSelfToWorld(this.getRootObject(),e);this._camera.position=r,this._camera.lookAt(THING.Math.addVector(r,this._host.forward))}this._controller=new st({radius:this._radius,height:this._height,world:d.getCurrentSceneComponent(),position:THING.Math.addVector(this._localPosition,this._position),component:this,cameraDistanceScale:this._cameraDistanceScale,ignoreEyeObstruction:this._ignoreEyeObstruction});var a=d.getRelativeInfo(this.getRootObject(),this._camera);this._controller.setCameraForward(a.relativeForward),this._controller.setSyncColliderTransformCallback(this.syncColliderTransform.bind(this)),this._controller.setControllerEventCallback(this.onControllerEvent.bind(this)),this._actor=this._controller.getActor()}addShape(t){this._actor.addShape(t)}removeShape(t){this._actor.removeShape(t)}onRemove(){var t=this._app.camera;for(var e in t.enable=!0,t.near=this._oldCameraNear,t.fov=this._oldCameraFov,this.enable=!1,this._appEvent)this._host.app.off(e,this._appEvent[e]);q.removeCollider(this._id),this._eventDispatcher.clear(),window.removeEventListener("blur",this._onBlur),this._controller&&this._controller.release(),document.removeEventListener("pointerlockchange",this._lockChangeCallback,!1),this._lockChangeCallback=null,this._host=null,this._actor=null}onKeyDown(t){var e=t.code;"KeyW"==e?this.moveForward(!0):"KeyA"==e?this.moveLeft(!0):"KeyS"==e?this.moveBackward(!0):"KeyD"==e?this.moveRight(!0):"ShiftLeft"==e?this.moveRun(!0):"Space"==e&&this.jump()}onKeyUp(t){var e=t.code;"KeyW"==e?this.moveForward(!1):"KeyA"==e?this.moveLeft(!1):"KeyS"==e?this.moveBackward(!1):"KeyD"==e?this.moveRight(!1):"ShiftLeft"==e&&this.moveRun(!1)}onBlur(){this.moveForward(!1),this.moveBackward(!1),this.moveLeft(!1),this.moveRight(!1),this.moveRun(!1)}lockPointerEvent(t){this.updateCameraLookAt(-t.movementX,-t.movementY)}lockPointer(){this._enableLockPointer&&this._host.app.view.getContainer().requestPointerLock()}onMouseDown(t){this._draging=!0,this._mousePosition=[t.x,t.y],this.lockPointer()}onMouseUp(t){this._draging=!1}onControllerEvent(t){var e=t.state;e==u.PhysXControllerFunction.ControllerEventType.OnJumping?this._animateState.setJump():e==u.PhysXControllerFunction.ControllerEventType.OnFinishJump?this._animateState.setFinishedJump():e==u.PhysXControllerFunction.ControllerEventType.OnFalling||u.PhysXControllerFunction.ControllerEventType.OnFalled}syncColliderTransform(t){this._host.position=d.positionSelfToWorld(this.getRootObject(),THING.Math.subVector(t.position,this._localPosition)),this._camera.position=d.positionSelfToWorld(this.getRootObject(),t.cameraPosition);var e=d.positionSelfToWorld(this.getRootObject(),t.cameraTarget);this._camera.lookAt(e)}updateCameraLookAt(t,e){var i=this._spherePosition[0]+t*this._rotateXSpeed,s=this._spherePosition[1]+e*this._rotateYSpeed;s=Math.max(-85,Math.min(85,s));var o=THING.Math.degToRad(90-s),r=THING.Math.degToRad(i),a=this.setFromSphericalCoords(1,o,r);this._spherePosition=[i,s],this._controller.setCameraForward(THING.Math.normalizeVector(a))}onMouseMove(t){if(this._draging){var e=t.x,i=t.y,s=this._mousePosition,o=s[0]-e,r=s[1]-i;this.updateCameraLookAt(o,r),this._mousePosition=[e,i]}}onMouseWheel(t){var e=this._cameraDistanceScale+(t.delta>=0?.5:-.5);e<this._maxCameraDistanceScale&&e>this._minCameraDistanceScale&&(this._cameraDistanceScale=e,this._controller.setCameraDistanceScale(this._cameraDistanceScale))}setFromSphericalCoords(t,e,i){var s=Math.sin(e)*t;return[s*Math.sin(i),Math.cos(e)*t,s*Math.cos(i)]}applyQuaternion(t,e){var i=t[0],s=t[1],o=t[2],r=e[0],a=e[1],n=e[2],l=e[3],c=l*i+a*o-n*s,h=l*s+n*i-r*o,d=l*o+r*s-a*i,u=-r*i-a*s-n*o;return[c*l+u*-r+h*-n-d*-a,h*l+u*-a+d*-r-c*-n,d*l+u*-n+c*-a-h*-r]}setFromCartesianCoords(t,e,i){var s=Math.sqrt(t*t+e*e+i*i),o=0,r=0;return 0===s?(o=0,r=0):(o=Math.atan2(t,i),r=Math.acos(THING.MathUtils.clamp(e/s,-1,1))),{theta:o,phi:r,radius:s}}setOrientation(t){var e=d.getRelativeInfo(this.getRootObject(),t).relativeRotation,i=this.applyQuaternion([0,0,-1],e),s=this.setFromCartesianCoords(i[0],i[1],i[2]),o=90-THING.MathUtils.radToDeg(s.phi),r=THING.MathUtils.radToDeg(s.theta);this._spherePosition=[r,o]}addEventListener(t,e){this._eventDispatcher.addEventListener(t.toLowerCase(),e)}removeEventListener(t,e){this._eventDispatcher.removeEventListener(t.toLowerCase(),e)}addEventListenerByTag(t,e,i){this.addEventListener(t,e),this._listeners[i]=e}removeEventListenerByTag(t,e){this.removeEventListener(t,this._listeners[e]),this._listeners.delete(e)}updateMoveDirection(t){if(this._currentMoveTarget[0]!=t[0]||this._currentMoveTarget[1]!=t[1]||this._currentMoveTarget[2]!=t[2]){var i=THING.Math.getQuatFromTarget([0,0,0],t,[0,1,0]);i=d.quatSelfToWorld(this.getRootObject(),i),this._eventDispatcher.dispatchEvent({type:e.ChangeMoveDirection.toLowerCase(),component:this,object:this._host,direction:i}),this._currentMoveTarget=t}}getCurrentAnimateState(){return this._animateState.state}updateAnimateState(){this._animateState.state!=this._currentAnimateState&&(this._currentAnimateState=this._animateState.state,this._eventDispatcher.dispatchEvent({type:e.ChangeAnimation.toLowerCase(),animateType:this._currentAnimateState,component:this,object:this._host}))}}class at{constructor(t){void 0===t&&(t={}),this._id=at.idBase++,this._shapes=[],this._workerAdapter=U.getInstance(),this._enable=!0,this._transformCallback=null,this._contactBeginCallback=null,this._contactEndCallback=null,this._triggerEnterCallback=null,this._triggerLeaveCallback=null,this._component=t.component,q.addCollider(this._id,this)}postMessageToWorker(t,e){this._workerAdapter.postMessage({type:t,param:e})}get component(){return this._component}get id(){return this._id}getShapes(){return this._shapes}getShape(t){for(var e=0;e<this._shapes.length;e++)if(this._shapes[e].id==t)return this._shapes[e];return null}addShape(t){t&&(this._shapes.push(t),this.postMessageToWorker(u.PhysXActorFunction.AddShape,{actorId:this.id,shapeId:t.id}))}removeShape(t){var e=this._shapes.indexOf(t);-1!==e&&(this._shapes.splice(e,1),this.postMessageToWorker(u.PhysXActorFunction.RemoveShape,{actorId:this.id,shapeId:t.id}))}clearShapes(){for(var t=this._shapes.length-1;t>=0;t--)this.removeShape(this._shapes[t])}get enable(){return this._enable}set enable(t){this._enable=t,this.postMessageToWorker(u.PhysXActorFunction.SetEnable,{id:this._id,enable:this._enable})}setTransform(t,e){void 0===t&&(t=[0,0,0]),void 0===e&&(e=[0,0,0,1]),this.postMessageToWorker(u.PhysXActorFunction.SetTransform,{position:t,rotation:e,id:this._id})}destroy(){q.removeCollider(this._id),this._component instanceof rt?this._component=null:(this.enable=!1,this._component=null,this.postMessageToWorker(u.PhysXActorFunction.ReleaseActor,{id:this._id}))}syncColliderTransform(t){this._enable&&this._transformCallback&&this._transformCallback(t)}setSyncColliderTransformCallback(t){this._transformCallback=t}onColliderTriggerEnter(t,e,i){this._triggerEnterCallback&&this._triggerEnterCallback(t,e,i)}setTriggerEnterCallback(t){this._triggerEnterCallback=t}onColliderTriggerLeave(t,e,i){this._triggerLeaveCallback&&this._triggerLeaveCallback(t,e,i)}setTriggerLeaveCallback(t){this._triggerLeaveCallback=t}onColliderContactBegin(t,e,i){this._contactBeginCallback&&this._contactBeginCallback(t,e,i)}setContactBeginCallback(t){this._contactBeginCallback=t}onColliderContactEnd(t,e,i){this._contactEndCallback&&this._contactEndCallback(t,e,i)}setContactEndCallback(t){this._contactEndCallback=t}}at.idBase=1;class nt extends at{constructor(t){void 0===t&&(t={}),super(t),this.createStaticCollider(t.position,t.rotation)}createStaticCollider(t,e){this.postMessageToWorker(u.PhysXActorFunction.CreateStaticActor,{position:t,rotation:e,id:this._id})}}class lt extends c.BaseComponent{constructor(t){void 0===t&&(t={}),super(),this._host=null,this._enable=!0,this._eventDispatcher=new $.EventDispatcher,this._position=[0,0,0],this._rotation=[0,0,0,1],this._physicsPosition=[0,0,0],this._physicsRotation=[0,0,0,1],this._physicsChange=!1,this._enableSyncToPhysics=t.enableSyncToPhysics,this._actor=null,this._rootObject=d.getRootObject(),this._listeners=new Map}getHost(){return this._host}getActor(){return this._actor}getShapes(){return this._actor.getShapes()}addShape(t){this._actor.addShape(t),t.recalcRelativeInfo&&t.recalcRelativeInfo(this._host)}removeShape(t){this._actor.removeShape(t)}clearShapes(){this._actor.clearShapes()}attachToScene(){var t=d.getCurrentSceneComponent();t?t.attachToScene(this):console.error("Must add PhysicsWorldComponent to app.root")}detachFromScene(){var t=d.getCurrentSceneComponent();t&&t.detachFromScene(this)}onAdd(t){this._host=t,Q.getInstance().enableHelper&&(this._host.helper.orientedBox.visible=!0,this._host.helper.axes=!0);var e=d.getRelativeInfo(this._rootObject,t);this._position=e.relativePosition,this._rotation=e.relativeRotation,this._physicsPosition=this._position,this._physicsRotation=this._rotation,this._actor.setTransform(this._position,this._rotation)}onAfterAdd(){var t=this._actor.getShapes();for(var e in t)t[e].recalcRelativeInfo&&t[e].recalcRelativeInfo(this._host);this.attachToScene();var i=this;this._actor.setSyncColliderTransformCallback((function(t){i._enable&&(i._physicsPosition=d.positionSelfToWorld(i._rootObject,t.position),i._physicsRotation=d.quatSelfToWorld(i._rootObject,t.rotation),i._physicsChange=!0)})),this._actor.setTriggerEnterCallback(this.onColliderTriggerEnter.bind(this)),this._actor.setTriggerLeaveCallback(this.onColliderTriggerLeave.bind(this)),this._actor.setContactBeginCallback(this.onColliderContactBegin.bind(this)),this._actor.setContactEndCallback(this.onColliderContactEnd.bind(this))}onRemove(){this._eventDispatcher.clear(),this._actor.enable=!1,this.detachFromScene(),this._actor.destroy(),this._actor=null,this._enable=!1,this._listeners=new Map}onActiveChange(t){this._actor&&(this._actor.enable=t)}get enable(){return this._actor&&this._actor.enable}set enable(t){this._actor&&(this._actor.enable=t)}addEventListener(t,e){this._eventDispatcher.addEventListener(t.toLowerCase(),e)}removeEventListener(t,e){this._eventDispatcher.removeEventListener(t.toLowerCase(),e)}addEventListenerByTag(t,e,i){this.addEventListener(t,e),this._listeners[i]=e}removeEventListenerByTag(t,e){this.removeEventListener(t,this._listeners[e]),this._listeners.delete(e)}setTransform(t,e){void 0===t&&(t=[0,0,0]),void 0===e&&(e=[0,0,0,1]),this._rootObject&&(t=d.vec3CancelQuat(t,e),e=d.quatWorldToSelf(this._rootObject,e)),this._actor&&this._actor.setTransform(t,e)}setPosition(t){void 0===t&&(t=[0,0,0]),this.setTransform(t,this._host.quaternion)}setRotation(t){void 0===t&&(t=[0,0,0,1]),this.setTransform(this._host.position,t)}equalsQuaternion(t,e){var i=THING.Math.getAnglesFromQuat(t),s=THING.Math.getAnglesFromQuat(e);return THING.Math.equalsVector(i,s,.001)}onUpdateTransform(t){if(this._enableSyncToPhysics){var e=this._host.getMatrixWorld([],!1),i=THING.Math.getVec3FromMatrixColumn(e,3),s=THING.Math.getQuatFromMat4(e);THING.Math.equalsVector(this._position,i)&&this.equalsQuaternion(this._rotation,s)?this._physicsChange&&(this._position=this._physicsPosition,this._rotation=this._physicsRotation,this._host.position=this._physicsPosition,this._host.quaternion=this._physicsRotation,this._physicsChange=!1):(this._position=i,this._rotation=s,t({id:this._actor.id,position:i,quaternion:s}))}else this._physicsChange&&(this._position=this._physicsPosition,this._rotation=this._physicsRotation,this._host.position=this._physicsPosition,this._host.quaternion=this._physicsRotation,this._physicsChange=!1)}onColliderTriggerEnter(e,i,s){this._eventDispatcher.dispatchEvent({type:t.ColliderTriggerEnter.toLowerCase(),myShape:e,otherComponent:i&&i.component,otherShape:s})}onColliderTriggerLeave(e,i,s){this._eventDispatcher.dispatchEvent({type:t.ColliderTriggerLeave.toLowerCase(),myShape:e,otherComponent:i&&i.component,otherShape:s})}onColliderContactBegin(e,i,s){this._eventDispatcher.dispatchEvent({type:t.ColliderContactBegin.toLowerCase(),myShape:e,otherComponent:i&&i.component,otherShape:s})}onColliderContactEnd(e,i,s){this._eventDispatcher.dispatchEvent({type:t.ColliderContactEnd.toLowerCase(),myShape:e,otherComponent:i&&i.component,otherShape:s})}}class ct extends lt{constructor(t){void 0===t&&(t={}),super(t),this.createActor()}createActor(){this._actor=new nt({position:[0,0,0],rotation:[0,0,0,1],component:this})}onAdd(t){super.onAdd(t),this.onAfterAdd()}}class ht{constructor(){this._id=ht.idBase++,this._workerAdapter=U.getInstance()}release(){this.postMessageToWorker(u.PhysXGeometryFunction,{id:this._id})}destroy(){this.release()}postMessageToWorker(t,e){this._workerAdapter.postMessage({type:t,param:e})}get id(){return this._id}}ht.idBase=1;class dt extends ht{constructor(t){void 0===t&&(t={}),super(),this._scale=t.scale||[1,1,1],this.createGeometry(t.indexes,t.vertices,t.obbSize)}createGeometry(t,e,i){t.length&&e.length?this.postMessageToWorker(u.PhysXGeometryFunction.CreateGeometry,{id:this._id,scale:this._scale,vertices:e,indexes:t,obbSize:i,geometryType:"TriangleMesh"}):console.error("param error")}get scale(){return this._scale}set scale(t){void 0===t&&(t=[1,1,1]),this._scale=t,this.postMessageToWorker(u.PhysXGeometryFunction.SetTriangleMeshScale,{id:this._id,scale:this._scale})}}class ut extends ht{constructor(t){void 0===t&&(t={}),super(),this.createGeometry()}createGeometry(){this.postMessageToWorker(u.PhysXGeometryFunction.CreateGeometry,{id:this._id,geometryType:"Plane"})}}class _t extends at{constructor(t){void 0===t&&(t={}),super(t),this._linearDamping=.1,this._angularDamping=.1,this._linearVelocity=[0,0,0],this._angularVelocity=[0,0,0],this._mass=1,this._centerOfMass=[0,0,0],this._inertiaTensor=[0,0,0],this._maxAngularVelocity=100,this._maxLinearVelocity=1e16,this._maxDepenetrationVelocity=0,this._sleepThreshold=.005,this._solverIterations=0,this._isKinematic=!1,this._constraints=0,this.createDynamicCollider(t.position,t.rotation)}createDynamicCollider(t,e){this.postMessageToWorker(u.PhysXActorFunction.CreateDynamicActor,{position:t,rotation:e,id:this._id})}addShape(t){t.geometry instanceof dt||t.geometry instanceof ut?console.error("Can not add TriangleMesh to DymanicColliderComponent"):super.addShape(t)}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this.postMessageToWorker(u.PhysXActorFunction.SetLinearDamping,{id:this._id,damping:this._linearDamping})}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this.postMessageToWorker(u.PhysXActorFunction.SetAngularDaming,{id:this._id,damping:this._angularDamping})}get sleepThreshold(){return this._sleepThreshold}set sleepThreshold(t){this._sleepThreshold=t,this.postMessageToWorker(u.PhysXActorFunction.SetSleepThreshold,{id:this._id,sleepThreshold:this._sleepThreshold})}set linearVelocity(t){this._linearVelocity=t,this.postMessageToWorker(u.PhysXActorFunction.SetLinearVelocity,{id:this._id,velocity:this._linearVelocity})}set angularVelocity(t){this._angularVelocity=t,this.postMessageToWorker(u.PhysXActorFunction.SetAngularVelocity,{id:this._id,velocity:this._angularVelocity})}get mass(){return this._mass}set mass(t){this._mass=t,this.postMessageToWorker(u.PhysXActorFunction.SetMass,{id:this._id,mass:this._mass})}get centerOfMass(){return this._centerOfMass}set centerOfMass(t){this._centerOfMass=t,this.postMessageToWorker(u.PhysXActorFunction.SetCenterOfMass,{id:this._id,centerOfMass:this._centerOfMass})}get inertiaTensor(){return this._inertiaTensor}set inertiaTensor(t){this._inertiaTensor=t,this.postMessageToWorker(u.PhysXActorFunction.SetInertiaTensor,{id:this._id,inertiaTensor:this._inertiaTensor})}get maxAngularVelocity(){return this._maxAngularVelocity}set maxAngularVelocity(t){this._maxAngularVelocity=t,this.postMessageToWorker(u.PhysXActorFunction.SetMaxAngularVelocity,{id:this._id,maxVelocity:this._maxAngularVelocity})}get maxLinearVelocity(){return this._maxLinearVelocity}set maxLinearVelocity(t){this._maxLinearVelocity=t,this.postMessageToWorker(u.PhysXActorFunction.SetMaxLinearVelocity,{id:this._id,maxVelocity:this._maxLinearVelocity})}get isKinematic(){return this._isKinematic}set isKinematic(t){this._isKinematic=t,this.postMessageToWorker(u.PhysXActorFunction.SetIsKinematic,{id:this._id,isKinematic:this._isKinematic})}addForce(t){this.postMessageToWorker(u.PhysXActorFunction.AddForce,{id:this._id,force:t})}addTorque(t){this.postMessageToWorker(u.PhysXActorFunction.AddTorque,{id:this._id,torque:t})}sleep(){this.postMessageToWorker(u.PhysXActorFunction.SetSleep,{id:this._id})}wakeUp(){this.postMessageToWorker(u.PhysXActorFunction.SetWakeup,{id:this._id})}disableGravity(t){this.postMessageToWorker(u.PhysXActorFunction.DisableGravity,{id:this._id,disable:t})}}class pt extends lt{constructor(t){void 0===t&&(t={}),super(t),this._centerOfMass=[0,0,0],this._inertiaTensor=[1,1,1],this.createActor()}vec3CancelQuat(t){return this._rootObject&&(t=d.vec3CancelQuat(t,this._rootObject.quaternion)),t}get linearDamping(){return this._actor.linearDamping}set linearDamping(t){this._actor.linearDamping=t}get angularDamping(){return this._actor.angularDamping}set angularDamping(t){this._actor.angularDamping=t}get sleepThreshold(){return this._actor.sleepThreshold}set sleepThreshold(t){this._actor.sleepThreshold=t}set linearVelocity(t){this._actor.linearVelocity=this.vec3CancelQuat(t)}set angularVelocity(t){this._actor.angularVelocity=this.vec3CancelQuat(t)}get mass(){return this._actor.mass}set mass(t){this._actor.mass=t}get centerOfMass(){return this._centerOfMass}set centerOfMass(t){this._centerOfMass=t,this._actor.centerOfMass=this.vec3CancelQuat(t)}get inertiaTensor(){return this._inertiaTensor}set inertiaTensor(t){this._inertiaTensor=t,this._actor.inertiaTensor=this.vec3CancelQuat(t)}get maxAngularVelocity(){return this._actor.maxAngularVelocity}set maxAngularVelocity(t){this._actor.maxAngularVelocity=t}get maxLinearVelocity(){return this._actor.maxLinearVelocity}set maxLinearVelocity(t){this._actor.maxLinearVelocity=t}get isKinematic(){return this._actor.isKinematic}set isKinematic(t){this._actor.isKinematic=t}addForce(t){this._actor.addForce(this.vec3CancelQuat(t))}addTorque(t){this._actor.addTorque(this.vec3CancelQuat(t))}sleep(){this._actor.sleep()}wakeUp(){this._actor.wakeUp()}disableGravity(t){void 0===t&&(t=!0),this._actor.disableGravity(t)}createActor(){this._actor=new _t({position:[0,0,0],rotation:[0,0,0,1],component:this})}onAdd(t){if(super.onAdd(t),this.onAfterAdd(),0==this.centerOfMass[0]&&0==this.centerOfMass[1]&&0==this.centerOfMass[2]){var e=d.computeOBB(t);this.centerOfMass=e.localPosition}}}class mt extends ht{constructor(t){void 0===t&&(t={}),super(),this._size=t.size||[1,1,1],this.createGeometry()}createGeometry(){this.postMessageToWorker(u.PhysXGeometryFunction.CreateGeometry,{id:this._id,geometryType:"Box",size:this._size})}get size(){return this._size}set size(t){this._size=t,this.postMessageToWorker(u.PhysXGeometryFunction.SetBoxSize,{id:this._id,size:t})}}class gt extends ht{constructor(t){void 0===t&&(t={}),super(),this._radius=t.radius||1,this._height=t.height||1,this.createGeometry()}createGeometry(){this.postMessageToWorker(u.PhysXGeometryFunction.CreateGeometry,{id:this._id,geometryType:"Capsule",height:this._height,radius:this._radius})}get radius(){return this._radius}set radius(t){this._radius=t,this.postMessageToWorker(u.PhysXGeometryFunction.SetCapsuleRadius,{id:this._id,radius:this._radius})}get height(){return this._height}set height(t){this._height=t,this.postMessageToWorker(u.PhysXGeometryFunction.SetCapsuleHeight,{id:this._id,height:this._height})}}var yt=o("../../node_modules/.pnpm/quickhull3d@2.0.5/node_modules/quickhull3d/dist/index.js"),vt=o.n(yt);class ft extends ht{constructor(t){void 0===t&&(t={}),super(),this._scale=t.scale||[1,1,1],this._enablePreProcessingConvexMesh=!0,t.vertices?this.createGeometry(t.vertices):console.error("Must input vertices.")}preProcessingConvexMesh(t){var e=t;if(t.length>=4){for(var i=new Array(t.length/3),s=0,o=0;o<t.length;o+=3)i[s++]=[t[o],t[o+1],t[o+2]];var r=vt()(i),a=new Array(9*r.length);for(s=0,o=0;o<r.length;o++){var n=i[r[o][0]],l=i[r[o][1]],c=i[r[o][2]];a[s++]=n[0],a[s++]=n[1],a[s++]=n[2],a[s++]=l[0],a[s++]=l[1],a[s++]=l[2],a[s++]=c[0],a[s++]=c[1],a[s++]=c[2]}e=a}return e}createGeometry(t){this._enablePreProcessingConvexMesh&&(t=this.preProcessingConvexMesh(t)),t.length>0&&this.postMessageToWorker(u.PhysXGeometryFunction.CreateGeometry,{id:this._id,geometryType:"ConvexMesh",scale:this._scale,vertices:t})}get scale(){return this._scale}set scale(t){void 0===t&&(t=[1,1,1]),this._scale=t,this.postMessageToWorker(u.PhysXGeometryFunction.SetConvexMeshScale,{id:this._id,scale:this._scale})}}class St extends ht{constructor(t){void 0===t&&(t={}),super(),this._radius=t.radius||.5,this.createGeometry()}createGeometry(){this.postMessageToWorker(u.PhysXGeometryFunction.CreateGeometry,{id:this._id,geometryType:"Sphere",radius:this._radius})}get radius(){return this._radius}set radius(t){this._radius=t,this.postMessageToWorker(u.PhysXGeometryFunction.SetSphereRadius,{id:this._id,radius:this._radius})}}class Ct extends et{constructor(t){void 0===t&&(t={}),super({geometry:new mt(t),material:new tt(t)}),this._size=[1,1,1],this.size=t.size||[1,1,1],this.createShape()}get size(){return this._size}set size(t){this._size=t,this._geometry.size=this._size,this.setGeometry(this._geometry)}}class xt extends et{constructor(t){void 0===t&&(t={}),super({geometry:new gt(t),material:new tt(t)}),this._radius=1,this._height=1,this.radius=t.radius||1,this.height=t.height||1,this.createShape()}get radius(){return this._radius}set radius(t){this._radius=t,this._geometry.radius=this._radius,this.setGeometry(this._geometry)}get height(){return this._height}set height(t){this._height=t,this._geometry.height=this._height,this.setGeometry(this._geometry)}}class Pt extends et{constructor(t){void 0===t&&(t={}),super({geometry:new ut,material:new tt(t)}),this.createShape(),this.localRotation=THING.Math.getQuatFromAngles([0,0,90])}}class Lt extends et{constructor(t){void 0===t&&(t={}),super({geometry:new St(t),material:new tt(t)}),this._radius=.5,this.radius=t.radius||.5,this.createShape()}get radius(){return this._radius}set radius(t){this._radius=t,this._geometry.radius=this._radius,this.setGeometry(this._geometry)}}class Tt extends et{constructor(t){void 0===t&&(t={}),super({material:new tt(t)}),this._node=t.object,this._scale=[1,1,1],this.createGeometry(),this._geometry&&this.createShape()}recalcRelativeInfo(t){if(t)if(null==this._node&&(this._node=t),t!=this._node){var e=d.getRelativeInfo(t,this._node);this.localPosition=THING.Math.scaleVector(e.relativePosition,t.scale),this.localRotation=e.relativeRotation,this.scale=this._node.body.scale}else this.localPosition=[0,0,0],this.localRotation=[0,0,0,1],this.scale=this._node.body.scale}createGeometry(){var t=this.computeVertices(this._node);this._geometry=new ft({scale:this._scale,vertices:t})}computeVertices(t){var e=t&&t.bodyNode&&t.bodyNode.getVerticesInfo&&t.bodyNode.getVerticesInfo();return e&&e.vertices?e.vertices:[]}get scale(){return this._scale}set scale(t){void 0===t&&(t=[1,1,1]),this._scale=t,this._geometry&&(this._geometry.scale=this._scale,this.setGeometry(this._geometry))}}class Ft extends et{constructor(t){void 0===t&&(t={}),super({material:new tt(t)}),this._node=t.object,this._scale=[1,1,1],this.createGeomenty(),this._geometry&&this.createShape()}recalcRelativeInfo(t){if(t)if(null==this._node&&(this._node=t),t!=this._node){var e=d.getRelativeInfo(t,this._node);this.localPosition=THING.Math.scaleVector(e.relativePosition,t.scale),this.localRotation=e.relativeRotation,this.scale=this._node.body.scale}else this.localPosition=[0,0,0],this.localRotation=[0,0,0,1],this.scale=this._node.body.scale}createGeomenty(){var t=this.computeVertices(this._node),e=d.computeOBB(this._node);t&&t.vertices.length>0&&t.indexes.length>0&&(this._geometry=new dt({scale:this.scale,vertices:t.vertices,indexes:t.indexes,obbSize:e.size}))}computeVertices(t){var e=t&&t.bodyNode&&t.bodyNode.getVerticesInfo&&t.bodyNode.getVerticesInfo();return e&&e.vertices?{vertices:e.vertices,indexes:e.indexes}:null}get scale(){return this._scale}set scale(t){void 0===t&&(t=[1,1,1]),this._scale=t,this._geometry&&(Math.min(Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2]))<=1e-5&&(console.warn("scale is an invalid value, less then 0.00001"),t[0]<=1e-5&&(this._scale=[2e-5,this._scale[1],this._scale[2]]),t[1]<=1e-5&&(this._scale=[this._scale[0],2e-5,this._scale[2]]),t[2]<=1e-5&&(this._scale=[this._scale[0],this._scale[1],2e-5])),this._geometry.scale=this._scale,this.setGeometry(this._geometry))}}class bt extends et{constructor(t){void 0===t&&(t={}),super({material:new tt(t)}),this._node=t.object,this._size=[1,1,1],this.createGeometry(),this.createShape()}recalcRelativeInfo(t){if(t)if(null==this._node&&(this._node=t),t!=this._node)console.error("OBB Shape must add to itself");else{var e=d.computeOBB(this._node);this.localPosition=e.localPosition,this.size=e.size}}createGeometry(){this._geometry=new mt({size:this._size})}set size(t){this._size=t,this._geometry.size=this._size,this.setGeometry(this._geometry)}}class Mt{constructor(t){void 0===t&&(t={}),this._id=Mt.idBase++,this._workerAdapter=U.getInstance(),this._collider0=t.collider0||null,this._collider1=t.collider1||null,this._axis=t.axis||[1,0,0],this._localPosition0=[0,0,0],this._localPosition1=[0,0,0],this._localRotation0=[0,0,0,1],this._localRotation1=[0,0,0,1]}postMessageToWorker(t,e){this._workerAdapter.postMessage({type:t,param:e})}get id(){return this._id}calculateAnchor(t,e,i){this._localPosition0=null==t?i:t.worldToSelf(i,!0),this._localPosition1=null==e?i:e.worldToSelf(i,!0)}calculateAxis(t,e,i){var s=[0,0,0],o=[0,0,0];if(null==t)s=i;else for(var r=t.cross,a=t.up,n=t.forward,l=0;l<i.length;l++)0!=i[l]&&(s[0]+=r[l]*i[l],s[1]+=a[l]*i[l],s[2]+=n[l]*i[l]);if(null==e)o=i;else{var c=e.cross,h=e.up,d=e.forward;for(l=0;l<i.length;l++)0!=i[l]&&(o[0]+=c[l]*i[l],o[1]+=h[l]*i[l],o[2]+=d[l]*i[l])}this._localRotation0=THING.Math.getQuatFromUnitVectors([1,0,0],THING.Math.normalizeVector(s)),this._localRotation1=THING.Math.getQuatFromUnitVectors([1,0,0],THING.Math.normalizeVector(o))}setColliders(t,e){this._collider0=t,this._collider1=e,this.postMessageToWorker(u.PhysXJointFunction.SetActors,{id:this._id,id0:t.getActor().id,id1:e.getActor().id})}getColliders(){return[this._collider0,this._collider1]}setAxis(t){this._axis=t;var e=this._collider0._host,i=this._collider1._host;this.calculateAxis(e,i,t),this.postMessageToWorker(u.PhysXJointFunction.SetLocalPose,{id:this._id,actor:0,localPosition:this._localPosition0,localRotation:this._localRotation0}),this.postMessageToWorker(u.PhysXJointFunction.SetLocalPose,{id:this._id,actor:1,localPosition:this._localPosition1,localRotation:this._localRotation1})}getAxis(){return this._axis}destroy(){this.postMessageToWorker(u.PhysXJointFunction.ReleaseJoint,{id:this._id})}}Mt.idBase=1;class At extends Mt{constructor(t){void 0===t&&(t={}),super(t),this._anchor0=t.anchor0||[0,0,0],this._anchor1=t.anchor1||[0,0,0],this._minDistance=0,this._maxDistance=0,this._tolerance=.025,this._stiffness=0,this._damping=0,this.createDistanceJoint(this._collider0,this._collider1,this._anchor0,this._anchor1,this._axis)}createDistanceJoint(t,e,i,s,o){var r=null==t?null:t.getActor(),a=null==e?null:e.getActor(),n=null==r?-1:r.id,l=null==a?-1:a.id;if(n==l)console.error("DistanceJoint: colliders must be different");else{var c=null==t?null:t._host,h=null==e?null:e._host;this._localPosition0=null==c?i:c.worldToSelf(i,!0),this._localPosition1=null==h?s:h.worldToSelf(s,!0),this.calculateAxis(c,h,o),r instanceof _t||a instanceof _t?this.postMessageToWorker(u.PhysXJointFunction.CreateDistanceJoint,{id:this._id,id0:n,localPosition0:this._localPosition0,localRotation0:this._localRotation0,id1:l,localPosition1:this._localPosition1,localRotation1:this._localRotation1}):console.error("DistanceJoint: at least one collider must be dynamic")}}setAxis(t){console.warn("DistanceJoint do not require the axis to be set ")}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance=t,this.postMessageToWorker(u.PhysXJointFunction.SetMinDistance,{id:this._id,minDistance:this._minDistance})}get maxDistance(){return this._maxDistance}set maxDistance(t){this._maxDistance=t,this.postMessageToWorker(u.PhysXJointFunction.SetMaxDistance,{id:this._id,maxDistance:this._maxDistance})}get tolerance(){return this._tolerance}set tolerance(t){this._tolerance=t,this.postMessageToWorker(u.PhysXJointFunction.SetTolerance,{id:this._id,tolerance:this._tolerance})}get stiffness(){return this._stiffness}set stiffness(t){this._stiffness=t,this.postMessageToWorker(u.PhysXJointFunction.SetStiffness,{id:this._id,stiffness:this._stiffness})}get damping(){return this._damping}set damping(t){this._damping=t,this.postMessageToWorker(u.PhysXJointFunction.SetDamping,{id:this._id,damping:this._damping})}}At.idBase=1;class kt extends Mt{constructor(t){void 0===t&&(t={}),super(t),this._anchor=t.anchor||[0,0,0],this.createFixedJoint(this._collider0,this._collider1,this._anchor,this._axis)}createFixedJoint(t,e,i,s){var o=null==t?null:t.getActor(),r=null==e?null:e.getActor(),a=null==o?-1:o.id,n=null==r?-1:r.id;if(a==n)console.error("FixedJoint: colliders must be different");else{var l=null==t?null:t._host,c=null==e?null:e._host;this.calculateAnchor(l,c,i),this.calculateAxis(l,c,s),o instanceof _t||r instanceof _t?this.postMessageToWorker(u.PhysXJointFunction.CreateFixedJoint,{id:this._id,id0:a,localPosition0:this._localPosition0,localRotation0:this._localRotation0,id1:n,localPosition1:this._localPosition1,localRotation1:this._localRotation1}):console.error("FixedJoint: at least one collider must be dynamic")}}simulatesJoint(t,e,i){for(var s=t._host,o=e._host,r=s.boundingBox.halfSize,a=o.boundingBox.halfSize,n=9999,l=0;l<3;l++)n>r[l]&&(n=r[l]),n>a[l]&&(n=a[l]);var c=s.worldToSelf(i,!0),h=new THING.Box(n/2,n/2,n/2);h.position=i,h.style.color="blue";var d=new THING.Box(n/2,n/2,THING.Math.getVectorLength(THING.Math.subVector(h.position,s.position)));d.position=[(s.position[0]+h.position[0])/2,(s.position[1]+h.position[1])/2,(s.position[2]+h.position[2])/2],d.quaternion=THING.Math.getQuatFromUnitVectors([0,0,1],THING.Math.normalizeVector(THING.Math.subVector(h.position,s.position))),d.style.color="blue",s.add(d);var u=new THING.Box(n/2,n/2,THING.Math.getVectorLength(THING.Math.subVector(o.position,h.position)));u.position=[(o.position[0]+h.position[0])/2,(o.position[1]+h.position[1])/2,(o.position[2]+h.position[2])/2],u.quaternion=THING.Math.getQuatFromUnitVectors([0,0,1],THING.Math.normalizeVector(THING.Math.subVector(o.position,h.position))),u.style.color="grey",o.add(u),app.on("update",(function(){h.position=s.selfToWorld(c)}))}setAxis(t){console.warn("FixedJoint do not require the axis to be set ")}}class wt extends Mt{constructor(t){void 0===t&&(t={}),super(t),this._anchor=t.anchor||[0,0,0],this._limit={type:"undefined",lowerLimit:0,upperLimit:0,contactDist:0,stiffness:0,damping:0},this._driveVelocity=0,this._driveForceLimit=0,this._driveGearRatio=0,this._driveForceEnable=!1,this.createRevoluteJoint(this._collider0,this._collider1,this._anchor,this._axis)}createRevoluteJoint(t,e,i,s){var o=null==t?null:t.getActor(),r=null==e?null:e.getActor(),a=null==o?-1:o.id,n=null==r?-1:r.id;if(a==n)console.error("RevoluteJoint: colliders must be different");else{var l=null==t?null:t._host,c=null==e?null:e._host;this.calculateAnchor(l,c,i),this.calculateAxis(l,c,s),o instanceof _t||r instanceof _t?this.postMessageToWorker(u.PhysXJointFunction.CreateRevoluteJoint,{id:this._id,id0:a,localPosition0:this._localPosition0,localRotation0:this._localRotation0,id1:n,localPosition1:this._localPosition1,localRotation1:this._localRotation1}):console.error("RevoluteJoint: at least one collider must be dynamic")}}get driveVelocity(){return this._driveVelocity}set driveVelocity(t){this._driveVelocity=t,this.postMessageToWorker(u.PhysXJointFunction.SetDriveVelocity,{id:this._id,driveVelocity:this._driveVelocity})}get driveForceLimit(){return this._driveForceLimit}set driveForceLimit(t){this._driveForceLimit=t,this.postMessageToWorker(u.PhysXJointFunction.SetDriveForceLimit,{id:this._id,driveForceLimit:this._driveForceLimit})}get driveGearRatio(){return this._driveGearRatio}set driveGearRatio(t){this._driveGearRatio=t,this.postMessageToWorker(u.PhysXJointFunction.SetDriveGearRatio,{id:this._id,driveGearRatio:this._driveGearRatio})}setHardLimit(t,e,i){t<=-360||e>=360||t>e?console.error("setHardLimit: limit invalid, limit must be strictly between -360 and 360"):(this._limit.type="hard",this._limit.lowerLimit=t,this._limit.upperLimit=e,this._limit.contactDist=i,this._limit.stiffness=0,this._limit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardLimit,{id:this._id,lowerLimit:THING.Math.degToRad(this._limit.lowerLimit),upperLimit:THING.Math.degToRad(this._limit.upperLimit),contactDist:this._limit.contactDist}))}setSoftLimit(t,e,i,s){t<=-360||e>=360||t>e?console.error("setSoftLimit: limit invalid, limit must be strictly between -360 and 360"):(this._limit.type="soft",this._limit.lowerLimit=t,this._limit.upperLimit=e,this._limit.contactDist=0,this._limit.stiffness=i,this._limit.damping=s,this.postMessageToWorker(u.PhysXJointFunction.SetSoftLimit,{id:this._id,lowerLimit:THING.Math.degToRad(this._limit.lowerLimit),upperLimit:THING.Math.degToRad(this._limit.upperLimit),stiffness:this._limit.stiffness,damping:this._limit.damping}))}getLimit(){return this._limit}setDrive(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=1/0),this._driveVelocity=t,this._driveForceEnable=e,this._driveForceLimit=i,this.postMessageToWorker(u.PhysXJointFunction.SetRevoluteDrive,{id:this._id,driveVelocity:this._driveVelocity,driveForceFlag:this._driveForceEnable,driveForceLimit:this._driveForceLimit})}}wt.idBase=1;class Xt extends Mt{constructor(t){void 0===t&&(t={}),super(t),this._anchor=t.anchor||[0,0,0],this._limit={type:"undefined",yLimitAngle:0,zLimitAngle:0,contactDist:0,stiffness:0,damping:0},this.createSphericalJoint(this._collider0,this._collider1,this._anchor,this._axis)}createSphericalJoint(t,e,i,s){var o=null==t?null:t.getActor(),r=null==e?null:e.getActor(),a=null==o?-1:o.id,n=null==r?-1:r.id;if(a==n)console.error("SphericalJoint: colliders must be different");else{var l=null==t?null:t._host,c=null==e?null:e._host;this.calculateAnchor(l,c,i),this.calculateAxis(l,c,s),o instanceof _t||r instanceof _t?this.postMessageToWorker(u.PhysXJointFunction.CreateSphericalJoint,{id:this._id,id0:a,localPosition0:this._localPosition0,localRotation0:this._localRotation0,id1:n,localPosition1:this._localPosition1,localRotation1:this._localRotation1}):console.error("SphericalJoint: at least one collider must be dynamic")}}simulatesJoint(t,e,i){for(var s=t._host,o=e._host,r=s.boundingBox.halfSize,a=o.boundingBox.halfSize,n=9999,l=0;l<3;l++)n>r[l]&&(n=r[l]),n>a[l]&&(n=a[l]);var c=s.worldToSelf(i,!0);console.log(n);var h=new THING.Sphere(n/2);h.position=i,h.style.color="blue";var d=new THING.Box(n/2,n/2,THING.Math.getVectorLength(THING.Math.subVector(h.position,s.position)));d.position=[(s.position[0]+h.position[0])/2,(s.position[1]+h.position[1])/2,(s.position[2]+h.position[2])/2],d.quaternion=THING.Math.getQuatFromUnitVectors([0,0,1],THING.Math.normalizeVector(THING.Math.subVector(h.position,s.position))),d.style.color="blue",s.add(d);var u=new THING.Box(n/2,n/2,THING.Math.getVectorLength(THING.Math.subVector(o.position,h.position)));u.position=[(o.position[0]+h.position[0])/2,(o.position[1]+h.position[1])/2,(o.position[2]+h.position[2])/2],u.quaternion=THING.Math.getQuatFromUnitVectors([0,0,1],THING.Math.normalizeVector(THING.Math.subVector(o.position,h.position))),u.style.color="grey",o.add(u),app.on("update",(function(){h.position=s.selfToWorld(c)}))}setHardLimit(t,e,i){t<=0||t>=180||e<=0||e>=180?console.error("setSoftLimit: limit invalid, limit must be strictly between 0 and 180"):(this._limit.type="hard",this._limit.yLimitAngle=t,this._limit.zLimitAngle=e,this._limit.contactDist=i,this._limit.stiffness=0,this._limit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardLimitCone,{id:this._id,yLimitAngle:THING.Math.degToRad(this._limit.yLimitAngle),zLimitAngle:THING.Math.degToRad(this._limit.zLimitAngle),contactDist:this._limit.contactDist}))}setSoftLimit(t,e,i,s){t<=0||t>=180||e<=0||e>=180?console.error("setSoftLimit: limit invalid, limit must be strictly between 0 and 180"):(this._limit.type="soft",this._limit.yLimitAngle=t,this._limit.zLimitAngle=e,this._limit.contactDist=0,this._limit.stiffness=i,this._limit.damping=s,this.postMessageToWorker(u.PhysXJointFunction.SetSoftLimitCone,{id:this._id,yLimitAngle:THING.Math.degToRad(this._limit.yLimitAngle),zLimitAngle:THING.Math.degToRad(this._limit.zLimitAngle),stiffness:this._limit.stiffness,damping:this._limit.damping}))}getLimit(){return this._limit}}Xt.idBase=1;class Dt extends Mt{constructor(t){void 0===t&&(t={}),super(t),this._anchor=t.anchor||[0,0,0],this._limit={type:"undefined",lowerLimit:0,upperLimit:0,contactDist:0,stiffness:0,damping:0},this.createPrismaticJoint(this._collider0,this._collider1,this._anchor,this._axis)}createPrismaticJoint(t,e,i,s){var o=null==t?null:t.getActor(),r=null==e?null:e.getActor(),a=null==o?-1:o.id,n=null==r?-1:r.id;if(a==n)console.error("PrismaticJoint: colliders must be different");else{var l=null==t?null:t._host,c=null==e?null:e._host;this.calculateAnchor(l,c,i),this.calculateAxis(l,c,s),o instanceof _t||r instanceof _t?this.postMessageToWorker(u.PhysXJointFunction.CreatePrismaticJoint,{id:this._id,id0:a,localPosition0:this._localPosition0,localRotation0:this._localRotation0,id1:n,localPosition1:this._localPosition1,localRotation1:this._localRotation1}):console.error("PrismaticJoint: at least one collider must be dynamic")}}setHardLimit(t,e,i){this._limit.type="hard",this._limit.lowerLimit=t,this._limit.upperLimit=e,this._limit.contactDist=i,this._limit.stiffness=0,this._limit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardLimitPri,{id:this._id,lowerLimit:this._limit.lowerLimit,upperLimit:this._limit.upperLimit,contactDist:this._limit.contactDist})}setSoftLimit(t,e,i,s){this._limit.type="soft",this._limit.lowerLimit=t,this._limit.upperLimit=e,this._limit.contactDist=0,this._limit.stiffness=i,this._limit.damping=s,this.postMessageToWorker(u.PhysXJointFunction.SetSoftLimitPri,{id:this._id,lowerLimit:this._limit.lowerLimit,upperLimit:this._limit.upperLimit,stiffness:this._limit.stiffness,damping:this._limit.damping})}getLimit(){return this._limit}}Dt.idBase=1;class Rt extends Mt{constructor(t){void 0===t&&(t={}),super(t),this._anchor=t.anchor||[0,0,0],this._motion={LinearX:"Locked",LinearY:"Locked",LinearZ:"Locked",AngularX:"Locked",AngularY:"Locked",AngularZ:"Locked"},this._distanceLimit={type:"undefined",extent:0,contactDist:0,stiffness:0,damping:0},this._linearLimit={LinearX:{type:"undefined",lowerLimit:0,upperLimit:0,contactDist:0,stiffness:0,damping:0},LinearY:{type:"undefined",lowerLimit:0,upperLimit:0,contactDist:0,stiffness:0,damping:0},LinearZ:{type:"undefined",lowerLimit:0,upperLimit:0,contactDist:0,stiffness:0,damping:0}},this._twistLimit={type:"undefined",lowerLimit:0,upperLimit:0,contactDist:0,stiffness:0,damping:0},this._swingLimit={type:"undefined",yLimitAngle:0,zLimitAngle:0,contactDist:0,stiffness:0,damping:0},this._pyramidSwingLimit={type:"undefined",yLimitAngleMin:0,yLimitAngleMax:0,zLimitAngleMin:0,zLimitAngleMax:0,contactDist:0,stiffness:0,damping:0},this._driveLinearVelocity=[1,1,1],this._driveAngularVelocity=[1,1,1],this.createD6Joint(this._collider0,this._collider1,this._anchor,this._axis)}createD6Joint(t,e,i,s){var o=null==t?null:t.getActor(),r=null==e?null:e.getActor(),a=null==o?-1:o.id,n=null==r?-1:r.id;if(a==n)console.error("D6Joint: colliders must be different");else{var l=null==t?null:t._host,c=null==e?null:e._host;this.calculateAnchor(l,c,i),this.calculateAxis(l,c,s),o instanceof _t||r instanceof _t?this.postMessageToWorker(u.PhysXJointFunction.CreateD6Joint,{id:this._id,id0:a,localPosition0:this._localPosition0,localRotation0:this._localRotation0,id1:n,localPosition1:this._localPosition1,localRotation1:this._localRotation1}):console.error("D6Joint: at least one collider must be dynamic")}}setMotion(t,e){var i="";switch(e){case a.Locked:i="Locked";break;case a.Limited:i="Limited";break;case a.Free:i="Free"}switch(t){case s.LinearX:this._motion.LinearX=i;break;case s.LinearY:this._motion.LinearY=i;break;case s.LinearZ:this._motion.LinearZ=i;break;case s.AngularX:this._motion.AngularX=i;break;case s.AngularY:this._motion.AngularY=i;break;case s.AngularZ:this._motion.AngularZ=i}this.postMessageToWorker(u.PhysXJointFunction.SetMotion,{id:this._id,axis:t,axisType:e})}getMotion(){return this._motion}setHardDistanceLimit(t,e){this._distanceLimit.type="hard",this._distanceLimit.extent=t,this._distanceLimit.contactDist=e,this._distanceLimit.stiffness=0,this._distanceLimit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardDistanceLimit,{id:this._id,extent:this._distanceLimit.extent,contactDist:this._distanceLimit.contactDist})}setSoftDistanceLimit(t,e,i){this._distanceLimit.type="soft",this._distanceLimit.extent=t,this._distanceLimit.contactDist=0,this._distanceLimit.stiffness=e,this._distanceLimit.damping=i,this.postMessageToWorker(u.PhysXJointFunction.SetSoftDistanceLimit,{id:this._id,extent:this._distanceLimit.extent,stiffness:this._distanceLimit.stiffness,damping:this._distanceLimit.damping})}getDistanceLimit(){return this._distanceLimit}setHardLinearLimit(t,e,i,o){switch(t){case s.LinearX:this._linearLimit.LinearX.type="hard",this._linearLimit.LinearX.lowerLimit=e,this._linearLimit.LinearX.upperLimit=i,this._linearLimit.LinearX.contactDist=o,this._linearLimit.LinearX.stiffness=0,this._linearLimit.LinearX.damping=0;break;case s.LinearY:this._linearLimit.LinearY.type="hard",this._linearLimit.LinearY.lowerLimit=e,this._linearLimit.LinearY.upperLimit=i,this._linearLimit.LinearY.contactDist=o,this._linearLimit.LinearY.stiffness=0,this._linearLimit.LinearY.damping=0;break;case s.LinearZ:this._linearLimit.LinearZ.type="hard",this._linearLimit.LinearZ.lowerLimit=e,this._linearLimit.LinearZ.upperLimit=i,this._linearLimit.LinearZ.contactDist=o,this._linearLimit.LinearZ.stiffness=0,this._linearLimit.LinearZ.damping=0}this.postMessageToWorker(u.PhysXJointFunction.SetHardLinearLimit,{id:this._id,axis:t,lowerLimit:e,upperLimit:i,contactDist:o})}setSoftLinearLimit(t,e,i,o,r){switch(t){case s.LinearX:this._linearLimit.LinearX.type="soft",this._linearLimit.LinearX.lowerLimit=e,this._linearLimit.LinearX.upperLimit=i,this._linearLimit.LinearX.contactDist=0,this._linearLimit.LinearX.stiffness=o,this._linearLimit.LinearX.damping=r;break;case s.LinearY:this._linearLimit.LinearY.type="soft",this._linearLimit.LinearY.lowerLimit=e,this._linearLimit.LinearY.upperLimit=i,this._linearLimit.LinearY.contactDist=0,this._linearLimit.LinearY.stiffness=o,this._linearLimit.LinearY.damping=r;break;case s.LinearZ:this._linearLimit.LinearZ.type="soft",this._linearLimit.LinearZ.lowerLimit=e,this._linearLimit.LinearZ.upperLimit=i,this._linearLimit.LinearZ.contactDist=0,this._linearLimit.LinearZ.stiffness=o,this._linearLimit.LinearZ.damping=r}this.postMessageToWorker(u.PhysXJointFunction.SetSoftLinearLimit,{id:this._id,axis:t,lowerLimit:e,upperLimit:i,stiffness:o,damping:r})}getLinearLimit(){return this._linearLimit}setHardTwistLimit(t,e,i){t<=-360||e>=360||t>e?console.error("setHardTwistLimit: limit invalid, twist limit must be strictly between -360 and 360"):(this._twistLimit.type="hard",this._twistLimit.lowerLimit=t,this._twistLimit.upperLimit=e,this._twistLimit.contactDist=i,this._twistLimit.stiffness=0,this._twistLimit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardTwistLimit,{id:this._id,lowerLimit:THING.Math.degToRad(t),upperLimit:THING.Math.degToRad(e),contactDist:i}))}setSoftTwistLimit(t,e,i,s){t<=-360||e>=360||t>e?console.error("setSoftTwistLimit: limit invalid, twist limit must be strictly between -360 and 360"):(this._twistLimit.type="soft",this._twistLimit.lowerLimit=t,this._twistLimit.upperLimit=e,this._twistLimit.contactDist=0,this._twistLimit.stiffness=i,this._twistLimit.damping=s,this.postMessageToWorker(u.PhysXJointFunction.SetSoftTwistLimit,{id:this._id,lowerLimit:THING.Math.degToRad(t),upperLimit:THING.Math.degToRad(e),stiffness:i,damping:s}))}getTwistLimit(){return this._twistLimit}setHardSwingLimit(t,e,i){t<=0||t>=180||e<=0||e>=180?console.error("setHardSwingLimit: limit invalid, swing limit must be strictly between 0 and 180"):(this._swingLimit.type="hard",this._swingLimit.yLimitAngle=t,this._swingLimit.zLimitAngle=e,this._swingLimit.contactDist=i,this._swingLimit.stiffness=0,this._swingLimit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardSwingLimit,{id:this._id,yLimitAngle:THING.Math.degToRad(t),zLimitAngle:THING.Math.degToRad(e),contactDist:i}))}setSoftSwingLimit(t,e,i,s){t<=0||t>=180||e<=0||e>=180?console.error("setSoftSwingLimit: limit invalid, swing limit must be strictly between 0 and 180"):(this._swingLimit.type="soft",this._swingLimit.yLimitAngle=t,this._swingLimit.zLimitAngle=e,this._swingLimit.contactDist=0,this._swingLimit.stiffness=i,this._swingLimit.damping=s,this.postMessageToWorker(u.PhysXJointFunction.SetSoftSwingLimit,{id:this._id,yLimitAngle:THING.Math.degToRad(t),zLimitAngle:THING.Math.degToRad(e),stiffness:i,damping:s}))}getSwingLimit(){return this._swingLimit}setHardPyramidSwingLimit(t,e,i,s,o){t<=-180||e>=180||t>e||i<=-180||s>=180||i>s?console.error("setSoftSwingLimit: limit invalid, pyramidSwing limit must be strictly between -180 and 180"):(this._pyramidSwingLimit.type="hard",this._pyramidSwingLimit.yLimitAngleMin=t,this._pyramidSwingLimit.yLimitAngleMax=e,this._pyramidSwingLimit.zLimitAngleMin=i,this._pyramidSwingLimit.zLimitAngleMax=s,this._pyramidSwingLimit.contactDist=o,this._pyramidSwingLimit.stiffness=0,this._pyramidSwingLimit.damping=0,this.postMessageToWorker(u.PhysXJointFunction.SetHardPyramidSwingLimit,{id:this._id,yLimitAngleMin:THING.Math.degToRad(t),yLimitAngleMax:THING.Math.degToRad(e),zLimitAngleMin:THING.Math.degToRad(i),zLimitAngleMax:THING.Math.degToRad(s),contactDist:o}))}setSoftPyramidSwingLimit(t,e,i,s,o,r){t<=-180||e>=180||t>e||i<=-180||s>=180||i>s?console.error("setSoftSwingLimit: limit invalid, pyramidSwing limit must be strictly between -180 and 180"):(this._pyramidSwingLimit.type="soft",this._pyramidSwingLimit.yLimitAngleMin=t,this._pyramidSwingLimit.yLimitAngleMax=e,this._pyramidSwingLimit.zLimitAngleMin=i,this._pyramidSwingLimit.zLimitAngleMax=s,this._pyramidSwingLimit.contactDist=0,this._pyramidSwingLimit.stiffness=o,this._pyramidSwingLimit.damping=r,this.postMessageToWorker(u.PhysXJointFunction.SetSoftPyramidSwingLimit,{id:this._id,yLimitAngleMin:THING.Math.degToRad(t),yLimitAngleMax:THING.Math.degToRad(e),zLimitAngleMin:THING.Math.degToRad(i),zLimitAngleMax:THING.Math.degToRad(s),stiffness:o,damping:r}))}getPyramidSwingLimit(){return this._pyramidSwingLimit}}Rt.idBase=1})(),r})()));